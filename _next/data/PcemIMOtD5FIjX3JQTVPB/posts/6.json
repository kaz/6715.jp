{"pageProps":{"article":{"type":"article","slug":"6","body":"メルセンヌ・ツイスタの性質を理解したい。\n\nこの記事は前回の続きです。\n\n[メルセンヌ・ツイスタをわかった気になる](/posts/5/)\n\n## 今日のテーマ\n\n今日のテーマは、メルセンヌ・ツイスタ(MT)の性質についてです。\n\nMTの生成する乱数列は、以下の線形漸化式で表わされるのでした。\n\n$$\n\\begin{array}{c}\n\t\\mathbf{x}_{k+n} \\, = \\, \\mathbf{x}_{k+m} \\oplus ( \\mathbf{x}^u_k \\: | \\: \\mathbf{x}^l_{k+1} ) A \\\\\n\t(k = 0,1, \\cdots)\n\\end{array}\n$$\n\n漸化式で表わされるということは、連続した生成された乱数をいくつか集めれば、その次に現れる数値が予測可能じゃないか！？！？！？？\nまた逆に、今まで生成された乱数値も復元できるんじゃないか！？！？？？！\n\nワクワクしますね！\n\n# 打倒Tempering\n\nさて、さっそく……といいたいところですが、そういえば乱数値はTemperingとかいう操作をしてから出力していましたね。\n乱数を予測するには、コイツをどうにかしなければなりません。\n\n前回はTempering行う行列$T$は正則だから逆行列が求まるよね？みたいな話をして終わりました。\n\n以下の様な謎のビット演算が$T$を右から掛けることに相当する、というお話でしたが\nこの$T$がどんな行列なのかを調べることにしましょう。\n\n$$\n\\begin{array}{l}\n\t\\mathbf{y}_1 = \\mathbf{x} \\oplus (\\mathbf{x} \\gg u) \\\\\n\t\\mathbf{y}_2 = \\mathbf{y}_1 \\oplus ((\\mathbf{y}_1 \\ll s) \\: \\& \\: \\mathbf{b}) \\\\\n\t\\mathbf{y}_3 = \\mathbf{y}_2 \\oplus ((\\mathbf{y}_2 \\ll t) \\: \\& \\: \\mathbf{c}) \\\\\n\t\\mathbf{y}_4 = \\mathbf{y}_3 \\oplus (\\mathbf{y}_3 \\gg l)\n\\end{array}\n$$\n\nそういえば前回、何の脈絡もなく整数を各ビットで分けて行ベクトルとしていましたが、\nなんで行ベクトルを考えるのかというと、計算上都合がいいからです。\n例えば、XOR演算はベクトル同士の加算で表現できますし、ビットシフトは適当な正方行列との積で表現できます。\n\nあっ！じゃあ↑の式も一つ一つのビット演算が行列として表せるじゃん！！！\n\n## ビットシフトの行列表現\n\nこれはすぐに思いつきそうです。\n単純に各要素をずらすだけなので、単位行列を列ベクトル分解して、それをずらしたものを掛ければよさそう。\n\n例えば、8ビット整数について2ビットの右シフトを表す行列は以下になります。\n\n$$\nS_8 = \\left(\n\t\\begin{array}{ccccc}\n\t\t0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 \\\\\n\t\t0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 \\\\\n\t\t0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 \\\\\n\t\t0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 \\\\\n\t\t0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 \\\\\n\t\t0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 \\\\\n\t\t0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\\\\n\t\t0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\n\t\\end{array}\n\\right)\n$$\n\nこの記事中では、$S_n$をビットシフトを表す行列とします\nただし、$n < 0$のとき$|n|$ビット左シフトを、$n > 0$のとき$n$ビット右シフトを表すとします。\n\n## ANDの行列表現\n\nこれは対角成分がAND演算する整数の各ビットの値になった正方行列を考えれば良いです。\n例えば、8ビット整数について`178 = 0b10110010`とのANDを表す行列は以下のように書けます。\n\n$$\nD_{178} = \\left(\n\t\\begin{array}{ccccc}\n\t\t1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\\\\n\t\t0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\\\\n\t\t0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 \\\\\n\t\t0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 \\\\\n\t\t0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\\\\n\t\t0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\\\\n\t\t0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 \\\\\n\t\t0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\n\t\\end{array}\n\\right)\n$$\n\n対角に`10110010`が現れています。\nなんでコレがAND演算を表すのかは、左から適当な行ベクトルを掛けて、手で計算してみればすぐにわかるはずです。\n\nこの記事中では、$D_n$を$n$とのAND演算を表す行列とします。\n\n## XORの行列表現\n\n`A = 0b1001, B = 0b1001`としたとき、`A xor B`を考えてみます。\n\n| A | B | A xor B |\n|:-:|:-:|:-------:|\n| 1 | 0 |    1    |\n| 0 | 1 |    1    |\n| 0 | 0 |    0    |\n| 1 | 1 |    0    |\n\n各ビットについて見ると、1ビット同士の加算になっています。（桁があふれた分は無視です。）\nということはどうやら、2つの整数のXOR演算は、それら整数を表す行ベクトルを単純に加算するだけで良さそうです。\n\n## Temperingの逆演算\n\nさて、材料は揃いました。\nさっそく、Temperingの逆演算を表す行列を求めるとしましょう。\n\n例のビット演算で書かれた式を行列で表してみます。\n\n$$\n\\begin{array}{l}\n\t\\mathbf{y}_1 = \\mathbf{x} + \\mathbf{x} S_u = \\mathbf{x} (I + S_u) \\\\\n\t\\mathbf{y}_2 = \\mathbf{y}_1  + \\mathbf{y}_1 S_{-s} D_b = \\mathbf{y}_1 ( I + S_{-s} D_b ) \\\\\n\t\\mathbf{y}_3 = \\mathbf{y}_2  + \\mathbf{y}_2 S_{-t} D_c = \\mathbf{y}_2 ( I + S_{-t} D_c ) \\\\\n\t\\mathbf{y}_4 = \\mathbf{y}_3 + \\mathbf{y}_3 S_l = \\mathbf{y}_3 ( I + S_l )\n\\end{array}\n$$\n\nで、式が4本もあると面倒ですし、1つにまとめてしまいましょう。\n\n$$\n\\mathbf{y} = \\mathbf{x} (I + S_u) ( I + S_{-s} D_b ) ( I + S_{-t} D_c ) ( I + S_l )\n\n$$\n\nということで、ようやく$T$の本性が分かりました。\n\n$$\nT = (I + S_u) ( I + S_{-s} D_b ) ( I + S_{-t} D_c ) ( I + S_l )\n\n$$\n\nで、コイツの逆行列$T^{-1}$を求めれば、それがTemperingの逆演算を表す行列です。\n\n# 乱数を予想する\n\nさて、Temperingの逆演算ができれば、話は早いですね！\n\n前回作ったプログラムの _MT内部状態_ を表す配列を、先ほどの手順で復元した値N個で埋めてやれば、\nあとは前回説明した計算方法に従って次に出現する乱数を計算することが出来ます。やった！\n\n# 乱数を復元する\n\nじゃあ、今まで作られたであろう乱数を復元するには？\n\nとりあえず内部状態$\\mathbf{x}$をまず復元しなければならないワケですが、\nMTの漸化式を見ると、$x_k$の上位ビットが$x_{k+n}$の、下位ビットが$x_{k+n-1}$の計算に使われてるなーって気が付くとおもいます。\n\nじゃあ、その計算の逆をやれば、$x_k$が復元できるネ！っていうお話です。\n幸い、漸化式中に現れる演算はさっきやったXOR演算と、既に中身が分かっている行列$A$の乗算だけです！\n\nAはこんな行列なのでした。\n\n$$\nA = \\left(\n\t\\begin{array}{ccccc}\n\t\t0 & 1 & 0 & 0 & 0 \\\\\n\t\t0 & 0 & 1 & 0 & 0 \\\\\n\t\t0 & 0 & 0 & \\ddots & 0 \\\\\n\t\t0 & 0 & 0 & 0 & 1 \\\\\n\t\ta_{w-1} & a_{w-2} & \\cdots & \\cdots & a_0\n\t\\end{array}\n\\right)\n$$\n\nこの定義を見ると、$a_{w-1} \\ne 0$ならば明らかに正則ですねコレ。\nMT19937では↑を満たしますし、逆行列も求まりますね！\n\n元の[論文](http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/ARTICLES/mt.pdf)には、高速に計算するためにこの形にするって書いてあるんですけど、\nコレ正則じゃなくても良いのかな？そうだとすると逆演算ができない？？？（知らない）\n\n# やってみよう！\n\n早速やりましょう。\nとりあえず、前回作ったプログラムで生成した乱数をファイルに書き出して、それを入力して、その部分乱数列から全体を復元しましょう。\n\nはい、やり方はさっきまでさんざん書いたとおりなので、サクッと実装します。\n今回もRubyです。\n\n```ruby\nrequire \"matrix\"\n\n# MT19937\nW = 32\nN = 624\nM = 397\nR = 31\nU = 11\nS = 7\nT = 15\nL = 18\nA = 0x9908B0DF\nB = 0x9D2C5680\nC = 0xEFC60000\n\n# ビットマスク用\nWHOLE_MASK = (\"1\" * W).to_i(2)\nUPPER_MASK = (\"1\" * (W - R) + \"0\" * R).to_i(2)\nLOWER_MASK = (\"0\" * (W - R) + \"1\" * R).to_i(2)\n\n# ビット行列\nclass BitMat < Matrix\n\t# 行ベクトルを整数に\n\tdef to_i\n\t\t# mod 2 しないとダメ\n\t\tself.row(0).to_a.map{|i| i.to_i.abs % 2 }.join.to_i(2)\n\tend\n\t# 整数を行ベクトルに\n\tdef self.from_i(i)\n\t\tself[format(\"%.\" + W.to_s + \"b\", i).split(\"\").map(&:to_i)]\n\tend\n\n\t# kだけビットシフトする演算を表す行列を生成 (k > 0 : 右シフト, k < 0 : 左シフト)\n\tdef self.Shift(k)\n\t\tself[ *(1..W).map{|i| (1..W).map{|j| j == i+k ? 1 : 0 } } ]\n\tend\n\t# kとのAND演算を表す行列を生成\n\tdef self.And(k)\n\t\tself.diagonal(*self.from_i(k).row(0).to_a)\n\tend\n\n\t# r行目を行ベクトルvで置き換え\n\tdef []=(r, v)\n\t\t@rows[r] = v.row(0).to_a\n\tend\nend\n\n########################################\n\n# 行列T\nt = (\n\t(BitMat.I(W) + BitMat.Shift( U)) *\n\t(BitMat.I(W) + BitMat.Shift(-S) * BitMat.And(B)) *\n\t(BitMat.I(W) + BitMat.Shift(-T) * BitMat.And(C)) *\n\t(BitMat.I(W) + BitMat.Shift( L))\n)\n# Tの逆行列\nt_inv = t ** -1\n\n# 行列A\na = BitMat.Shift(1)\na[W-1] = BitMat.from_i(A)\n# Aの逆行列\na_inv = a ** -1\n\n# 乱数列を読み込む\ninput = []\nwhile line = gets\n\tinput.push($1.to_i) if /^\\d+: (\\d+)$/ =~ line\nend\n\n# E番目からN個だけの乱数を使う\nE = input.length / 3\n\nprint \"USE: \" + E.to_s + \" -> \" + (E + N - 1).to_s + \"\\n\";\n\n# E番目～E+N-1番目の乱数を取得し、Temperingの逆演算をする\nxr = input[E, N].map{|e| (BitMat.from_i(e) * t_inv).to_i }\n\n# 内部状態\nx = xr.dup\n\n# E+N番目から順に乱数列を復元\n(E + N).upto(input.length - 1) do |k|\n\ti = (k - E) % N\n\n\t# 乱数を計算\n\tz = x[i] & UPPER_MASK | x[(i + 1) % N] & LOWER_MASK\n\tx[i] = x[(i + M) % N] ^ (BitMat.from_i(z) * a).to_i\n\n\t# Temperingして一致するか確認\n\ty = (BitMat.from_i(x[i]) * t).to_i\n\tif y != input[k]\n\t\tabort \"FAIL: \" + k.to_s + \"\\n\";\n\tend\nend\n\nprint \"RETRIEVED: \" + (E + N).to_s + \" -> \", input.length - 1,\"\\n\";\n\n# 内部状態\nx = xr.dup\n\n# E-1番目から順に0番目までの乱数列を復元\n(E - 1).downto(0) do |k|\n\ti = (k - E) % N\n\n\t# z_i を復元\n\tz = (BitMat.from_i(x[i] ^ x[(i + M) % N]) * a_inv).to_i\n\n\t# z_{i-1} を復元\n\tzp = (BitMat.from_i(x[(i - 1 + N) % N] ^ x[(i - 1 + M) % N]) * a_inv).to_i\n\n\t# z_i, z_{i-1} から x[i] を復元\n\tx[i] = z & UPPER_MASK | zp & LOWER_MASK\n\n\t# Temperingして一致するか確認\n\ty = (BitMat.from_i(x[i]) * t).to_i\n\tif y != input[k]\n\t\tabort \"FAIL: \" + k.to_s + \"\\n\";\n\tend\nend\n\nprint \"RETRIEVED: 0 -> \" + (E - 1).to_s + \"\\n\";\n```\n\n今回は、MTで乱数を生成する際にも行列を用いて計算してみました。なのでとても遅いですね。\n\nちなみに、わざわざ行列を使わなくてもTemperingの逆演算をビット演算で高速に行うことも出来ます。\n\n[メルセンヌ・ツイスタのtemperingの逆関数に関する考察 - Plus Le Blog](http://plusletool.hatenablog.jp/entry/2014/10/24/213816)\n\n# MTはダメ？\n\n_わー！MTで作った乱数は予想・復元されちゃう！危ない！_\n\nというわけではなく、要は適材適所、その性質をよく理解して使うべき、ということでした。\n決して暗号用途に使っちゃダメですよ。（そういうCTF問題がどこかにありましたね……！）\n\n次は **xorshift** を調べてみようかな？\n","title":"メルセンヌ・ツイスタを倒す","image":null,"tags":["CTF","セキュリティ","メルセンヌ・ツイスタ","乱数"],"date":"2016-06-30T00:00:00.000Z","updated":"2021-01-07T09:09:45.000Z"},"description":"メルセンヌ・ツイスタの性質を理解したい。 この記事は前回の続きです。 メルセンヌ・ツイスタをわかった気になる 今日のテーマ 今日のテーマは、メルセンヌ・ツイスタ(MT)の性質についてです。 MTの生…","content":"<p>メルセンヌ・ツイスタの性質を理解したい。<p>この記事は前回の続きです。<aside><a href=/posts/5/ style=background-image:url(https://res.cloudinary.com/narusejun/image/twitter_name/h_128/sekai67.jpg)><div><strong>メルセンヌ・ツイスタをわかった気になる</strong><cite>6715.jp</cite><q cite=https://6715.jp/posts/5/>メルセンヌ・ツイスタについて。 メルセンヌ・ツイスタ(MT)は擬似乱数列を作るアルゴリズムの一つで、 他の手法と比べると欠点が少なくて高品質な擬似乱数列を高速に作れるんだって。スゴイ！ プログラムを…</q></div></a></aside><h2>今日のテーマ</h2><p>今日のテーマは、メルセンヌ・ツイスタ(MT)の性質についてです。<p>MTの生成する乱数列は、以下の線形漸化式で表わされるのでした。<div class=\"math math-display\"><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mtable columnalign=center columnspacing=1em rowspacing=0.15999999999999992em><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mrow><msub><mi mathvariant=bold>x</mi><mrow><mi>k</mi><mo>+</mo><mi>n</mi></mrow></msub><mtext> </mtext><mo>=</mo><mtext> </mtext><msub><mi mathvariant=bold>x</mi><mrow><mi>k</mi><mo>+</mo><mi>m</mi></mrow></msub><mo>⊕</mo><mo stretchy=false>(</mo><msubsup><mi mathvariant=bold>x</mi><mi>k</mi><mi>u</mi></msubsup><mtext> </mtext><mi mathvariant=normal>∣</mi><mtext> </mtext><msubsup><mi mathvariant=bold>x</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><mi>l</mi></msubsup><mo stretchy=false>)</mo><mi>A</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mrow><mo stretchy=false>(</mo><mi>k</mi><mo>=</mo><mn>0</mn><mo separator=true>,</mo><mn>1</mn><mo separator=true>,</mo><mo>⋯</mo><mtext> </mtext><mo stretchy=false>)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding=application/x-tex>\\begin{array}{c} \\mathbf{x}_{k+n} \\, = \\, \\mathbf{x}_{k+m} \\oplus ( \\mathbf{x}^u_k \\: | \\: \\mathbf{x}^l_{k+1} ) A \\\\ (k = 0,1, \\cdots) \\end{array}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:2.4091080000000007em;vertical-align:-.9545540000000006em></span><span class=mord><span class=mtable><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:1.4545540000000001em><span style=top:-3.605446em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class=mord><span class=\"mord mathbf\">x</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.3361079999999999em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\"><span class=\"mord mtight mathnormal\"style=margin-right:.03148em>k</span><span class=\"mtight mbin\">+</span><span class=\"mord mtight mathnormal\">n</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.208331em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.16666666666666666em></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mord><span class=mord><span class=\"mord mathbf\">x</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.3361079999999999em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\"><span class=\"mord mtight mathnormal\"style=margin-right:.03148em>k</span><span class=\"mtight mbin\">+</span><span class=\"mord mtight mathnormal\">m</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.208331em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>⊕</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mopen>(</span><span class=mord><span class=mord><span class=\"mord mathbf\">x</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.664392em><span style=top:-2.4168920000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight mathnormal\"style=margin-right:.03148em>k</span></span></span><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight mathnormal\">u</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.2831079999999999em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mord>∣</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mord><span class=mord><span class=\"mord mathbf\">x</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.849108em><span style=top:-2.4168920000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\"><span class=\"mord mtight mathnormal\"style=margin-right:.03148em>k</span><span class=\"mtight mbin\">+</span><span class=\"mord mtight\">1</span></span></span></span><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight mathnormal\"style=margin-right:.01968em>l</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.34143899999999994em><span></span></span></span></span></span></span><span class=mclose>)</span><span class=\"mord mathnormal\">A</span></span></span><span style=top:-2.405445999999999em><span class=pstrut style=height:3em></span><span class=mord><span class=mopen>(</span><span class=\"mord mathnormal\"style=margin-right:.03148em>k</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mord>0</span><span class=mpunct>,</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=mord>1</span><span class=mpunct>,</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=minner>⋯</span><span class=mspace style=margin-right:.16666666666666666em></span><span class=mclose>)</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.9545540000000006em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span></span></span></span></span></span></span></div><p>漸化式で表わされるということは、連続した生成された乱数をいくつか集めれば、その次に現れる数値が予測可能じゃないか！？！？！？？ また逆に、今まで生成された乱数値も復元できるんじゃないか！？！？？？！<p>ワクワクしますね！<h1>打倒Tempering</h1><p>さて、さっそく……といいたいところですが、そういえば乱数値はTemperingとかいう操作をしてから出力していましたね。 乱数を予測するには、コイツをどうにかしなければなりません。<p>前回はTempering行う行列<span class=\"math math-inline\"><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>T</mi></mrow><annotation encoding=application/x-tex>T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class=\"mord mathnormal\"style=margin-right:.13889em>T</span></span></span></span></span>は正則だから逆行列が求まるよね？みたいな話をして終わりました。<p>以下の様な謎のビット演算が<span class=\"math math-inline\"><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>T</mi></mrow><annotation encoding=application/x-tex>T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class=\"mord mathnormal\"style=margin-right:.13889em>T</span></span></span></span></span>を右から掛けることに相当する、というお話でしたが この<span class=\"math math-inline\"><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>T</mi></mrow><annotation encoding=application/x-tex>T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class=\"mord mathnormal\"style=margin-right:.13889em>T</span></span></span></span></span>がどんな行列なのかを調べることにしましょう。<div class=\"math math-display\"><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mtable columnalign=left columnspacing=1em rowspacing=0.15999999999999992em><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mrow><msub><mi mathvariant=bold>y</mi><mn>1</mn></msub><mo>=</mo><mi mathvariant=bold>x</mi><mo>⊕</mo><mo stretchy=false>(</mo><mi mathvariant=bold>x</mi><mo>≫</mo><mi>u</mi><mo stretchy=false>)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mrow><msub><mi mathvariant=bold>y</mi><mn>2</mn></msub><mo>=</mo><msub><mi mathvariant=bold>y</mi><mn>1</mn></msub><mo>⊕</mo><mo stretchy=false>(</mo><mo stretchy=false>(</mo><msub><mi mathvariant=bold>y</mi><mn>1</mn></msub><mo>≪</mo><mi>s</mi><mo stretchy=false>)</mo><mtext> </mtext><mi mathvariant=normal>&amp</mi><mtext> </mtext><mi mathvariant=bold>b</mi><mo stretchy=false>)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mrow><msub><mi mathvariant=bold>y</mi><mn>3</mn></msub><mo>=</mo><msub><mi mathvariant=bold>y</mi><mn>2</mn></msub><mo>⊕</mo><mo stretchy=false>(</mo><mo stretchy=false>(</mo><msub><mi mathvariant=bold>y</mi><mn>2</mn></msub><mo>≪</mo><mi>t</mi><mo stretchy=false>)</mo><mtext> </mtext><mi mathvariant=normal>&amp</mi><mtext> </mtext><mi mathvariant=bold>c</mi><mo stretchy=false>)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mrow><msub><mi mathvariant=bold>y</mi><mn>4</mn></msub><mo>=</mo><msub><mi mathvariant=bold>y</mi><mn>3</mn></msub><mo>⊕</mo><mo stretchy=false>(</mo><msub><mi mathvariant=bold>y</mi><mn>3</mn></msub><mo>≫</mo><mi>l</mi><mo stretchy=false>)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding=application/x-tex>\\begin{array}{l} \\mathbf{y}_1 = \\mathbf{x} \\oplus (\\mathbf{x} \\gg u) \\\\ \\mathbf{y}_2 = \\mathbf{y}_1 \\oplus ((\\mathbf{y}_1 \\ll s) \\: \\&#38 \\: \\mathbf{b}) \\\\ \\mathbf{y}_3 = \\mathbf{y}_2 \\oplus ((\\mathbf{y}_2 \\ll t) \\: \\&#38 \\: \\mathbf{c}) \\\\ \\mathbf{y}_4 = \\mathbf{y}_3 \\oplus (\\mathbf{y}_3 \\gg l) \\end{array}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:4.800000000000001em;vertical-align:-2.1500000000000004em></span><span class=mord><span class=mtable><span class=arraycolsep style=width:.5em></span><span class=col-align-l><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:2.6500000000000004em><span style=top:-4.8100000000000005em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mord><span class=\"mord mathbf\">x</span></span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>⊕</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mopen>(</span><span class=mord><span class=\"mord mathbf\">x</span></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>≫</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=\"mord mathnormal\">u</span><span class=mclose>)</span></span></span><span style=top:-3.61em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mord><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>⊕</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mopen>(</span><span class=mopen>(</span><span class=mord><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>≪</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=\"mord mathnormal\">s</span><span class=mclose>)</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mord>&amp</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mord><span class=\"mord mathbf\">b</span></span><span class=mclose>)</span></span></span><span style=top:-2.4099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">3</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mord><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>⊕</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mopen>(</span><span class=mopen>(</span><span class=mord><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>≪</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=\"mord mathnormal\">t</span><span class=mclose>)</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mord>&amp</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mord><span class=\"mord mathbf\">c</span></span><span class=mclose>)</span></span></span><span style=top:-1.2099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">4</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mord><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">3</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>⊕</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mopen>(</span><span class=mord><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">3</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>≫</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=\"mord mathnormal\"style=margin-right:.01968em>l</span><span class=mclose>)</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:2.1500000000000004em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span></span></span></span></span></span></span></div><p>そういえば前回、何の脈絡もなく整数を各ビットで分けて行ベクトルとしていましたが、 なんで行ベクトルを考えるのかというと、計算上都合がいいからです。 例えば、XOR演算はベクトル同士の加算で表現できますし、ビットシフトは適当な正方行列との積で表現できます。<p>あっ！じゃあ↑の式も一つ一つのビット演算が行列として表せるじゃん！！！<h2>ビットシフトの行列表現</h2><p>これはすぐに思いつきそうです。 単純に各要素をずらすだけなので、単位行列を列ベクトル分解して、それをずらしたものを掛ければよさそう。<p>例えば、8ビット整数について2ビットの右シフトを表す行列は以下になります。<div class=\"math math-display\"><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><msub><mi>S</mi><mn>8</mn></msub><mo>=</mo><mrow><mo fence=true>(</mo><mtable columnalign=\"center center center center center\"columnspacing=1em rowspacing=0.15999999999999992em><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>1</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>1</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>1</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>1</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>1</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence=true>)</mo></mrow></mrow><annotation encoding=application/x-tex>S_8 = \\left( \\begin{array}{ccccc} 0 &#38 0 &#38 1 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 \\\\ 0 &#38 0 &#38 0 &#38 1 &#38 0 &#38 0 &#38 0 &#38 0 \\\\ 0 &#38 0 &#38 0 &#38 0 &#38 1 &#38 0 &#38 0 &#38 0 \\\\ 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 1 &#38 0 &#38 0 \\\\ 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 1 &#38 0 \\\\ 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 1 \\\\ 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 \\\\ 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 \\end{array} \\right)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.83333em;vertical-align:-.15em></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.05764em>S</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">8</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2777777777777778em></span></span><span class=base><span class=strut style=height:9.60014em;vertical-align:-4.55007em></span><span class=minner><span class=mopen><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:5.050070000000001em><span style=top:.7500499999999996em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎝</span></span></span><span style=top:-.3999600000000005em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-.9949700000000007em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-1.5899800000000008em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-2.184990000000001em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-2.7800000000000007em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-3.3750100000000005em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-3.9700200000000003em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-4.56503em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-5.16004em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-5.755050000000001em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-5.81005em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-7.050070000000001em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎛</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:4.55007em><span></span></span></span></span></span></span><span class=mord><span class=mtable><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:5.050000000000001em><span style=top:-7.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-6.010000000000001em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-4.8100000000000005em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-3.61em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-2.4099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-1.2099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-.00999999999999951em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:1.1899999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:4.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:5.050000000000001em><span style=top:-7.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-6.010000000000001em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-4.8100000000000005em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-3.61em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-2.4099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-1.2099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-.00999999999999951em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:1.1899999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:4.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:5.050000000000001em><span style=top:-7.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>1</span></span></span><span style=top:-6.010000000000001em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-4.8100000000000005em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-3.61em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-2.4099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-1.2099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-.00999999999999951em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:1.1899999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:4.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:5.050000000000001em><span style=top:-7.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-6.010000000000001em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>1</span></span></span><span style=top:-4.8100000000000005em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-3.61em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-2.4099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-1.2099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-.00999999999999951em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:1.1899999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:4.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:5.050000000000001em><span style=top:-7.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-6.010000000000001em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-4.8100000000000005em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>1</span></span></span><span style=top:-3.61em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-2.4099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-1.2099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-.00999999999999951em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:1.1899999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:4.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:5.050000000000001em><span style=top:-7.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-6.010000000000001em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-4.8100000000000005em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-3.61em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>1</span></span></span><span style=top:-2.4099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-1.2099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-.00999999999999951em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:1.1899999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:4.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:5.050000000000001em><span style=top:-7.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-6.010000000000001em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-4.8100000000000005em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-3.61em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-2.4099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>1</span></span></span><span style=top:-1.2099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-.00999999999999951em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:1.1899999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:4.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:5.050000000000001em><span style=top:-7.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-6.010000000000001em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-4.8100000000000005em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-3.61em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-2.4099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-1.2099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>1</span></span></span><span style=top:-.00999999999999951em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:1.1899999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:4.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span></span></span><span class=mclose><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:5.050070000000001em><span style=top:.7500499999999996em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎠</span></span></span><span style=top:-.3999600000000005em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-.9949700000000007em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-1.5899800000000008em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-2.184990000000001em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-2.7800000000000007em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-3.3750100000000005em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-3.9700200000000003em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-4.56503em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-5.16004em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-5.755050000000001em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-5.81005em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-7.050070000000001em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎞</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:4.55007em><span></span></span></span></span></span></span></span></span></span></span></span></div><p>この記事中では、<span class=\"math math-inline\"><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>S</mi><mi>n</mi></msub></mrow><annotation encoding=application/x-tex>S_n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.83333em;vertical-align:-.15em></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.05764em>S</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.151392em><span style=top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight mathnormal\">n</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span></span>をビットシフトを表す行列とします ただし、<span class=\"math math-inline\"><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>n</mi><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding=application/x-tex>n &#60 0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5782em;vertical-align:-.0391em></span><span class=\"mord mathnormal\">n</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>&lt;</span><span class=mspace style=margin-right:.2777777777777778em></span></span><span class=base><span class=strut style=height:.64444em;vertical-align:0></span><span class=mord>0</span></span></span></span></span>のとき<span class=\"math math-inline\"><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi mathvariant=normal>∣</mi><mi>n</mi><mi mathvariant=normal>∣</mi></mrow><annotation encoding=application/x-tex>|n|</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord>∣</span><span class=\"mord mathnormal\">n</span><span class=mord>∣</span></span></span></span></span>ビット左シフトを、<span class=\"math math-inline\"><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>n</mi><mo>></mo><mn>0</mn></mrow><annotation encoding=application/x-tex>n > 0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.5782em;vertical-align:-.0391em></span><span class=\"mord mathnormal\">n</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>></span><span class=mspace style=margin-right:.2777777777777778em></span></span><span class=base><span class=strut style=height:.64444em;vertical-align:0></span><span class=mord>0</span></span></span></span></span>のとき<span class=\"math math-inline\"><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>n</mi></mrow><annotation encoding=application/x-tex>n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.43056em;vertical-align:0></span><span class=\"mord mathnormal\">n</span></span></span></span></span>ビット右シフトを表すとします。<h2>ANDの行列表現</h2><p>これは対角成分がAND演算する整数の各ビットの値になった正方行列を考えれば良いです。 例えば、8ビット整数について<code>178 = 0b10110010</code>とのANDを表す行列は以下のように書けます。<div class=\"math math-display\"><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><msub><mi>D</mi><mn>178</mn></msub><mo>=</mo><mrow><mo fence=true>(</mo><mtable columnalign=\"center center center center center\"columnspacing=1em rowspacing=0.15999999999999992em><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mn>1</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>1</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>1</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>1</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence=true>)</mo></mrow></mrow><annotation encoding=application/x-tex>D_{178} = \\left( \\begin{array}{ccccc} 1 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 \\\\ 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 \\\\ 0 &#38 0 &#38 1 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 \\\\ 0 &#38 0 &#38 0 &#38 1 &#38 0 &#38 0 &#38 0 &#38 0 \\\\ 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 \\\\ 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 \\\\ 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 1 &#38 0 \\\\ 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 &#38 0 \\end{array} \\right)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.83333em;vertical-align:-.15em></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.02778em>D</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mtight\">7</span><span class=\"mord mtight\">8</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2777777777777778em></span></span><span class=base><span class=strut style=height:9.60014em;vertical-align:-4.55007em></span><span class=minner><span class=mopen><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:5.050070000000001em><span style=top:.7500499999999996em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎝</span></span></span><span style=top:-.3999600000000005em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-.9949700000000007em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-1.5899800000000008em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-2.184990000000001em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-2.7800000000000007em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-3.3750100000000005em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-3.9700200000000003em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-4.56503em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-5.16004em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-5.755050000000001em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-5.81005em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-7.050070000000001em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎛</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:4.55007em><span></span></span></span></span></span></span><span class=mord><span class=mtable><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:5.050000000000001em><span style=top:-7.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>1</span></span></span><span style=top:-6.010000000000001em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-4.8100000000000005em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-3.61em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-2.4099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-1.2099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-.00999999999999951em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:1.1899999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:4.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:5.050000000000001em><span style=top:-7.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-6.010000000000001em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-4.8100000000000005em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-3.61em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-2.4099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-1.2099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-.00999999999999951em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:1.1899999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:4.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:5.050000000000001em><span style=top:-7.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-6.010000000000001em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-4.8100000000000005em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>1</span></span></span><span style=top:-3.61em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-2.4099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-1.2099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-.00999999999999951em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:1.1899999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:4.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:5.050000000000001em><span style=top:-7.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-6.010000000000001em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-4.8100000000000005em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-3.61em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>1</span></span></span><span style=top:-2.4099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-1.2099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-.00999999999999951em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:1.1899999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:4.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:5.050000000000001em><span style=top:-7.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-6.010000000000001em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-4.8100000000000005em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-3.61em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-2.4099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-1.2099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-.00999999999999951em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:1.1899999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:4.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:5.050000000000001em><span style=top:-7.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-6.010000000000001em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-4.8100000000000005em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-3.61em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-2.4099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-1.2099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-.00999999999999951em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:1.1899999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:4.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:5.050000000000001em><span style=top:-7.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-6.010000000000001em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-4.8100000000000005em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-3.61em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-2.4099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-1.2099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-.00999999999999951em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>1</span></span></span><span style=top:1.1899999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:4.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:5.050000000000001em><span style=top:-7.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-6.010000000000001em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-4.8100000000000005em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-3.61em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-2.4099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-1.2099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-.00999999999999951em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:1.1899999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:4.55em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span></span></span><span class=mclose><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:5.050070000000001em><span style=top:.7500499999999996em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎠</span></span></span><span style=top:-.3999600000000005em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-.9949700000000007em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-1.5899800000000008em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-2.184990000000001em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-2.7800000000000007em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-3.3750100000000005em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-3.9700200000000003em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-4.56503em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-5.16004em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-5.755050000000001em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-5.81005em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-7.050070000000001em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎞</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:4.55007em><span></span></span></span></span></span></span></span></span></span></span></span></div><p>対角に<code>10110010</code>が現れています。 なんでコレがAND演算を表すのかは、左から適当な行ベクトルを掛けて、手で計算してみればすぐにわかるはずです。<p>この記事中では、<span class=\"math math-inline\"><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>D</mi><mi>n</mi></msub></mrow><annotation encoding=application/x-tex>D_n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.83333em;vertical-align:-.15em></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.02778em>D</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.151392em><span style=top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight mathnormal\">n</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span></span>を<span class=\"math math-inline\"><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>n</mi></mrow><annotation encoding=application/x-tex>n</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.43056em;vertical-align:0></span><span class=\"mord mathnormal\">n</span></span></span></span></span>とのAND演算を表す行列とします。<h2>XORの行列表現</h2><p><code>A = 0b1001, B = 0b1001</code>としたとき、<code>A xor B</code>を考えてみます。<table><thead><tr><th align=center>A<th align=center>B<th align=center>A xor B<tbody><tr><td align=center>1<td align=center>0<td align=center>1<tr><td align=center>0<td align=center>1<td align=center>1<tr><td align=center>0<td align=center>0<td align=center>0<tr><td align=center>1<td align=center>1<td align=center>0</table><p>各ビットについて見ると、1ビット同士の加算になっています。（桁があふれた分は無視です。） ということはどうやら、2つの整数のXOR演算は、それら整数を表す行ベクトルを単純に加算するだけで良さそうです。<h2>Temperingの逆演算</h2><p>さて、材料は揃いました。 さっそく、Temperingの逆演算を表す行列を求めるとしましょう。<p>例のビット演算で書かれた式を行列で表してみます。<div class=\"math math-display\"><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mtable columnalign=left columnspacing=1em rowspacing=0.15999999999999992em><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mrow><msub><mi mathvariant=bold>y</mi><mn>1</mn></msub><mo>=</mo><mi mathvariant=bold>x</mi><mo>+</mo><mi mathvariant=bold>x</mi><msub><mi>S</mi><mi>u</mi></msub><mo>=</mo><mi mathvariant=bold>x</mi><mo stretchy=false>(</mo><mi>I</mi><mo>+</mo><msub><mi>S</mi><mi>u</mi></msub><mo stretchy=false>)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mrow><msub><mi mathvariant=bold>y</mi><mn>2</mn></msub><mo>=</mo><msub><mi mathvariant=bold>y</mi><mn>1</mn></msub><mo>+</mo><msub><mi mathvariant=bold>y</mi><mn>1</mn></msub><msub><mi>S</mi><mrow><mo>−</mo><mi>s</mi></mrow></msub><msub><mi>D</mi><mi>b</mi></msub><mo>=</mo><msub><mi mathvariant=bold>y</mi><mn>1</mn></msub><mo stretchy=false>(</mo><mi>I</mi><mo>+</mo><msub><mi>S</mi><mrow><mo>−</mo><mi>s</mi></mrow></msub><msub><mi>D</mi><mi>b</mi></msub><mo stretchy=false>)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mrow><msub><mi mathvariant=bold>y</mi><mn>3</mn></msub><mo>=</mo><msub><mi mathvariant=bold>y</mi><mn>2</mn></msub><mo>+</mo><msub><mi mathvariant=bold>y</mi><mn>2</mn></msub><msub><mi>S</mi><mrow><mo>−</mo><mi>t</mi></mrow></msub><msub><mi>D</mi><mi>c</mi></msub><mo>=</mo><msub><mi mathvariant=bold>y</mi><mn>2</mn></msub><mo stretchy=false>(</mo><mi>I</mi><mo>+</mo><msub><mi>S</mi><mrow><mo>−</mo><mi>t</mi></mrow></msub><msub><mi>D</mi><mi>c</mi></msub><mo stretchy=false>)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mrow><msub><mi mathvariant=bold>y</mi><mn>4</mn></msub><mo>=</mo><msub><mi mathvariant=bold>y</mi><mn>3</mn></msub><mo>+</mo><msub><mi mathvariant=bold>y</mi><mn>3</mn></msub><msub><mi>S</mi><mi>l</mi></msub><mo>=</mo><msub><mi mathvariant=bold>y</mi><mn>3</mn></msub><mo stretchy=false>(</mo><mi>I</mi><mo>+</mo><msub><mi>S</mi><mi>l</mi></msub><mo stretchy=false>)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding=application/x-tex>\\begin{array}{l} \\mathbf{y}_1 = \\mathbf{x} + \\mathbf{x} S_u = \\mathbf{x} (I + S_u) \\\\ \\mathbf{y}_2 = \\mathbf{y}_1 + \\mathbf{y}_1 S_{-s} D_b = \\mathbf{y}_1 ( I + S_{-s} D_b ) \\\\ \\mathbf{y}_3 = \\mathbf{y}_2 + \\mathbf{y}_2 S_{-t} D_c = \\mathbf{y}_2 ( I + S_{-t} D_c ) \\\\ \\mathbf{y}_4 = \\mathbf{y}_3 + \\mathbf{y}_3 S_l = \\mathbf{y}_3 ( I + S_l ) \\end{array}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:4.800000000000001em;vertical-align:-2.1500000000000004em></span><span class=mord><span class=mtable><span class=arraycolsep style=width:.5em></span><span class=col-align-l><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:2.6500000000000004em><span style=top:-4.8100000000000005em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mord><span class=\"mord mathbf\">x</span></span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mord><span class=\"mord mathbf\">x</span></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.05764em>S</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.151392em><span style=top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight mathnormal\">u</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mord><span class=\"mord mathbf\">x</span></span><span class=mopen>(</span><span class=\"mord mathnormal\"style=margin-right:.07847em>I</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.05764em>S</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.151392em><span style=top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight mathnormal\">u</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span><span style=top:-3.61em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mord><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mord><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.05764em>S</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.25833100000000003em><span style=top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight mathnormal\">s</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.208331em><span></span></span></span></span></span></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.02778em>D</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.33610799999999996em><span style=top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight mathnormal\">b</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mord><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">1</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mopen>(</span><span class=\"mord mathnormal\"style=margin-right:.07847em>I</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.05764em>S</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.25833100000000003em><span style=top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight mathnormal\">s</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.208331em><span></span></span></span></span></span></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.02778em>D</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.33610799999999996em><span style=top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight mathnormal\">b</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span><span style=top:-2.4099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">3</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mord><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mord><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.05764em>S</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.28055599999999997em><span style=top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight mathnormal\">t</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.208331em><span></span></span></span></span></span></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.02778em>D</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.151392em><span style=top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight mathnormal\">c</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mord><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">2</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mopen>(</span><span class=\"mord mathnormal\"style=margin-right:.07847em>I</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.05764em>S</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.28055599999999997em><span style=top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight mathnormal\">t</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.208331em><span></span></span></span></span></span></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.02778em>D</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.151392em><span style=top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight mathnormal\">c</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span><span style=top:-1.2099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">4</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mord><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">3</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mord><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">3</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.05764em>S</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.33610799999999996em><span style=top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight mathnormal\"style=margin-right:.01968em>l</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mord><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">3</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mopen>(</span><span class=\"mord mathnormal\"style=margin-right:.07847em>I</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.05764em>S</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.33610799999999996em><span style=top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight mathnormal\"style=margin-right:.01968em>l</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:2.1500000000000004em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span></span></span></span></span></span></span></div><p>で、式が4本もあると面倒ですし、1つにまとめてしまいましょう。<div class=\"math math-display\"><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><mi mathvariant=bold>y</mi><mo>=</mo><mi mathvariant=bold>x</mi><mo stretchy=false>(</mo><mi>I</mi><mo>+</mo><msub><mi>S</mi><mi>u</mi></msub><mo stretchy=false>)</mo><mo stretchy=false>(</mo><mi>I</mi><mo>+</mo><msub><mi>S</mi><mrow><mo>−</mo><mi>s</mi></mrow></msub><msub><mi>D</mi><mi>b</mi></msub><mo stretchy=false>)</mo><mo stretchy=false>(</mo><mi>I</mi><mo>+</mo><msub><mi>S</mi><mrow><mo>−</mo><mi>t</mi></mrow></msub><msub><mi>D</mi><mi>c</mi></msub><mo stretchy=false>)</mo><mo stretchy=false>(</mo><mi>I</mi><mo>+</mo><msub><mi>S</mi><mi>l</mi></msub><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>\\mathbf{y} = \\mathbf{x} (I + S_u) ( I + S_{-s} D_b ) ( I + S_{-t} D_c ) ( I + S_l )</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.63888em;vertical-align:-.19444em></span><span class=mord><span class=\"mord mathbf\"style=margin-right:.01597em>y</span></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2777777777777778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class=\"mord mathbf\">x</span></span><span class=mopen>(</span><span class=\"mord mathnormal\"style=margin-right:.07847em>I</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.05764em>S</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.151392em><span style=top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight mathnormal\">u</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span><span class=mopen>(</span><span class=\"mord mathnormal\"style=margin-right:.07847em>I</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.05764em>S</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.25833100000000003em><span style=top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight mathnormal\">s</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.208331em><span></span></span></span></span></span></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.02778em>D</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.33610799999999996em><span style=top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight mathnormal\">b</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span><span class=mopen>(</span><span class=\"mord mathnormal\"style=margin-right:.07847em>I</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.05764em>S</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.28055599999999997em><span style=top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight mathnormal\">t</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.208331em><span></span></span></span></span></span></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.02778em>D</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.151392em><span style=top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight mathnormal\">c</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span><span class=mopen>(</span><span class=\"mord mathnormal\"style=margin-right:.07847em>I</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.05764em>S</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.33610799999999996em><span style=top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight mathnormal\"style=margin-right:.01968em>l</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span></span></div><p>ということで、ようやく<span class=\"math math-inline\"><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>T</mi></mrow><annotation encoding=application/x-tex>T</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class=\"mord mathnormal\"style=margin-right:.13889em>T</span></span></span></span></span>の本性が分かりました。<div class=\"math math-display\"><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><mi>T</mi><mo>=</mo><mo stretchy=false>(</mo><mi>I</mi><mo>+</mo><msub><mi>S</mi><mi>u</mi></msub><mo stretchy=false>)</mo><mo stretchy=false>(</mo><mi>I</mi><mo>+</mo><msub><mi>S</mi><mrow><mo>−</mo><mi>s</mi></mrow></msub><msub><mi>D</mi><mi>b</mi></msub><mo stretchy=false>)</mo><mo stretchy=false>(</mo><mi>I</mi><mo>+</mo><msub><mi>S</mi><mrow><mo>−</mo><mi>t</mi></mrow></msub><msub><mi>D</mi><mi>c</mi></msub><mo stretchy=false>)</mo><mo stretchy=false>(</mo><mi>I</mi><mo>+</mo><msub><mi>S</mi><mi>l</mi></msub><mo stretchy=false>)</mo></mrow><annotation encoding=application/x-tex>T = (I + S_u) ( I + S_{-s} D_b ) ( I + S_{-t} D_c ) ( I + S_l )</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class=\"mord mathnormal\"style=margin-right:.13889em>T</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2777777777777778em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mopen>(</span><span class=\"mord mathnormal\"style=margin-right:.07847em>I</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.05764em>S</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.151392em><span style=top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight mathnormal\">u</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span><span class=mopen>(</span><span class=\"mord mathnormal\"style=margin-right:.07847em>I</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.05764em>S</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.25833100000000003em><span style=top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight mathnormal\">s</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.208331em><span></span></span></span></span></span></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.02778em>D</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.33610799999999996em><span style=top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight mathnormal\">b</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span><span class=mopen>(</span><span class=\"mord mathnormal\"style=margin-right:.07847em>I</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.05764em>S</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.28055599999999997em><span style=top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight mathnormal\">t</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.208331em><span></span></span></span></span></span></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.02778em>D</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.151392em><span style=top:-2.5500000000000003em;margin-left:-.02778em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight mathnormal\">c</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span><span class=mopen>(</span><span class=\"mord mathnormal\"style=margin-right:.07847em>I</span><span class=mspace style=margin-right:.2222222222222222em></span><span class=mbin>+</span><span class=mspace style=margin-right:.2222222222222222em></span></span><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.05764em>S</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.33610799999999996em><span style=top:-2.5500000000000003em;margin-left:-.05764em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight mathnormal\"style=margin-right:.01968em>l</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span><span class=mclose>)</span></span></span></span></span></div><p>で、コイツの逆行列<span class=\"math math-inline\"><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msup><mi>T</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=application/x-tex>T^{-1}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8141079999999999em;vertical-align:0></span><span class=mord><span class=\"mord mathnormal\"style=margin-right:.13889em>T</span><span class=msupsub><span class=vlist-t><span class=vlist-r><span class=vlist style=height:.8141079999999999em><span style=top:-3.063em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span></span>を求めれば、それがTemperingの逆演算を表す行列です。<h1>乱数を予想する</h1><p>さて、Temperingの逆演算ができれば、話は早いですね！<p>前回作ったプログラムの <em>MT内部状態</em> を表す配列を、先ほどの手順で復元した値N個で埋めてやれば、 あとは前回説明した計算方法に従って次に出現する乱数を計算することが出来ます。やった！<h1>乱数を復元する</h1><p>じゃあ、今まで作られたであろう乱数を復元するには？<p>とりあえず内部状態<span class=\"math math-inline\"><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi mathvariant=bold>x</mi></mrow><annotation encoding=application/x-tex>\\mathbf{x}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.44444em;vertical-align:0></span><span class=mord><span class=\"mord mathbf\">x</span></span></span></span></span></span>をまず復元しなければならないワケですが、 MTの漸化式を見ると、<span class=\"math math-inline\"><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>x</mi><mi>k</mi></msub></mrow><annotation encoding=application/x-tex>x_k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.58056em;vertical-align:-.15em></span><span class=mord><span class=\"mord mathnormal\">x</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.33610799999999996em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight mathnormal\"style=margin-right:.03148em>k</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span></span>の上位ビットが<span class=\"math math-inline\"><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>x</mi><mrow><mi>k</mi><mo>+</mo><mi>n</mi></mrow></msub></mrow><annotation encoding=application/x-tex>x_{k+n}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.638891em;vertical-align:-.208331em></span><span class=mord><span class=\"mord mathnormal\">x</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.3361079999999999em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\"><span class=\"mord mtight mathnormal\"style=margin-right:.03148em>k</span><span class=\"mtight mbin\">+</span><span class=\"mord mtight mathnormal\">n</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.208331em><span></span></span></span></span></span></span></span></span></span></span>の、下位ビットが<span class=\"math math-inline\"><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>x</mi><mrow><mi>k</mi><mo>+</mo><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding=application/x-tex>x_{k+n-1}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.638891em;vertical-align:-.208331em></span><span class=mord><span class=\"mord mathnormal\">x</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.3361079999999999em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\"><span class=\"mord mtight mathnormal\"style=margin-right:.03148em>k</span><span class=\"mtight mbin\">+</span><span class=\"mord mtight mathnormal\">n</span><span class=\"mtight mbin\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.208331em><span></span></span></span></span></span></span></span></span></span></span>の計算に使われてるなーって気が付くとおもいます。<p>じゃあ、その計算の逆をやれば、<span class=\"math math-inline\"><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>x</mi><mi>k</mi></msub></mrow><annotation encoding=application/x-tex>x_k</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.58056em;vertical-align:-.15em></span><span class=mord><span class=\"mord mathnormal\">x</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.33610799999999996em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight mathnormal\"style=margin-right:.03148em>k</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span></span>が復元できるネ！っていうお話です。 幸い、漸化式中に現れる演算はさっきやったXOR演算と、既に中身が分かっている行列<span class=\"math math-inline\"><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mi>A</mi></mrow><annotation encoding=application/x-tex>A</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class=\"mord mathnormal\">A</span></span></span></span></span>の乗算だけです！<p>Aはこんな行列なのでした。<div class=\"math math-display\"><span class=katex-display><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML display=block><semantics><mrow><mi>A</mi><mo>=</mo><mrow><mo fence=true>(</mo><mtable columnalign=\"center center center center center\"columnspacing=1em rowspacing=0.15999999999999992em><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>1</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>1</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mo lspace=0em rspace=0em>⋱</mo></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle=false scriptlevel=0><msub><mi>a</mi><mrow><mi>w</mi><mo>−</mo><mn>1</mn></mrow></msub></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><msub><mi>a</mi><mrow><mi>w</mi><mo>−</mo><mn>2</mn></mrow></msub></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mo lspace=0em rspace=0em>⋯</mo></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><mo lspace=0em rspace=0em>⋯</mo></mstyle></mtd><mtd><mstyle displaystyle=false scriptlevel=0><msub><mi>a</mi><mn>0</mn></msub></mstyle></mtd></mtr></mtable><mo fence=true>)</mo></mrow></mrow><annotation encoding=application/x-tex>A = \\left( \\begin{array}{ccccc} 0 &#38 1 &#38 0 &#38 0 &#38 0 \\\\ 0 &#38 0 &#38 1 &#38 0 &#38 0 \\\\ 0 &#38 0 &#38 0 &#38 \\ddots &#38 0 \\\\ 0 &#38 0 &#38 0 &#38 0 &#38 1 \\\\ a_{w-1} &#38 a_{w-2} &#38 \\cdots &#38 \\cdots &#38 a_0 \\end{array} \\right)</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.68333em;vertical-align:0></span><span class=\"mord mathnormal\">A</span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel>=</span><span class=mspace style=margin-right:.2777777777777778em></span></span><span class=base><span class=strut style=height:6.00008em;vertical-align:-2.75004em></span><span class=minner><span class=mopen><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:3.25004em><span style=top:-1.0499800000000006em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎝</span></span></span><span style=top:-2.1999900000000006em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-2.7950000000000004em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-3.39001em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-3.98502em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-4.01002em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎜</span></span></span><span style=top:-5.250039999999999em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎛</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:2.75004em><span></span></span></span></span></span></span><span class=mord><span class=mtable><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:3.2500000000000004em><span style=top:-5.410000000000001em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-1.8099999999999998em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-.6099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class=\"mord mathnormal\">a</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.301108em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\"><span class=\"mord mtight mathnormal\"style=margin-right:.02691em>w</span><span class=\"mtight mbin\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.208331em><span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:2.7500000000000004em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:3.2500000000000004em><span style=top:-5.410000000000001em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>1</span></span></span><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-1.8099999999999998em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-.6099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class=\"mord mathnormal\">a</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.301108em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\"><span class=\"mord mtight mathnormal\"style=margin-right:.02691em>w</span><span class=\"mtight mbin\">−</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.208331em><span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:2.7500000000000004em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:3.2500000000000004em><span style=top:-5.410000000000001em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>1</span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-1.8099999999999998em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-.6099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=minner>⋯</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:2.7500000000000004em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:3.2500000000000004em><span style=top:-5.410000000000001em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class=minner>⋱</span></span></span><span style=top:-1.8099999999999998em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-.6099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=minner>⋯</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:2.7500000000000004em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span><span class=arraycolsep style=width:.5em></span><span class=col-align-c><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:3.2500000000000004em><span style=top:-5.410000000000001em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-4.21em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-3.01em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>0</span></span></span><span style=top:-1.8099999999999998em><span class=pstrut style=height:3em></span><span class=mord><span class=mord>1</span></span></span><span style=top:-.6099999999999997em><span class=pstrut style=height:3em></span><span class=mord><span class=mord><span class=\"mord mathnormal\">a</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.30110799999999993em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\">0</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:2.7500000000000004em><span></span></span></span></span></span><span class=arraycolsep style=width:.5em></span></span></span><span class=mclose><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:3.25004em><span style=top:-1.0499800000000006em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎠</span></span></span><span style=top:-2.1999900000000006em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-2.7950000000000004em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-3.39001em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-3.98502em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-4.01002em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎟</span></span></span><span style=top:-5.250039999999999em><span class=pstrut style=height:3.1550000000000002em></span><span class=\"delim-size4 delimsizinginner\"><span>⎞</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:2.75004em><span></span></span></span></span></span></span></span></span></span></span></span></div><p>この定義を見ると、<span class=\"math math-inline\"><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>a</mi><mrow><mi>w</mi><mo>−</mo><mn>1</mn></mrow></msub><mo mathvariant=normal>≠</mo><mn>0</mn></mrow><annotation encoding=application/x-tex>a_{w-1} \\ne 0</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.902771em;vertical-align:-.208331em></span><span class=mord><span class=\"mord mathnormal\">a</span><span class=msupsub><span class=\"vlist-t vlist-t2\"><span class=vlist-r><span class=vlist style=height:.301108em><span style=top:-2.5500000000000003em;margin-left:0;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class=\"mtight reset-size6 size3 sizing\"><span class=\"mord mtight\"><span class=\"mord mtight mathnormal\"style=margin-right:.02691em>w</span><span class=\"mtight mbin\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.208331em><span></span></span></span></span></span></span><span class=mspace style=margin-right:.2777777777777778em></span><span class=mrel><span class=mrel><span class=\"mord vbox\"><span class=thinbox><span class=rlap><span class=strut style=height:.8888799999999999em;vertical-align:-.19444em></span><span class=inner><span class=mrel></span></span><span class=fix></span></span></span></span></span><span class=mrel>=</span></span><span class=mspace style=margin-right:.2777777777777778em></span></span><span class=base><span class=strut style=height:.64444em;vertical-align:0></span><span class=mord>0</span></span></span></span></span>ならば明らかに正則ですねコレ。 MT19937では↑を満たしますし、逆行列も求まりますね！<p>元の<a href=http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/ARTICLES/mt.pdf rel=\"noopener noreferrer\"target=_blank>論文</a>には、高速に計算するためにこの形にするって書いてあるんですけど、 コレ正則じゃなくても良いのかな？そうだとすると逆演算ができない？？？（知らない）<h1>やってみよう！</h1><p>早速やりましょう。 とりあえず、前回作ったプログラムで生成した乱数をファイルに書き出して、それを入力して、その部分乱数列から全体を復元しましょう。<p>はい、やり方はさっきまでさんざん書いたとおりなので、サクッと実装します。 今回もRubyです。<pre><code class=\"hljs language-ruby\"><span class=hljs-keyword>require</span> <span class=hljs-string>\"matrix\"</span>\n\n<span class=hljs-comment># MT19937</span>\nW = <span class=hljs-number>32</span>\nN = <span class=hljs-number>624</span>\nM = <span class=hljs-number>397</span>\nR = <span class=hljs-number>31</span>\nU = <span class=hljs-number>11</span>\nS = <span class=hljs-number>7</span>\nT = <span class=hljs-number>15</span>\nL = <span class=hljs-number>18</span>\nA = <span class=hljs-number>0x9908B0DF</span>\nB = <span class=hljs-number>0x9D2C5680</span>\nC = <span class=hljs-number>0xEFC60000</span>\n\n<span class=hljs-comment># ビットマスク用</span>\nWHOLE_MASK = (<span class=hljs-string>\"1\"</span> * W).to_i(<span class=hljs-number>2</span>)\nUPPER_MASK = (<span class=hljs-string>\"1\"</span> * (W - R) + <span class=hljs-string>\"0\"</span> * R).to_i(<span class=hljs-number>2</span>)\nLOWER_MASK = (<span class=hljs-string>\"0\"</span> * (W - R) + <span class=hljs-string>\"1\"</span> * R).to_i(<span class=hljs-number>2</span>)\n\n<span class=hljs-comment># ビット行列</span>\n<span class=hljs-class><span class=hljs-keyword>class</span> <span class=hljs-title>BitMat</span> &#60 Matrix</span>\n\t<span class=hljs-comment># 行ベクトルを整数に</span>\n\t<span class=hljs-function><span class=hljs-keyword>def</span> <span class=hljs-title>to_i</span></span>\n\t\t<span class=hljs-comment># mod 2 しないとダメ</span>\n\t\t<span class=hljs-keyword>self</span>.row(<span class=hljs-number>0</span>).to_a.map{<span class=hljs-params>|i|</span> i.to_i.abs % <span class=hljs-number>2</span> }.join.to_i(<span class=hljs-number>2</span>)\n\t<span class=hljs-keyword>end</span>\n\t<span class=hljs-comment># 整数を行ベクトルに</span>\n\tdef <span class=hljs-keyword>self</span>.from_i(i)\n\t\t<span class=hljs-keyword>self</span>[format(<span class=hljs-string>\"%.\"</span> + W.to_s + <span class=hljs-string>\"b\"</span>, i).split(<span class=hljs-string>\"\"</span>).map(&amp<span class=hljs-symbol>:to_i</span>)]\n\t<span class=hljs-keyword>end</span>\n\n\t<span class=hljs-comment># kだけビットシフトする演算を表す行列を生成 (k > 0 : 右シフト, k &#60 0 : 左シフト)</span>\n\tdef <span class=hljs-keyword>self</span>.Shift(k)\n\t\t<span class=hljs-keyword>self</span>[ *(<span class=hljs-number>1</span>..W).map{<span class=hljs-params>|i|</span> (<span class=hljs-number>1</span>..W).map{<span class=hljs-params>|j|</span> j == i+k ? <span class=hljs-number>1</span> : <span class=hljs-number>0</span> } } ]\n\t<span class=hljs-keyword>end</span>\n\t<span class=hljs-comment># kとのAND演算を表す行列を生成</span>\n\tdef <span class=hljs-keyword>self</span>.And(k)\n\t\t<span class=hljs-keyword>self</span>.diagonal(*<span class=hljs-keyword>self</span>.from_i(k).row(<span class=hljs-number>0</span>).to_a)\n\t<span class=hljs-keyword>end</span>\n\n\t<span class=hljs-comment># r行目を行ベクトルvで置き換え</span>\n\t<span class=hljs-function><span class=hljs-keyword>def</span> <span class=hljs-title>[]=</span><span class=hljs-params>(r, v)</span></span>\n\t\t<span class=hljs-variable>@rows</span>[r] = v.row(<span class=hljs-number>0</span>).to_a\n\t<span class=hljs-keyword>end</span>\n<span class=hljs-keyword>end</span>\n\n<span class=hljs-comment>########################################</span>\n\n<span class=hljs-comment># 行列T</span>\nt = (\n\t(BitMat.I(W) + BitMat.Shift( U)) *\n\t(BitMat.I(W) + BitMat.Shift(-S) * BitMat.And(B)) *\n\t(BitMat.I(W) + BitMat.Shift(-T) * BitMat.And(C)) *\n\t(BitMat.I(W) + BitMat.Shift( L))\n)\n<span class=hljs-comment># Tの逆行列</span>\nt_inv = t ** -<span class=hljs-number>1</span>\n\n<span class=hljs-comment># 行列A</span>\na = BitMat.Shift(<span class=hljs-number>1</span>)\na[W-<span class=hljs-number>1</span>] = BitMat.from_i(A)\n<span class=hljs-comment># Aの逆行列</span>\na_inv = a ** -<span class=hljs-number>1</span>\n\n<span class=hljs-comment># 乱数列を読み込む</span>\ninput = []\n<span class=hljs-keyword>while</span> line = gets\n\tinput.push(<span class=hljs-variable>$1</span>.to_i) <span class=hljs-keyword>if</span> /^\\d+: (\\d+)<span class=hljs-variable>$/</span> =~ line\n<span class=hljs-keyword>end</span>\n\n<span class=hljs-comment># E番目からN個だけの乱数を使う</span>\nE = input.length / <span class=hljs-number>3</span>\n\nprint <span class=hljs-string>\"USE: \"</span> + E.to_s + <span class=hljs-string>\" -> \"</span> + (E + N - <span class=hljs-number>1</span>).to_s + <span class=hljs-string>\"\\n\"</span>;\n\n<span class=hljs-comment># E番目～E+N-1番目の乱数を取得し、Temperingの逆演算をする</span>\nxr = input[E, N].map{<span class=hljs-params>|e|</span> (BitMat.from_i(e) * t_inv).to_i }\n\n<span class=hljs-comment># 内部状態</span>\nx = xr.dup\n\n<span class=hljs-comment># E+N番目から順に乱数列を復元</span>\n(E + N).upto(input.length - <span class=hljs-number>1</span>) <span class=hljs-keyword>do</span> <span class=hljs-params>|k|</span>\n\ti = (k - E) % N\n\n\t<span class=hljs-comment># 乱数を計算</span>\n\tz = x[i] &#38 UPPER_MASK <span class=hljs-params>| x[(i + 1) % N] &#38 LOWER_MASK\n\tx[i] = x[(i + M) % N] ^ (BitMat.from_i(z) * a).to_i\n\n\t# Temperingして一致するか確認\n\ty = (BitMat.from_i(x[i]) * t).to_i\n\t<span class=hljs-keyword>if</span> y != input[k]\n\t\tabort \"FAIL: \" + k.to_s + \"\\n\";\n\t<span class=hljs-keyword>end</span>\n<span class=hljs-keyword>end</span>\n\nprint \"RETRIEVED: \" + (E + N).to_s + \" -> \", input.length - 1,\"\\n\";\n\n# 内部状態\nx = xr.dup\n\n# E-1番目から順に0番目までの乱数列を復元\n(E - 1).downto(0) <span class=hljs-keyword>do</span> |</span>k<span class=hljs-params>|\n\ti = (k - E) % N\n\n\t# z_i を復元\n\tz = (BitMat.from_i(x[i] ^ x[(i + M) % N]) * a_inv).to_i\n\n\t# z_{i-1} を復元\n\tzp = (BitMat.from_i(x[(i - 1 + N) % N] ^ x[(i - 1 + M) % N]) * a_inv).to_i\n\n\t# z_i, z_{i-1} から x[i] を復元\n\tx[i] = z &#38 UPPER_MASK |</span> zp &#38 LOWER_MASK\n\n\t<span class=hljs-comment># Temperingして一致するか確認</span>\n\ty = (BitMat.from_i(x[i]) * t).to_i\n\t<span class=hljs-keyword>if</span> y != input[k]\n\t\tabort <span class=hljs-string>\"FAIL: \"</span> + k.to_s + <span class=hljs-string>\"\\n\"</span>;\n\t<span class=hljs-keyword>end</span>\n<span class=hljs-keyword>end</span>\n\nprint <span class=hljs-string>\"RETRIEVED: 0 -> \"</span> + (E - <span class=hljs-number>1</span>).to_s + <span class=hljs-string>\"\\n\"</span>;\n</code></pre><p>今回は、MTで乱数を生成する際にも行列を用いて計算してみました。なのでとても遅いですね。<p>ちなみに、わざわざ行列を使わなくてもTemperingの逆演算をビット演算で高速に行うことも出来ます。<aside><a href=https://plusletool.hatenablog.jp/entry/2014/10/24/213816 rel=\"noopener noreferrer\"style=background-image:url(https://ogimage.blog.st-hatena.com/12921228815721886353/8454420450070049107/1490101589) target=_blank><div><strong>メルセンヌ・ツイスタのtemperingの逆関数に関する考察 - Plus Le Blog</strong><cite>plusletool.hatenablog.jp</cite><q cite=https://plusletool.hatenablog.jp/entry/2014/10/24/213816>はじめに ↓これの逆関数の３行目の定数値がどこから出てきたのか気になったので調べてみた。temperingの逆関数できた pic.twitter.com/rssTofDVgG— oupo (隠居中) (@_oupo_) 2014年10月22日</q></div></a></aside><h1>MTはダメ？</h1><p><em>わー！MTで作った乱数は予想・復元されちゃう！危ない！</em><p>というわけではなく、要は適材適所、その性質をよく理解して使うべき、ということでした。 決して暗号用途に使っちゃダメですよ。（そういうCTF問題がどこかにありましたね……！）<p>次は <strong>xorshift</strong> を調べてみようかな？"},"__N_SSG":true}