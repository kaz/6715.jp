<!DOCTYPE html><html lang="ja"><head><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-XKSQ648BQ2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-XKSQ648BQ2')</script><meta charSet="utf-8"/><meta name="format-detection" content="telephone=no"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="author" content="sekai"/><meta name="generator" content="https://github.com/kaz/nextjs-blog-scaffold"/><meta property="og:url" content="https://6715.jp/posts/25/"/><meta property="og:site_name" content="6715.jp"/><link rel="icon" href="https://res.cloudinary.com/narusejun/image/twitter_name/h_128/sekai67.jpg"/><link rel="canonical" href="https://6715.jp/posts/25/"/><title>ConoHaのDNSをAPIから操作する話 | 6715.jp</title><meta name="description" content="この記事はConoHa Advent Calendar 2018の21日目の記事です！ ConoHa Advent Calendar 2018 ConoHaのDNS APIは便利 という話を2年前に…"/><meta name="twitter:card" content="summary"/><meta property="og:title" content="ConoHaのDNSをAPIから操作する話 | 6715.jp"/><meta property="og:type" content="article"/><meta property="og:image" content="https://res.cloudinary.com/narusejun/image/twitter_name/h_128/sekai67.jpg"/><meta property="og:description" content="この記事はConoHa Advent Calendar 2018の21日目の記事です！ ConoHa Advent Calendar 2018 ConoHaのDNS APIは便利 という話を2年前に…"/><meta property="article:published_time" content="2018-12-21T00:00:00.000Z"/><meta property="article:author" content="sekai"/><meta property="article:tag" content="API"/><meta property="article:tag" content="ConoHa"/><meta property="article:tag" content="DNS"/><meta property="article:tag" content="Let&#x27;s Encrypt"/><meta property="article:tag" content="アドベントカレンダー"/><meta name="next-head-count" content="23"/><link rel="preload" href="/_next/static/css/61bb26da18d2752efee9.css" as="style"/><link rel="stylesheet" href="/_next/static/css/61bb26da18d2752efee9.css" data-n-g=""/><link rel="preload" href="/_next/static/css/ad30b8ddc18c06e71d13.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ad30b8ddc18c06e71d13.css" data-n-p=""/><noscript data-n-css=""></noscript></head><body><div id="__next"><header class="Header_header__1mCED"><h1><a href="/">6715.jp</a></h1></header><main class="posts_post__IJEgW"><section class="posts_meta__26MyQ"><small>2018-12-21</small><h1>ConoHaのDNSをAPIから操作する話</h1><div><div><img src="https://res.cloudinary.com/narusejun/image/twitter_name/h_128/sekai67.jpg" alt="sekai"/><a href="#profile">sekai</a></div><div><svg aria-hidden="true" role="img" class="octicon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom"><path fill-rule="evenodd" d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z"></path></svg><a href="/tags/API/">API</a><a href="/tags/ConoHa/">ConoHa</a><a href="/tags/DNS/">DNS</a><a href="/tags/Let&#x27;s%20Encrypt/">Let&#x27;s Encrypt</a><a href="/tags/%E3%82%A2%E3%83%89%E3%83%99%E3%83%B3%E3%83%88%E3%82%AB%E3%83%AC%E3%83%B3%E3%83%80%E3%83%BC/">アドベントカレンダー</a></div></div></section><div class="SocialShare_social__3xEln"><a rel="noopener noreferrer" target="_blank" href="https://social-plugins.line.me/lineit/share?url=https%3A%2F%2F6715.jp%2Fposts%2F25%2F"><span title="LINE" style="background-color:#00C300"><svg viewBox="0 0 24 24"><path fill="white" d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="http://twitter.com/share?url=https%3A%2F%2F6715.jp%2Fposts%2F25%2F&amp;text=ConoHa%E3%81%AEDNS%E3%82%92API%E3%81%8B%E3%82%89%E6%93%8D%E4%BD%9C%E3%81%99%E3%82%8B%E8%A9%B1%20%7C%206715.jp"><span title="Twitter" style="background-color:#1DA1F2"><svg viewBox="0 0 24 24"><path fill="white" d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2F6715.jp%2Fposts%2F25%2F"><span title="Facebook" style="background-color:#1877F2"><svg viewBox="0 0 24 24"><path fill="white" d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="http://b.hatena.ne.jp/add?url=https%3A%2F%2F6715.jp%2Fposts%2F25%2F"><span title="Hatena Bookmark" style="background-color:#00A4DE"><svg viewBox="0 0 24 24"><path fill="white" d="M20.47 0C22.42 0 24 1.58 24 3.53v16.94c0 1.95-1.58 3.53-3.53 3.53H3.53C1.58 24 0 22.42 0 20.47V3.53C0 1.58 1.58 0 3.53 0h16.94zm-3.705 14.47c-.78 0-1.41.63-1.41 1.41s.63 1.414 1.41 1.414 1.41-.645 1.41-1.425-.63-1.41-1.41-1.41zM8.61 17.247c1.2 0 2.056-.042 2.58-.12.526-.084.976-.222 1.32-.412.45-.232.78-.564 1.02-.99s.36-.915.36-1.48c0-.78-.21-1.403-.63-1.87-.42-.48-.99-.734-1.74-.794.66-.18 1.156-.45 1.456-.81.315-.344.465-.824.465-1.424 0-.48-.103-.885-.3-1.26-.21-.36-.493-.645-.883-.87-.345-.195-.735-.315-1.215-.405-.464-.074-1.29-.12-2.474-.12H5.654v10.486H8.61zm.736-4.185c.705 0 1.185.088 1.44.262.27.18.39.495.39.93 0 .405-.135.69-.42.855-.27.18-.765.254-1.44.254H8.31v-2.297h1.05zm8.656.706v-7.06h-2.46v7.06H18zM8.925 9.08c.71 0 1.185.08 1.432.24.245.16.367.435.367.83 0 .38-.13.646-.39.804-.265.154-.747.232-1.452.232h-.57V9.08h.615z"></path></svg></span></a></div><article class="posts_content__YuXhG"><p>この記事は<a href=https://qiita.com/advent-calendar/2018/conoha rel="noopener noreferrer"target=_blank>ConoHa Advent Calendar 2018</a>の21日目の記事です！<aside><a href=https://qiita.com/advent-calendar/2018/conoha rel="noopener noreferrer"target=_blank style=background-image:url(https://cdn.qiita.com/assets/qiita-fb-41f9429f13a8c56f50dd0ab477c80d26.png)><div><strong>ConoHa Advent Calendar 2018 - Qiita</strong><cite>qiita.com</cite><q cite=https://qiita.com/advent-calendar/2018/conoha>めちゃ速！なオールSSD VPS＆レンタルサーバーを提供するConoHaのAdvent Calendarです♪ ノウハウや使い方などなど、ConoHaのサービスに関することならなんでもどうぞ！ 今年リリースしたConoHa WINGについてでももちろんオッケー！ このはへの愛のメッセージを文末に添えると、このはが大変喜びます。 今年もNGワードは「おっさん」なんだからねっ！！ 何を書こうか迷うという方は、過去のものを参考にしてくださいねっ☆ ・&#60...</q></div></a></aside><h1>ConoHaの<a href=https://www.conoha.jp/docs/ rel="noopener noreferrer"target=_blank>DNS API</a>は便利</h1><p>という話を<a href=/posts/14/>2年前</a>にもしたのでした。<aside><a href=/posts/14/ style=background-image:url(https://res.cloudinary.com/narusejun/image/twitter_name/h_128/sekai67.jpg)><div><strong>ConoHaのDNS APIをCLIから叩くやつを作った</strong><cite>6715.jp</cite><q cite=https://6715.jp/posts/14/>作りました ConoHa Advent Calendar 2016 24日目の記事です。 ConoHa Advent Calendar 2016 ConoHaのDNS ConoHaには無料で使えるD…</q></div></a></aside><p>皆さん、ConoHaのDNS API使ってますか？ Let's EncryptのDNS-01チャレンジの自動化にも使える！のでイケてますね。<h2>APIクライアントについて</h2><p>さて、ではどうやってAPIを叩くか？ 先に紹介した記事の要旨は「ConoHa DNS用 APIクライアント 作った」なんですが、あまりにも使い辛いので無視します。<h3>Designateクライントを使う</h3><p>ConoHaのDNSは<a href=https://docs.openstack.org/designate/latest/ rel="noopener noreferrer"target=_blank>OpenStack Designate</a>を使っているようです。多分。API体系がソレっぽいので。<p>なので、<a href=https://docs.openstack.org/python-designateclient/latest/cli/index.html rel="noopener noreferrer"target=_blank>Designateのクライアント</a>が使えるかもしれない……？（未確認）<p>しかし、ConoHaではdeprecatedなv1 APIのみ提供されているので、互換性の面で死ぬかもしれません。 <a href=https://dns-service.tyo1.conoha.io/ rel="noopener noreferrer"target=_blank>一応v2も動いている</a>ようですが、不完全なようですし、そもそもundocumentedです。<h3>Lexiconを使う</h3><p>様々なDNSサービスを1つのCLIから使えるようにしたソフトウェアが<a href=https://github.com/AnalogJ/lexicon rel="noopener noreferrer"target=_blank>Lexicon</a>です。<p>なんと<strong>ConoHa DNSに対応</strong>しています！すごい！！ （まぁ、ボクが使うために対応させたからなんですケド……）<p>便利なので使ってください。pipさえあればGetできます。 こんな具合に使えるかと思います。<pre><code class="hljs language-json">$ pip install dns-lexicon

$ lexicon conoha
usage: lexicon conoha [-h] [--name NAME] [--content CONTENT] [--ttl TTL]
                      [--priority PRIORITY] [--identifier IDENTIFIER]
                      [--log_level {CRITICAL,ERROR,WARNING,INFO,DEBUG,NOTSET}]
                      [--output {TABLE,TABLE-NO-HEADER,JSON,QUIET}]
                      [--auth-region AUTH_REGION] [--auth-token AUTH_TOKEN]
                      [--auth-username AUTH_USERNAME]
                      [--auth-password AUTH_PASSWORD]
                      [--auth-tenant-id AUTH_TENANT_ID]
                      {create,list,update,delete} domain
                      {A,AAAA,CNAME,MX,NS,SOA,TXT,SRV,LOC}

$ lexicon conoha --auth-region tyo1 --auth-username gncu01234567 --auth-password xxxxxxxxxxx --auth-tenant-id <span class=hljs-number>0123456789</span>abcdef0123456789abcdef create narusejun.com A --name local --content <span class=hljs-number>127.0</span><span class=hljs-number>.0</span><span class=hljs-number>.1</span>
$ lexicon conoha --auth-region tyo1 --auth-username gncu01234567 --auth-password xxxxxxxxxxx --auth-tenant-id <span class=hljs-number>0123456789</span>abcdef0123456789abcdef list narusejun.com A
ID                                   TYPE NAME                CONTENT   TTL
------------------------------------ ---- ------------------- --------- ----
<span class=hljs-number>42929801</span><span class=hljs-number>-5111</span><span class=hljs-number>-41</span>d5-a115<span class=hljs-number>-9</span>f67a1d07810 A    local.narusejun.com <span class=hljs-number>127.0</span><span class=hljs-number>.0</span><span class=hljs-number>.1</span> <span class=hljs-number>3600</span>
</code></pre><p>詳しくは<a href=https://github.com/AnalogJ/lexicon rel="noopener noreferrer"target=_blank>公式のドキュメント</a>を読んでください。 Let's EncryptのDNS-01を自動化するやり方も紹介されていますよ！<h2>Let's EncryptのDNS-01チャレンジを自動化する</h2><p>せっかくAPIでDNSレコードを操作できるわけですし、活用したいですね！<p>最近<a href=/posts/23/>ワイルドカード証明書が取れるようになった</a>Let's Encryptと連携してみましょう。 ちなみに、ワイルドカード証明書はDNS-01チャレンジでしか取得できません！<h3>LexiconとDehydratedを使う</h3><p>先ほど紹介したlexiconと、ACMEクライアント<a href=https://github.com/lukas2511/dehydrated rel="noopener noreferrer"target=_blank>Dehydrated</a>を組み合わせるやり方がlexiconの作者さんによって紹介されています。<aside><a href=https://blog.thesparktree.com/generating-intranet-and-private-network-ssl rel="noopener noreferrer"target=_blank style=background-image:url(https://blog.thesparktree.com/assets/images/cover_letsencrypt.jpg)><div><strong>Sparktree - Generating Intranet and Private Network SSL Certificates using LetsEncrypt</strong><cite>blog.thesparktree.com</cite><q cite=https://blog.thesparktree.com/generating-intranet-and-private-network-ssl>This post is a follow up to my previous one Automating SSL Certificates using Nginx &#38amp; LetsEncrypt. This time we’ll be generating SSL certificates for intranet...</q></div></a></aside><h3>Legoを使う</h3><p>2つのソフトウェアを連携させるのは面倒ですし、できればパパッとコマンド1つで証明書取りたいですよね？ そこで、Go製のACMEクライアント<a href=https://github.com/xenolf/lego rel="noopener noreferrer"target=_blank>lego</a>を使いましょう！ legoでは、いろんなDNS-Providersが提供されていて、対応しているDNSサービスならすぐに証明書を発行できます。<aside><a href=https://github.com/go-acme/lego rel="noopener noreferrer"target=_blank style=background-image:url(https://opengraph.githubassets.com/fd4c4718d342fefc15a770f6161d4fa32abe0689aa67a5d971c235b35bf5752c/go-acme/lego)><div><strong>GitHub - go-acme/lego: Let’s Encrypt client and ACME library written in Go</strong><cite>github.com</cite><q cite=https://github.com/go-acme/lego>Let’s Encrypt client and ACME library written in Go - GitHub - go-acme/lego: Let’s Encrypt client and ACME library written in Go</q></div></a></aside><p>なんと<strong>ConoHa DNSに対応</strong>しています！すごい！！ （まぁ、ボクが使うために対応させたからなんですケド……）<p><a href=https://github.com/xenolf/lego/releases rel="noopener noreferrer"target=_blank>バイナリが入手可能</a>なほか、goがインストールされているなら<code>go get</code>ですぐに入手できます。 こういう感じで使います。とっても便利ですよ！<pre><code class="hljs language-less">$ <span class=hljs-selector-tag>go</span> <span class=hljs-selector-tag>get</span> <span class=hljs-selector-tag>-u</span> <span class=hljs-selector-tag>github</span><span class=hljs-selector-class>.com</span>/<span class=hljs-selector-tag>xenolf</span>/<span class=hljs-selector-tag>lego</span>/<span class=hljs-selector-tag>cmd</span>/<span class=hljs-selector-tag>lego</span>

$ <span class=hljs-selector-tag>lego</span> <span class=hljs-selector-tag>dnshelp</span>
<span class=hljs-selector-tag>Credentials</span> <span class=hljs-selector-tag>for</span> <span class=hljs-selector-tag>DNS</span> <span class=hljs-selector-tag>providers</span> <span class=hljs-selector-tag>must</span> <span class=hljs-selector-tag>be</span> <span class=hljs-selector-tag>passed</span> <span class=hljs-selector-tag>through</span> <span class=hljs-selector-tag>environment</span> <span class=hljs-selector-tag>variables</span>.

<span class=hljs-selector-tag>Valid</span> <span class=hljs-selector-tag>providers</span> <span class=hljs-selector-tag>and</span> <span class=hljs-selector-tag>their</span> <span class=hljs-selector-tag>associated</span> <span class=hljs-selector-tag>credential</span> <span class=hljs-selector-tag>environment</span> <span class=hljs-selector-tag>variables</span>:
        <span class=hljs-selector-tag>conoha</span>:         <span class=hljs-selector-tag>CONOHA_REGION</span>, <span class=hljs-selector-tag>CONOHA_TENANT_ID</span>, <span class=hljs-selector-tag>CONOHA_API_USERNAME</span>, <span class=hljs-selector-tag>CONOHA_API_PASSWORD</span>

<span class=hljs-selector-tag>Additional</span> <span class=hljs-selector-tag>configuration</span> <span class=hljs-selector-tag>environment</span> <span class=hljs-selector-tag>variables</span>:
        <span class=hljs-selector-tag>conoha</span>:         <span class=hljs-selector-tag>CONOHA_POLLING_INTERVAL</span>, <span class=hljs-selector-tag>CONOHA_PROPAGATION_TIMEOUT</span>, <span class=hljs-selector-tag>CONOHA_TTL</span>, <span class=hljs-selector-tag>CONOHA_HTTP_TIMEOUT</span>

$ <span class=hljs-selector-tag>export</span> <span class=hljs-selector-tag>CONOHA_REGION</span>=<span class=hljs-selector-tag>tyo1</span>
$ <span class=hljs-selector-tag>export</span> <span class=hljs-selector-tag>CONOHA_TENANT_ID</span>=<span class=hljs-selector-tag>0123456789abcdef0123456789abcdef</span>
$ <span class=hljs-selector-tag>export</span> <span class=hljs-selector-tag>CONOHA_API_USERNAME</span>=<span class=hljs-selector-tag>gncu01234567</span>
$ <span class=hljs-selector-tag>export</span> <span class=hljs-selector-tag>CONOHA_API_PASSWORD</span>=<span class=hljs-selector-tag>xxxxxxxxxxx</span>
$ <span class=hljs-selector-tag>lego</span> <span class=hljs-selector-tag>--dns</span> <span class=hljs-selector-tag>conoha</span> <span class=hljs-selector-tag>--server</span> <span class=hljs-selector-tag>https</span>:<span class=hljs-comment>//acme-staging-v02.api.letsencrypt.org/directory --email cert@narusejun.com --domains narusejun.com --domains *.narusejun.com run</span>
<span class=hljs-selector-tag>2018</span>/<span class=hljs-selector-tag>12</span>/<span class=hljs-selector-tag>21</span> <span class=hljs-selector-tag>02</span><span class=hljs-selector-pseudo>:44</span><span class=hljs-selector-pseudo>:58</span> <span class=hljs-selector-attr>[INFO]</span> <span class=hljs-selector-attr>[narusejun.com, *.narusejun.com]</span> <span class=hljs-selector-tag>acme</span>: <span class=hljs-selector-tag>Obtaining</span> <span class=hljs-selector-tag>bundled</span> <span class=hljs-selector-tag>SAN</span> <span class=hljs-selector-tag>certificate</span>
<span class=hljs-selector-tag>2018</span>/<span class=hljs-selector-tag>12</span>/<span class=hljs-selector-tag>21</span> <span class=hljs-selector-tag>02</span><span class=hljs-selector-pseudo>:44</span><span class=hljs-selector-pseudo>:59</span> <span class=hljs-selector-attr>[INFO]</span> <span class=hljs-selector-attr>[*.narusejun.com]</span> <span class=hljs-selector-tag>AuthURL</span>: <span class=hljs-selector-tag>https</span>:<span class=hljs-comment>//acme-staging-v02.api.letsencrypt.org/acme/authz/wcYZJB5aWmfi4WzGuwv2JlSaYjryGf67zqES8h8bmEg</span>
<span class=hljs-selector-tag>2018</span>/<span class=hljs-selector-tag>12</span>/<span class=hljs-selector-tag>21</span> <span class=hljs-selector-tag>02</span><span class=hljs-selector-pseudo>:44</span><span class=hljs-selector-pseudo>:59</span> <span class=hljs-selector-attr>[INFO]</span> <span class=hljs-selector-attr>[narusejun.com]</span> <span class=hljs-selector-tag>AuthURL</span>: <span class=hljs-selector-tag>https</span>:<span class=hljs-comment>//acme-staging-v02.api.letsencrypt.org/acme/authz/gwXBvxvuHk7TrUYbuu3MWp7heVoLTTle7Nh2ng98b74</span>
<span class=hljs-selector-tag>2018</span>/<span class=hljs-selector-tag>12</span>/<span class=hljs-selector-tag>21</span> <span class=hljs-selector-tag>02</span><span class=hljs-selector-pseudo>:44</span><span class=hljs-selector-pseudo>:59</span> <span class=hljs-selector-attr>[INFO]</span> <span class=hljs-selector-attr>[narusejun.com]</span> <span class=hljs-selector-tag>acme</span>: <span class=hljs-selector-tag>Authorization</span> <span class=hljs-selector-tag>already</span> <span class=hljs-selector-tag>valid</span>; <span class=hljs-selector-tag>skipping</span> <span class=hljs-selector-tag>challenge</span>
<span class=hljs-selector-tag>2018</span>/<span class=hljs-selector-tag>12</span>/<span class=hljs-selector-tag>21</span> <span class=hljs-selector-tag>02</span><span class=hljs-selector-pseudo>:44</span><span class=hljs-selector-pseudo>:59</span> <span class=hljs-selector-attr>[INFO]</span> <span class=hljs-selector-attr>[narusejun.com]</span> <span class=hljs-selector-tag>acme</span>: <span class=hljs-selector-tag>Preparing</span> <span class=hljs-selector-tag>to</span> <span class=hljs-selector-tag>solve</span> <span class=hljs-selector-tag>DNS-01</span>
<span class=hljs-selector-tag>2018</span>/<span class=hljs-selector-tag>12</span>/<span class=hljs-selector-tag>21</span> <span class=hljs-selector-tag>02</span><span class=hljs-selector-pseudo>:45</span><span class=hljs-selector-pseudo>:00</span> <span class=hljs-selector-attr>[INFO]</span> <span class=hljs-selector-attr>[narusejun.com]</span> <span class=hljs-selector-tag>acme</span>: <span class=hljs-selector-tag>Trying</span> <span class=hljs-selector-tag>to</span> <span class=hljs-selector-tag>solve</span> <span class=hljs-selector-tag>DNS-01</span>
<span class=hljs-selector-tag>2018</span>/<span class=hljs-selector-tag>12</span>/<span class=hljs-selector-tag>21</span> <span class=hljs-selector-tag>02</span><span class=hljs-selector-pseudo>:45</span><span class=hljs-selector-pseudo>:00</span> <span class=hljs-selector-attr>[INFO]</span> <span class=hljs-selector-attr>[narusejun.com]</span> <span class=hljs-selector-tag>Checking</span> <span class=hljs-selector-tag>DNS</span> <span class=hljs-selector-tag>record</span> <span class=hljs-selector-tag>propagation</span> <span class=hljs-selector-tag>using</span> <span class=hljs-selector-attr>[1.0.0.1:53]</span>
<span class=hljs-selector-tag>2018</span>/<span class=hljs-selector-tag>12</span>/<span class=hljs-selector-tag>21</span> <span class=hljs-selector-tag>02</span><span class=hljs-selector-pseudo>:45</span><span class=hljs-selector-pseudo>:00</span> <span class=hljs-selector-attr>[INFO]</span> <span class=hljs-selector-tag>Wait</span> <span class=hljs-selector-attr>[timeout: 1m0s, interval: 2s]</span>
<span class=hljs-selector-tag>2018</span>/<span class=hljs-selector-tag>12</span>/<span class=hljs-selector-tag>21</span> <span class=hljs-selector-tag>02</span><span class=hljs-selector-pseudo>:45</span><span class=hljs-selector-pseudo>:37</span> <span class=hljs-selector-attr>[INFO]</span> <span class=hljs-selector-attr>[narusejun.com]</span> <span class=hljs-selector-tag>The</span> <span class=hljs-selector-tag>server</span> <span class=hljs-selector-tag>validated</span> <span class=hljs-selector-tag>our</span> <span class=hljs-selector-tag>request</span>
<span class=hljs-selector-tag>2018</span>/<span class=hljs-selector-tag>12</span>/<span class=hljs-selector-tag>21</span> <span class=hljs-selector-tag>02</span><span class=hljs-selector-pseudo>:45</span><span class=hljs-selector-pseudo>:38</span> <span class=hljs-selector-attr>[INFO]</span> <span class=hljs-selector-attr>[narusejun.com, *.narusejun.com]</span> <span class=hljs-selector-tag>acme</span>: <span class=hljs-selector-tag>Validations</span> <span class=hljs-selector-tag>succeeded</span>; <span class=hljs-selector-tag>requesting</span> <span class=hljs-selector-tag>certificates</span>
<span class=hljs-selector-tag>2018</span>/<span class=hljs-selector-tag>12</span>/<span class=hljs-selector-tag>21</span> <span class=hljs-selector-tag>02</span><span class=hljs-selector-pseudo>:45</span><span class=hljs-selector-pseudo>:39</span> <span class=hljs-selector-attr>[INFO]</span> <span class=hljs-selector-attr>[narusejun.com]</span> <span class=hljs-selector-tag>Server</span> <span class=hljs-selector-tag>responded</span> <span class=hljs-selector-tag>with</span> <span class=hljs-selector-tag>a</span> <span class=hljs-selector-tag>certificate</span>.

$ <span class=hljs-selector-tag>openssl</span> <span class=hljs-selector-tag>x509</span> <span class=hljs-selector-tag>-in</span> ~/<span class=hljs-selector-class>.lego</span>/<span class=hljs-selector-tag>certificates</span>/<span class=hljs-selector-tag>narusejun</span><span class=hljs-selector-class>.com</span><span class=hljs-selector-class>.crt</span> <span class=hljs-selector-tag>-text</span>
<span class=hljs-selector-tag>Certificate</span>:
    <span class=hljs-selector-tag>Data</span>:
        <span class=hljs-selector-tag>Version</span>: <span class=hljs-selector-tag>3</span> (<span class=hljs-number>0</span>x2)
        <span class=hljs-selector-tag>Serial</span> <span class=hljs-selector-tag>Number</span>:
            <span class=hljs-selector-tag>fa</span><span class=hljs-selector-pseudo>:78</span><span class=hljs-selector-pseudo>:5b</span><span class=hljs-selector-pseudo>:6e</span><span class=hljs-selector-pseudo>:73</span><span class=hljs-selector-pseudo>:74</span><span class=hljs-selector-pseudo>:37</span><span class=hljs-selector-pseudo>:e6</span><span class=hljs-selector-pseudo>:c4</span><span class=hljs-selector-pseudo>:36</span><span class=hljs-selector-pseudo>:54</span><span class=hljs-selector-pseudo>:82</span><span class=hljs-selector-pseudo>:02</span><span class=hljs-selector-pseudo>:04</span><span class=hljs-selector-pseudo>:d2</span><span class=hljs-selector-pseudo>:7e</span><span class=hljs-selector-pseudo>:bd</span><span class=hljs-selector-pseudo>:0b</span>
        <span class=hljs-selector-tag>Signature</span> <span class=hljs-selector-tag>Algorithm</span>: <span class=hljs-selector-tag>sha256WithRSAEncryption</span>
        <span class=hljs-selector-tag>Issuer</span>: <span class=hljs-selector-tag>CN</span> = <span class=hljs-selector-tag>Fake</span> <span class=hljs-selector-tag>LE</span> <span class=hljs-selector-tag>Intermediate</span> <span class=hljs-selector-tag>X1</span>
        <span class=hljs-selector-tag>Validity</span>
            <span class=hljs-selector-tag>Not</span> <span class=hljs-selector-tag>Before</span>: <span class=hljs-selector-tag>Dec</span> <span class=hljs-selector-tag>20</span> <span class=hljs-selector-tag>16</span><span class=hljs-selector-pseudo>:45</span><span class=hljs-selector-pseudo>:40</span> <span class=hljs-selector-tag>2018</span> <span class=hljs-selector-tag>GMT</span>
            <span class=hljs-selector-tag>Not</span> <span class=hljs-selector-tag>After</span> : <span class=hljs-selector-tag>Mar</span> <span class=hljs-selector-tag>20</span> <span class=hljs-selector-tag>16</span><span class=hljs-selector-pseudo>:45</span><span class=hljs-selector-pseudo>:40</span> <span class=hljs-selector-tag>2019</span> <span class=hljs-selector-tag>GMT</span>
        <span class=hljs-selector-tag>Subject</span>: <span class=hljs-selector-tag>CN</span> = <span class=hljs-selector-tag>narusejun</span><span class=hljs-selector-class>.com</span>
        <span class=hljs-selector-tag>X509v3</span> <span class=hljs-selector-tag>extensions</span>:
            <span class=hljs-selector-tag>X509v3</span> <span class=hljs-selector-tag>Subject</span> <span class=hljs-selector-tag>Alternative</span> <span class=hljs-selector-tag>Name</span>:
                <span class=hljs-selector-tag>DNS</span>:*<span class=hljs-selector-class>.narusejun</span><span class=hljs-selector-class>.com</span>, <span class=hljs-selector-tag>DNS</span><span class=hljs-selector-pseudo>:narusejun.com</span>
</code></pre><p>……と、サクッとワイルドカード証明書が取れてしまいました。すごい！便利！<p>上の例はstaging環境から証明書を取得しているので、マネする際はご注意ください！ 詳しくは、例によって<a href=https://github.com/xenolf/lego rel="noopener noreferrer"target=_blank>公式ドキュメント</a>をごらんください。<h3>traefikを使う</h3><p><a href=https://docs.traefik.io/ rel="noopener noreferrer"target=_blank>traefik</a>は強いL7ロードバランサみたいなものです（ざっくりとした説明）。 Let's Encryptから自動で証明書を取る機能がついてるんですが、この機能は内部で先述したlegoを利用しています。<aside><a href=https://docs.traefik.io/ rel="noopener noreferrer"target=_blank style=background-image:url(https://docs.traefik.io/assets/img/traefik-architecture.png)><div><strong>Traefik</strong><cite>docs.traefik.io</cite><q cite=https://docs.traefik.io/>Traefik Documentation</q></div></a></aside><p>……ということは、<strong>ConoHa DNSに対応</strong>しています！ 詳しい説明は省きますが、<a href=https://docs.traefik.io/configuration/acme/ rel="noopener noreferrer"target=_blank>公式ドキュメント</a>を参考に設定してみてください。 ちゃんとConoHa DNSと連携して動作することを確認済みです。<h2>おわりに</h2><p>紹介したソフトウェア以外にも、LexiconやLegoを内部で使ってる系ソフトが実はConoHaに対応してるパターンがいっぱいあるかもしれません。このソフトでもConoHa DNS使えたよ！とかあったら教えてください。 ちなみに、<a href=https://caddyserver.com/ rel="noopener noreferrer"target=_blank>Caddy</a>というHTTPサーバが<a href=https://caddy.community/t/poll-we-can-end-dns-provider-plugins-should-we/4887 rel="noopener noreferrer"target=_blank>Legoの全DNSプロバイダに対応しそう</a>だったりするので、そしたらConoHaも使えるようになりますね！<hr><p>ConoHaのDNS、めっちゃ便利なので使いましょう。 APIでレコードいじれるし、ゾーン数がいくつあっても無料ってマジ！？神じゃん。<p>あっ、ボクのパソコン見てください。<blockquote class=twitter-tweet><p dir=ltr lang=ja>このはちゃんガチ勢なのでな✋<a href="https://twitter.com/hashtag/isucon?src=hash&#38ref_src=twsrc%5Etfw">#isucon</a> <a href=https://t.co/mgIRDxO6B4>pic.twitter.com/mgIRDxO6B4</a></p>— sekai (@sekai67) <a href="https://twitter.com/sekai67/status/1053444090757435392?ref_src=twsrc%5Etfw">October 20, 2018</a></blockquote><script async charset=utf8 src=https://platform.twitter.com/widgets.js></script><blockquote class=twitter-tweet><p dir=ltr lang=ja>さっきからずっとこのはちゃんとベタベタしてる <a href=https://t.co/FyyDBpZtxe>pic.twitter.com/FyyDBpZtxe</a></p>— sekai (@sekai67) <a href="https://twitter.com/sekai67/status/1053598421414596608?ref_src=twsrc%5Etfw">October 20, 2018</a></blockquote><script async charset=utf8 src=https://platform.twitter.com/widgets.js></script><blockquote class=twitter-tweet><p dir=ltr lang=ja>このはちゃんとツーショット撮れた！！！！嬉しい！！！！<a href="https://twitter.com/hashtag/isucon?src=hash&#38ref_src=twsrc%5Etfw">#isucon</a> <a href=https://t.co/Tb25Fr39lD>pic.twitter.com/Tb25Fr39lD</a></p>— sekai (@sekai67) <a href="https://twitter.com/sekai67/status/1053441437126127616?ref_src=twsrc%5Etfw">October 20, 2018</a></blockquote><script async charset=utf8 src=https://platform.twitter.com/widgets.js></script></article><div class="SocialShare_social__3xEln"><a rel="noopener noreferrer" target="_blank" href="https://social-plugins.line.me/lineit/share?url=https%3A%2F%2F6715.jp%2Fposts%2F25%2F"><span title="LINE" style="background-color:#00C300"><svg viewBox="0 0 24 24"><path fill="white" d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="http://twitter.com/share?url=https%3A%2F%2F6715.jp%2Fposts%2F25%2F&amp;text=ConoHa%E3%81%AEDNS%E3%82%92API%E3%81%8B%E3%82%89%E6%93%8D%E4%BD%9C%E3%81%99%E3%82%8B%E8%A9%B1%20%7C%206715.jp"><span title="Twitter" style="background-color:#1DA1F2"><svg viewBox="0 0 24 24"><path fill="white" d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2F6715.jp%2Fposts%2F25%2F"><span title="Facebook" style="background-color:#1877F2"><svg viewBox="0 0 24 24"><path fill="white" d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="http://b.hatena.ne.jp/add?url=https%3A%2F%2F6715.jp%2Fposts%2F25%2F"><span title="Hatena Bookmark" style="background-color:#00A4DE"><svg viewBox="0 0 24 24"><path fill="white" d="M20.47 0C22.42 0 24 1.58 24 3.53v16.94c0 1.95-1.58 3.53-3.53 3.53H3.53C1.58 24 0 22.42 0 20.47V3.53C0 1.58 1.58 0 3.53 0h16.94zm-3.705 14.47c-.78 0-1.41.63-1.41 1.41s.63 1.414 1.41 1.414 1.41-.645 1.41-1.425-.63-1.41-1.41-1.41zM8.61 17.247c1.2 0 2.056-.042 2.58-.12.526-.084.976-.222 1.32-.412.45-.232.78-.564 1.02-.99s.36-.915.36-1.48c0-.78-.21-1.403-.63-1.87-.42-.48-.99-.734-1.74-.794.66-.18 1.156-.45 1.456-.81.315-.344.465-.824.465-1.424 0-.48-.103-.885-.3-1.26-.21-.36-.493-.645-.883-.87-.345-.195-.735-.315-1.215-.405-.464-.074-1.29-.12-2.474-.12H5.654v10.486H8.61zm.736-4.185c.705 0 1.185.088 1.44.262.27.18.39.495.39.93 0 .405-.135.69-.42.855-.27.18-.765.254-1.44.254H8.31v-2.297h1.05zm8.656.706v-7.06h-2.46v7.06H18zM8.925 9.08c.71 0 1.185.08 1.432.24.245.16.367.435.367.83 0 .38-.13.646-.39.804-.265.154-.747.232-1.452.232h-.57V9.08h.615z"></path></svg></span></a></div></main><footer class="Footer_footer__22y9A"><div id="profile" class="Footer_profile__39Joc"><img src="https://res.cloudinary.com/narusejun/image/twitter_name/h_128/sekai67.jpg" alt="sekai"/><div><small>Author</small><strong>sekai<a rel="noopener noreferrer" target="_blank" href="https://github.com/kaz"><span title="GitHub" style="background-color:initial"><svg viewBox="0 0 24 24"><path fill="#181717" d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="https://twitter.com/sekai67"><span title="Twitter" style="background-color:initial"><svg viewBox="0 0 24 24"><path fill="#1DA1F2" d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="https://www.facebook.com/sawada.kazuki"><span title="Facebook" style="background-color:initial"><svg viewBox="0 0 24 24"><path fill="#1877F2" d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path></svg></span></a></strong><p>インフラとDXが好き</p></div></div><div class="Footer_copyright__3QtRW">© <!-- -->2016 sekai</div></footer></div></body></html>