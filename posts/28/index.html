<!DOCTYPE html><html lang="ja"><head><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-XKSQ648BQ2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-XKSQ648BQ2')</script><meta charSet="utf-8"/><meta name="format-detection" content="telephone=no"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="author" content="sekai"/><meta name="generator" content="https://github.com/kaz/nextjs-blog-scaffold"/><meta property="og:url" content="https://6715.jp/posts/28/"/><meta property="og:site_name" content="6715.jp"/><link rel="icon" href="https://res.cloudinary.com/narusejun/image/twitter_name/h_128/sekai67.jpg"/><link rel="canonical" href="https://6715.jp/posts/28/"/><title>ISUCON10 やらかしリスト | 6715.jp</title><meta name="description" content="ISUCON10お疲れさまでした。運営の皆さん、ありがとうございました。 ボク、@sekai67はNaruseJunチームの一員として出場しました。結果はこう。 予選では、本選出場圏内の点数を取って…"/><meta name="twitter:card" content="summary"/><meta property="og:title" content="ISUCON10 やらかしリスト | 6715.jp"/><meta property="og:type" content="article"/><meta property="og:image" content="https://res.cloudinary.com/narusejun/image/twitter_name/h_128/sekai67.jpg"/><meta property="og:description" content="ISUCON10お疲れさまでした。運営の皆さん、ありがとうございました。 ボク、@sekai67はNaruseJunチームの一員として出場しました。結果はこう。 予選では、本選出場圏内の点数を取って…"/><meta property="article:published_time" content="2020-10-04T00:00:00.000Z"/><meta property="article:author" content="sekai"/><meta property="article:tag" content="AppArmor"/><meta property="article:tag" content="ISUCON"/><meta property="article:tag" content="systemd"/><meta property="article:tag" content="インフラ"/><meta property="article:tag" content="参加記"/><meta name="next-head-count" content="23"/><link rel="preload" href="/_next/static/css/61bb26da18d2752efee9.css" as="style"/><link rel="stylesheet" href="/_next/static/css/61bb26da18d2752efee9.css" data-n-g=""/><link rel="preload" href="/_next/static/css/ad30b8ddc18c06e71d13.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ad30b8ddc18c06e71d13.css" data-n-p=""/><noscript data-n-css=""></noscript></head><body><div id="__next"><header class="Header_header__1mCED"><h1><a href="/">6715.jp</a></h1></header><main class="posts_post__IJEgW"><section class="posts_meta__26MyQ"><small>2020-10-04</small><h1>ISUCON10 やらかしリスト</h1><div><div><img src="https://res.cloudinary.com/narusejun/image/twitter_name/h_128/sekai67.jpg" alt="sekai"/><a href="#profile">sekai</a></div><div><svg aria-hidden="true" role="img" class="octicon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom"><path fill-rule="evenodd" d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z"></path></svg><a href="/tags/AppArmor/">AppArmor</a><a href="/tags/ISUCON/">ISUCON</a><a href="/tags/systemd/">systemd</a><a href="/tags/%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9/">インフラ</a><a href="/tags/%E5%8F%82%E5%8A%A0%E8%A8%98/">参加記</a></div></div></section><div class="SocialShare_social__3xEln"><a rel="noopener noreferrer" target="_blank" href="https://social-plugins.line.me/lineit/share?url=https%3A%2F%2F6715.jp%2Fposts%2F28%2F"><span title="LINE" style="background-color:#00C300"><svg viewBox="0 0 24 24"><path fill="white" d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="http://twitter.com/share?url=https%3A%2F%2F6715.jp%2Fposts%2F28%2F&amp;text=ISUCON10%20%E3%82%84%E3%82%89%E3%81%8B%E3%81%97%E3%83%AA%E3%82%B9%E3%83%88%20%7C%206715.jp"><span title="Twitter" style="background-color:#1DA1F2"><svg viewBox="0 0 24 24"><path fill="white" d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2F6715.jp%2Fposts%2F28%2F"><span title="Facebook" style="background-color:#1877F2"><svg viewBox="0 0 24 24"><path fill="white" d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="http://b.hatena.ne.jp/add?url=https%3A%2F%2F6715.jp%2Fposts%2F28%2F"><span title="Hatena Bookmark" style="background-color:#00A4DE"><svg viewBox="0 0 24 24"><path fill="white" d="M20.47 0C22.42 0 24 1.58 24 3.53v16.94c0 1.95-1.58 3.53-3.53 3.53H3.53C1.58 24 0 22.42 0 20.47V3.53C0 1.58 1.58 0 3.53 0h16.94zm-3.705 14.47c-.78 0-1.41.63-1.41 1.41s.63 1.414 1.41 1.414 1.41-.645 1.41-1.425-.63-1.41-1.41-1.41zM8.61 17.247c1.2 0 2.056-.042 2.58-.12.526-.084.976-.222 1.32-.412.45-.232.78-.564 1.02-.99s.36-.915.36-1.48c0-.78-.21-1.403-.63-1.87-.42-.48-.99-.734-1.74-.794.66-.18 1.156-.45 1.456-.81.315-.344.465-.824.465-1.424 0-.48-.103-.885-.3-1.26-.21-.36-.493-.645-.883-.87-.345-.195-.735-.315-1.215-.405-.464-.074-1.29-.12-2.474-.12H5.654v10.486H8.61zm.736-4.185c.705 0 1.185.088 1.44.262.27.18.39.495.39.93 0 .405-.135.69-.42.855-.27.18-.765.254-1.44.254H8.31v-2.297h1.05zm8.656.706v-7.06h-2.46v7.06H18zM8.925 9.08c.71 0 1.185.08 1.432.24.245.16.367.435.367.83 0 .38-.13.646-.39.804-.265.154-.747.232-1.452.232h-.57V9.08h.615z"></path></svg></span></a></div><article class="posts_content__YuXhG"><p>ISUCON10お疲れさまでした。運営の皆さん、ありがとうございました。<p>ボク、<a href=https://twitter.com/sekai67 rel="noopener noreferrer"target=_blank>@sekai67</a>はNaruseJunチームの一員として出場しました。結果はこう。<ul><li>予選では、本選出場圏内の点数を取って余裕をカマしていましたが、追試をパスできずに予選落ち。<li>本選では、<a href=http://isucon.net/archives/55063136.html rel="noopener noreferrer"target=_blank>本選ライブ</a>の企画で、並行チームとして問題に取り組ませてもらう。<ul><li>競技中最高得点 <strong>52567</strong> を記録するものの、追試をパスできず記録なし。伝統芸能</ul></ul><p>これは記念写真です。<p><img alt src=score.png><p>まあ追試で落ちてるんですけどね！<p>参加記はチームメイトの<a href=https://twitter.com/to_hutohu rel="noopener noreferrer"target=_blank>@to_hutohu</a>と<a href=https://twitter.com/takashi_trap rel="noopener noreferrer"target=_blank>@takashi_trap</a>が書いてくれると信じて、ボクはちょっとしたこぼれ話を書いていきます。<h2>やらかしリスト</h2><p>予選、本選どちらにおいても、思い返すとまあいろいろやらかしたんですが、今回は興味深かった2つを抜粋して掘り下げます。<ul><li>予選時、再起動試験を5回ぐらいして、追試落ちは絶対ない状態まで持っていったのに無事追試落ちした話<li>本選開始後、初手でサーバの1台を使い物にならなくしてチームメイトを困惑させた話</ul><h2>予選の追試で落ちた</h2><h3>経緯</h3><p>予選では、チームメイトの2人がわりとギリギリまでアプリ実装のバグ取りを詰めていたので、ボクが1人で再起動試験や後片付けを担当することになりました。 去年も再起動後に正しく動作させることができずに予選落ちしていますので、今年こそは！と念入りに何度も行っていました。<p>5回ほど再起動してもOK、再起動後にもデータも正しく引き継がれている。絶対落ちないだろコレは！！！ と自信満々で競技を終えたわけですが、結果発表でチーム名が呼ばれることはありませんでした……<p>夜中、凹みつつも競技で使ったサーバの様子を見に行ってみると…… DBサーバが落ちてるやんけ！！！！！なんで？？！？！？？！？？！！！<h3>理由</h3><p>apparmorのポリシー(mysql-serverパッケージに入ってる<code>/etc/apparmor.d/usr.sbin.mysqld</code>)が生きていて、systemdがmariadbの起動を検知できておらず、<code>systemctl stop</code>相当の処理がかかったため。<p>Ubuntuで、最初にmysqlが動いている状態から、これをmariadbに置き換えると起動しなくなるという事例があります。 こちらの記事が詳しいです。<aside><a href=/posts/24/ style=background-image:url(https://res.cloudinary.com/narusejun/image/twitter_name/h_128/sekai67.jpg)><div><strong>Ubuntuでmysql-serverをmariadb-serverで置き換えるとsystemd経由でmariadbが起動できない</strong><cite>6715.jp</cite><q cite=https://6715.jp/posts/24/>Ubuntu(18.04 LTS)でmysql-serverをmariadb-serverで置き換えるとsystemd経由でmariadbが起動できない。 追記 この記事には一部誤りがあります。 以…</q></div></a></aside><h2>疑問1: mariadbに入れ替えたときにto-hutohuが<code>aa-remove-unknown</code>でポリシーを消したのでは？</h2><p>先ほど紹介した記事を書いたのはボクです。ですので、もちろんこの挙動については知っていました。 上記記事で紹介されている対策法をもちろん講じています。<p>が、これはそもそも恒久対応ではありませんでした……！ わかりにくい書き方でゴメンナサイ。<p>先の記事で言及している、<blockquote><p>/etc/apparmor.d/usr.sbin.mysqldは空のファイルで上書きされますが、AppArmorがすでに読み込んでいるプロファイルは削除されません。 また、systemctl reload apparmorしても、OSを再起動しても、一度読み込まれたプロファイルが勝手に削除されることはありません。</blockquote><p>ここの理解が曖昧、あるいは間違っています。<p>ポリシーがOSを再起動しても消えない原因は、apparmorのポリシーキャッシュのせいで、<code>/etc/apparmor.d/cache/usr.sbin.mysqld</code>が存在して、かつ<code>/etc/apparmor.d/usr.sbin.mysqld</code>よりタイムスタンプが新しい場合、キャッシュのほうが読み込まれるという挙動をします。<ul><li><code>/etc/apparmor.d/cache/usr.sbin.mysqld</code>が作成されるのは、mysql-serverインストール時。<ul><li>つまりタイムスタンプは → <code>Sep 11 11:34</code></ul><li><code>/etc/apparmor.d/usr.sbin.mysqld</code>のタイムスタンプは、mariadbパッケージが作成された時。<ul><li>つまりタイムスタンプは → <code>Jul 20 10:50</code></ul></ul><p>ですので、<code>/etc/apparmor.d/usr.sbin.mysqld</code>が更新されたにも関わらず、キャッシュのほうがずっと読み込まれ続けてしまうのでした……！<p>正しい対応は、<code>systemctl reload apparmor</code>でした。 これでキャッシュのflushが走り、正しくmariadbに起動するようになります。<p>例の記事については、そのうち書き換えておきますね……<h3>疑問2: sekaiが再起動試験を行ったときにうまく動作していたのは何故？</h3><p>再起動後15分以内にのみ試験していたからです。<p>AppArmorのせいでmariadbに起動に失敗するというのは、厳密に言うと、 <strong>mariadbは起動に成功しているんだけどsystemdがそれを検知できていない</strong> ということ。 systemdは一定時間（デフォルトで15分）以内にサービスの起動を確認できないと、ご丁寧にExecStopを走らせてくれるのです……！<p>sekaiが再起動したのは <strong>11:39:26 UTC</strong> ごろ。<pre><code class="hljs language-apache">-- <span class=hljs-attribute>Reboot</span> --
<span class=hljs-attribute>Sep</span> <span class=hljs-number>12</span> <span class=hljs-number>11</span>:<span class=hljs-number>39</span>:<span class=hljs-number>26</span> s<span class=hljs-number>2</span> systemd[<span class=hljs-number>1</span>]: Starting MariaDB <span class=hljs-number>10</span>.<span class=hljs-number>1</span>.<span class=hljs-number>44</span> database server...
<span class=hljs-attribute>Sep</span> <span class=hljs-number>12</span> <span class=hljs-number>11</span>:<span class=hljs-number>39</span>:<span class=hljs-number>32</span> s<span class=hljs-number>2</span> mysqld[<span class=hljs-number>1244</span>]: <span class=hljs-number>2020</span>-<span class=hljs-number>09</span>-<span class=hljs-number>12</span> <span class=hljs-number>11</span>:<span class=hljs-number>39</span>:<span class=hljs-number>32</span> <span class=hljs-number>139768179551360</span><span class=hljs-meta> [Note] /usr/sbin/mysqld (mysqld 10.1.44-MariaDB-0ubuntu0.18.04.1) starting as process 1244 ...
Sep 12 11:45:11 s2 systemd[1]: Stopped MariaDB 10.1.44 database server.
-- Reboot --
</span></code></pre><p>11:45:11にStopしてるのは、このあともう一度再起動試験したためです。<p>この付近のkern.logは以下。<pre><code class="hljs language-routeros">Sep 12 11:39:35 s2 kernel: [   42.180656] audit: <span class=hljs-attribute>type</span>=1400 audit(1599910775.956:18): <span class=hljs-attribute>apparmor</span>=<span class=hljs-string>"DENIED"</span> <span class=hljs-attribute>operation</span>=<span class=hljs-string>"sendmsg"</span> <span class=hljs-attribute>info</span>=<span class=hljs-string>"Failed name lookup - disconnected path"</span> <span class=hljs-attribute>error</span>=-13 <span class=hljs-attribute>profile</span>=<span class=hljs-string>"/usr/sbin/mysqld"</span> <span class=hljs-attribute>name</span>=<span class=hljs-string>"run/systemd/notify"</span> <span class=hljs-attribute>pid</span>=1244 <span class=hljs-attribute>comm</span>=<span class=hljs-string>"mysqld"</span> <span class=hljs-attribute>requested_mask</span>=<span class=hljs-string>"w"</span> <span class=hljs-attribute>denied_mask</span>=<span class=hljs-string>"w"</span> <span class=hljs-attribute>fsuid</span>=111 <span class=hljs-attribute>ouid</span>=0
</code></pre><p>sd-notify失敗してるので、この時点でもAppArmorのポリシーが生きています。 systemdはこのときずっとmariadbが上がってくるのを待っている状態です。 ただし、mariadb自体は起動しているので、アプリへのリクエストは通る状態です。 （sekaiのこの状態でずっと再起動試験をしていたわけです。バカですねえ。）<p>一方で、運営による再起動が行われたと思われる時刻(14:20:38 UTC つまり 23:20:38 JST)付近のログは以下のとおり。<pre><code class="hljs language-apache">-- <span class=hljs-attribute>Reboot</span> --
<span class=hljs-attribute>Sep</span> <span class=hljs-number>12</span> <span class=hljs-number>14</span>:<span class=hljs-number>20</span>:<span class=hljs-number>38</span> s<span class=hljs-number>2</span> systemd[<span class=hljs-number>1</span>]: Starting MariaDB <span class=hljs-number>10</span>.<span class=hljs-number>1</span>.<span class=hljs-number>44</span> database server...
<span class=hljs-attribute>Sep</span> <span class=hljs-number>12</span> <span class=hljs-number>14</span>:<span class=hljs-number>20</span>:<span class=hljs-number>42</span> s<span class=hljs-number>2</span> mysqld[<span class=hljs-number>1100</span>]: <span class=hljs-number>2020</span>-<span class=hljs-number>09</span>-<span class=hljs-number>12</span> <span class=hljs-number>14</span>:<span class=hljs-number>20</span>:<span class=hljs-number>42</span> <span class=hljs-number>140238334753920</span><span class=hljs-meta> [Note] /usr/sbin/mysqld (mysqld 10.1.44-MariaDB-0ubuntu0.18.04.1) starting as process 1100 ...
Sep 12 14:35:41 s2 systemd[1]: mariadb.service: Start operation timed out. Terminating.
Sep 12 14:35:43 s2 systemd[1]: mariadb.service: Failed with result 'timeout'.
Sep 12 14:35:43 s2 systemd[1]: Failed to start MariaDB 10.1.44 database server.
</span></code></pre><p>15分立ったのでmariadbがshutdownされたと思われます。 以下は<code>/var/lib/mysql/error.log</code>です。<pre><code class="hljs language-css">2020<span class=hljs-selector-tag>-09-12</span> 14<span class=hljs-selector-pseudo>:35</span><span class=hljs-selector-pseudo>:41</span> 140238333712128 <span class=hljs-selector-attr>[Note]</span> /<span class=hljs-selector-tag>usr</span>/<span class=hljs-selector-tag>sbin</span>/<span class=hljs-selector-tag>mysqld</span>: <span class=hljs-selector-tag>Normal</span> <span class=hljs-selector-tag>shutdown</span>
2020<span class=hljs-selector-tag>-09-12</span> 14<span class=hljs-selector-pseudo>:35</span><span class=hljs-selector-pseudo>:41</span> 140238333712128 <span class=hljs-selector-attr>[Note]</span> <span class=hljs-selector-tag>Event</span> <span class=hljs-selector-tag>Scheduler</span>: <span class=hljs-selector-tag>Purging</span> <span class=hljs-selector-tag>the</span> <span class=hljs-selector-tag>queue</span>. 0 <span class=hljs-selector-tag>events</span>
2020<span class=hljs-selector-tag>-09-12</span> 14<span class=hljs-selector-pseudo>:35</span><span class=hljs-selector-pseudo>:41</span> 140236692629248 <span class=hljs-selector-attr>[Note]</span> <span class=hljs-selector-tag>InnoDB</span>: <span class=hljs-selector-tag>FTS</span> <span class=hljs-selector-tag>optimize</span> <span class=hljs-selector-tag>thread</span> <span class=hljs-selector-tag>exiting</span>.
2020<span class=hljs-selector-tag>-09-12</span> 14<span class=hljs-selector-pseudo>:35</span><span class=hljs-selector-pseudo>:41</span> 140238333712128 <span class=hljs-selector-attr>[Note]</span> <span class=hljs-selector-tag>InnoDB</span>: <span class=hljs-selector-tag>Starting</span> <span class=hljs-selector-tag>shutdown</span>...
2020<span class=hljs-selector-tag>-09-12</span> 14<span class=hljs-selector-pseudo>:35</span><span class=hljs-selector-pseudo>:41</span> 140238333712128 <span class=hljs-selector-attr>[Note]</span> <span class=hljs-selector-tag>InnoDB</span>: <span class=hljs-selector-tag>Waiting</span> <span class=hljs-selector-tag>for</span> <span class=hljs-selector-tag>page_cleaner</span> <span class=hljs-selector-tag>to</span> <span class=hljs-selector-tag>finish</span> <span class=hljs-selector-tag>flushing</span> <span class=hljs-selector-tag>of</span> <span class=hljs-selector-tag>buffer</span> <span class=hljs-selector-tag>pool</span>
2020<span class=hljs-selector-tag>-09-12</span> 14<span class=hljs-selector-pseudo>:35</span><span class=hljs-selector-pseudo>:43</span> 140238333712128 <span class=hljs-selector-attr>[Note]</span> <span class=hljs-selector-tag>InnoDB</span>: <span class=hljs-selector-tag>Shutdown</span> <span class=hljs-selector-tag>completed</span>; <span class=hljs-selector-tag>log</span> <span class=hljs-selector-tag>sequence</span> <span class=hljs-selector-tag>number</span> 3710056674
2020<span class=hljs-selector-tag>-09-12</span> 14<span class=hljs-selector-pseudo>:35</span><span class=hljs-selector-pseudo>:43</span> 140238333712128 <span class=hljs-selector-attr>[Note]</span> /<span class=hljs-selector-tag>usr</span>/<span class=hljs-selector-tag>sbin</span>/<span class=hljs-selector-tag>mysqld</span>: <span class=hljs-selector-tag>Shutdown</span> <span class=hljs-selector-tag>complete</span>
</code></pre><p>実際にアプリにリクエストが来たのは、15:03:13 UTCでした。<pre><code class="hljs language-css"><span class=hljs-selector-tag>Sep</span> 12 14<span class=hljs-selector-pseudo>:20</span><span class=hljs-selector-pseudo>:45</span> <span class=hljs-selector-tag>s1</span> <span class=hljs-selector-tag>isuumo</span><span class=hljs-selector-attr>[903]</span>: ⇨ <span class=hljs-selector-tag>http</span> <span class=hljs-selector-tag>server</span> <span class=hljs-selector-tag>started</span> <span class=hljs-selector-tag>on</span> <span class=hljs-selector-attr>[::]</span><span class=hljs-selector-pseudo>:1323</span>
<span class=hljs-selector-tag>Sep</span> 12 15<span class=hljs-selector-pseudo>:03</span><span class=hljs-selector-pseudo>:13</span> <span class=hljs-selector-tag>s1</span> <span class=hljs-selector-tag>isuumo</span><span class=hljs-selector-attr>[903]</span>: <span class=hljs-selector-attr>[mysql]</span> 2020/09/12 15<span class=hljs-selector-pseudo>:03</span><span class=hljs-selector-pseudo>:13</span> <span class=hljs-selector-tag>packets</span><span class=hljs-selector-class>.go</span><span class=hljs-selector-pseudo>:122</span>: <span class=hljs-selector-tag>closing</span> <span class=hljs-selector-tag>bad</span> <span class=hljs-selector-tag>idle</span> <span class=hljs-selector-tag>connection</span>: <span class=hljs-selector-tag>unexpected</span> <span class=hljs-selector-tag>read</span> <span class=hljs-selector-tag>from</span> <span class=hljs-selector-tag>socke</span>
<span class=hljs-selector-tag>Sep</span> 12 15<span class=hljs-selector-pseudo>:03</span><span class=hljs-selector-pseudo>:13</span> <span class=hljs-selector-tag>s1</span> <span class=hljs-selector-tag>isuumo</span><span class=hljs-selector-attr>[903]</span>: <span class=hljs-selector-attr>[mysql]</span> 2020/09/12 15<span class=hljs-selector-pseudo>:03</span><span class=hljs-selector-pseudo>:13</span> <span class=hljs-selector-tag>connection</span><span class=hljs-selector-class>.go</span><span class=hljs-selector-pseudo>:158</span>: <span class=hljs-selector-tag>driver</span>: <span class=hljs-selector-tag>bad</span> <span class=hljs-selector-tag>connection</span>
<span class=hljs-selector-tag>Sep</span> 12 15<span class=hljs-selector-pseudo>:03</span><span class=hljs-selector-pseudo>:13</span> <span class=hljs-selector-tag>s1</span> <span class=hljs-selector-tag>isuumo</span><span class=hljs-selector-attr>[903]</span>: <span class=hljs-selector-attr>[mysql]</span> 2020/09/12 15<span class=hljs-selector-pseudo>:03</span><span class=hljs-selector-pseudo>:13</span> <span class=hljs-selector-tag>packets</span><span class=hljs-selector-class>.go</span><span class=hljs-selector-pseudo>:122</span>: <span class=hljs-selector-tag>closing</span> <span class=hljs-selector-tag>bad</span> <span class=hljs-selector-tag>idle</span> <span class=hljs-selector-tag>connection</span>: <span class=hljs-selector-tag>unexpected</span> <span class=hljs-selector-tag>read</span> <span class=hljs-selector-tag>from</span> <span class=hljs-selector-tag>socke</span>
<span class=hljs-selector-tag>Sep</span> 12 15<span class=hljs-selector-pseudo>:03</span><span class=hljs-selector-pseudo>:13</span> <span class=hljs-selector-tag>s1</span> <span class=hljs-selector-tag>isuumo</span><span class=hljs-selector-attr>[903]</span>: <span class=hljs-selector-attr>[mysql]</span> 2020/09/12 15<span class=hljs-selector-pseudo>:03</span><span class=hljs-selector-pseudo>:13</span> <span class=hljs-selector-tag>connection</span><span class=hljs-selector-class>.go</span><span class=hljs-selector-pseudo>:158</span>: <span class=hljs-selector-tag>driver</span>: <span class=hljs-selector-tag>bad</span> <span class=hljs-selector-tag>connection</span>
</code></pre><p>このとき、もうmariadbはshutdown済みなので、当然アプリは動かないわけですね……<h2>開始後即サーバを破壊</h2><h3>経緯</h3><p>本選始まって直後の話。<p>NaruseJunチームでは、Makefileをタスクランナー的に使っていて、<a href=https://github.com/narusejun/isucon10-final/blob/master/Makefile rel="noopener noreferrer"target=_blank>ここ</a>にデプロイコマンドを書いていました。 sekaiがアプリにpprofを埋め込んだコードをプッシュし、サーバ上にデプロイしようとして<code>make deploy</code>を叩いたところ、なぜか途中で<code>sh: Command not found</code>のエラーが出てmakeが終了しました。<p>アレ？<code>sh</code>って存在しないんだっけと思い、今度は<code>ls -l /usr/bin/sh</code>を実行してみると、今度は<code>bash: /usr/bin/ls: No such file or directory</code>が…… ここで全てを悟ります。これ、シェル組み込みのコマンド以外、全て使えなくなってるな……？<p>心当たりがないわけではありませんでした。3人共、ある会話が頭をよぎりました…… あれは予選時のことです――――<blockquote><p>sekai「ミドルウェアの設定ファイルなども、リポジトリに含めてしまって、デプロイ時にrsyncで配置するようにしませんか？」<br>takashi「rsyncですか？どうやってやるんですか」<br>sekai「コマンド一発でできますよ。<a href=https://github.com/narusejun/isucon10-qualify/blob/master/Makefile#L50 rel="noopener noreferrer"target=_blank>こう</a>ですね」</blockquote><pre><code class="hljs language-awk">$ ls files
etc<span class=hljs-regexp>/       home/</span>      lib/
$ sudo rsync -r files<span class=hljs-regexp>/ /</span>
</code></pre><blockquote><p>takashi「<strong>これってもともとサーバ上にあるファイルが消えたりしませんか？</strong>」←ここフラグ<br>sekai「大丈夫ですよ。ほら、追加したファイルだけ更新されてるでしょ？」</blockquote><p>予選では確かに、このコマンドでうまくデプロイできていました。 ですので、本選でも同じように設定ファイル類を配置しようとしていました。<p>しかしながら、事実、サーバが壊れました。何故でしょう…… このときのログはこうでした。<pre><code class="hljs language-gradle">〜〜〜略〜〜〜
make[<span class=hljs-number>1</span>]: Leaving directory <span class=hljs-string>'/home/isucon/isucon10-final/app/webapp/golang'</span>
sudo rsync -v -r s1<span class=hljs-regexp>/ /</span>
sending incremental <span class=hljs-keyword>file</span> list
deploy.sh
skipping non-regular <span class=hljs-keyword>file</span> <span class=hljs-string>"etc/mysql/my.cnf"</span>
etc<span class=hljs-regexp>/envoy/</span>config.yaml
etc<span class=hljs-regexp>/mysql/</span>debian-start
etc<span class=hljs-regexp>/mysql/</span>debian.cnf
etc<span class=hljs-regexp>/mysql/my</span>.cnf.fallback
etc<span class=hljs-regexp>/mysql/my</span>sql.cnf
etc<span class=hljs-regexp>/mysql/</span>conf.d/mysql.cnf
etc<span class=hljs-regexp>/mysql/</span>conf.d/mysqldump.cnf
etc<span class=hljs-regexp>/mysql/my</span>sql.conf.d/mysql.cnf
etc<span class=hljs-regexp>/mysql/my</span>sql.conf.d/mysqld.cnf
etc<span class=hljs-regexp>/systemd/</span>system/envoy.service
etc<span class=hljs-regexp>/systemd/</span>system/xsuportal-api-golang.service
etc<span class=hljs-regexp>/systemd/</span>system/xsuportal-web-golang.service
home<span class=hljs-regexp>/isucon/</span>env
lib/
lib<span class=hljs-regexp>/systemd/</span>
lib<span class=hljs-regexp>/systemd/</span>system/
lib<span class=hljs-regexp>/systemd/</span>system<span class=hljs-regexp>/mysql.servicesent 11,952 bytes  received 375 bytes  24,654.00 bytes/</span>sec
total <span class=hljs-keyword>size</span> is <span class=hljs-number>10</span>,<span class=hljs-number>449</span>  speedup is <span class=hljs-number>0.85</span>
sh s1/deploy.sh
make: sh: Command not found
make: *** [Makefile:<span class=hljs-number>54</span>: start] Error <span class=hljs-number>127</span>
</code></pre><p>う〜ん、<code>--delete</code>オプションも付けてないし、このログを見ても特におかしくないしなあ。 本選時はそう思っていました。<p>ここを詳しく調査する時間がもったいないので、運営にサーバをリセットしてもらい（ご迷惑おかけしました……）、とりあえず危険なMakefileは使用禁止として競技に戻りました。<h3>その後</h3><p>競技は無事(?)終了し、翌日。ちゃんと調査しました。<p>さて、件のログをよ〜く見ると、なんだかヤバそうなところが見つかりますね！？<p>正解は<code>lib/</code>とだけ書いてある行です。 これは、rsyncによって<code>lib/</code>というディレクトリ、今回は宛先が<code>/</code>なので、要は<code>/lib</code>が作成されたという意味です。 んん？？それはマズくないか？？？？？<p>マズいです。コマンドがほぼ使えなくなったのは、間違いなく<code>/lib</code>にある共有ライブラリなどが消滅したからでしょう。<p>でも、予選時はちゃんと動いていたんです。じゃあなんで？？？<p>答えは、Ubuntuのバージョン違いにありました。 予選では18.04、本選では20.04です。各バージョンでのルートディレクトリがどうなっているかと言うと……<p>18.04では、こう。<pre><code class="hljs language-apache"><span class=hljs-comment># ls -l /</span>
<span class=hljs-attribute>total</span> <span class=hljs-number>64</span>
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>2</span> root root <span class=hljs-number>4096</span> Sep <span class=hljs-number>21</span> <span class=hljs-number>17</span>:<span class=hljs-number>17</span> bin
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>2</span> root root <span class=hljs-number>4096</span> Apr <span class=hljs-number>24</span>  <span class=hljs-number>2018</span> boot
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>5</span> root root  <span class=hljs-number>360</span> Oct  <span class=hljs-number>4</span> <span class=hljs-number>07</span>:<span class=hljs-number>46</span> dev
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>1</span> root root <span class=hljs-number>4096</span> Oct  <span class=hljs-number>4</span> <span class=hljs-number>07</span>:<span class=hljs-number>46</span> etc
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>2</span> root root <span class=hljs-number>4096</span> Apr <span class=hljs-number>24</span>  <span class=hljs-number>2018</span> home
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>8</span> root root <span class=hljs-number>4096</span> May <span class=hljs-number>23</span>  <span class=hljs-number>2017</span> lib
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>2</span> root root <span class=hljs-number>4096</span> Sep <span class=hljs-number>21</span> <span class=hljs-number>17</span>:<span class=hljs-number>16</span> lib<span class=hljs-number>64</span>
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>2</span> root root <span class=hljs-number>4096</span> Sep <span class=hljs-number>21</span> <span class=hljs-number>17</span>:<span class=hljs-number>14</span> media
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>2</span> root root <span class=hljs-number>4096</span> Sep <span class=hljs-number>21</span> <span class=hljs-number>17</span>:<span class=hljs-number>14</span> mnt
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>2</span> root root <span class=hljs-number>4096</span> Sep <span class=hljs-number>21</span> <span class=hljs-number>17</span>:<span class=hljs-number>14</span> opt
<span class=hljs-attribute>dr</span>-xr-xr-x <span class=hljs-number>174</span> root root    <span class=hljs-number>0</span> Oct  <span class=hljs-number>4</span> <span class=hljs-number>07</span>:<span class=hljs-number>46</span> proc
<span class=hljs-attribute>drwx</span>------   <span class=hljs-number>2</span> root root <span class=hljs-number>4096</span> Sep <span class=hljs-number>21</span> <span class=hljs-number>17</span>:<span class=hljs-number>17</span> root
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>1</span> root root <span class=hljs-number>4096</span> Sep <span class=hljs-number>25</span> <span class=hljs-number>22</span>:<span class=hljs-number>33</span> run
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>1</span> root root <span class=hljs-number>4096</span> Sep <span class=hljs-number>25</span> <span class=hljs-number>22</span>:<span class=hljs-number>33</span> sbin
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>2</span> root root <span class=hljs-number>4096</span> Sep <span class=hljs-number>21</span> <span class=hljs-number>17</span>:<span class=hljs-number>14</span> srv
<span class=hljs-attribute>dr</span>-xr-xr-x  <span class=hljs-number>13</span> root root    <span class=hljs-number>0</span> Oct  <span class=hljs-number>4</span> <span class=hljs-number>07</span>:<span class=hljs-number>46</span> sys
<span class=hljs-attribute>drwxrwxrwt</span>   <span class=hljs-number>2</span> root root <span class=hljs-number>4096</span> Sep <span class=hljs-number>21</span> <span class=hljs-number>17</span>:<span class=hljs-number>17</span> tmp
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>1</span> root root <span class=hljs-number>4096</span> Sep <span class=hljs-number>21</span> <span class=hljs-number>17</span>:<span class=hljs-number>14</span> usr
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>1</span> root root <span class=hljs-number>4096</span> Sep <span class=hljs-number>21</span> <span class=hljs-number>17</span>:<span class=hljs-number>17</span> var
</code></pre><p>一方で20.04では……？<pre><code class="hljs language-apache"><span class=hljs-comment># ls -l /</span>
<span class=hljs-attribute>total</span> <span class=hljs-number>48</span>
<span class=hljs-attribute>lrwxrwxrwx</span>   <span class=hljs-number>1</span> root root    <span class=hljs-number>7</span> Sep <span class=hljs-number>25</span> <span class=hljs-number>01</span>:<span class=hljs-number>20</span> bin -> usr/bin
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>2</span> root root <span class=hljs-number>4096</span> Apr <span class=hljs-number>15</span> <span class=hljs-number>11</span>:<span class=hljs-number>09</span> boot
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>5</span> root root  <span class=hljs-number>360</span> Oct  <span class=hljs-number>4</span> <span class=hljs-number>07</span>:<span class=hljs-number>46</span> dev
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>1</span> root root <span class=hljs-number>4096</span> Oct  <span class=hljs-number>4</span> <span class=hljs-number>07</span>:<span class=hljs-number>46</span> etc
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>2</span> root root <span class=hljs-number>4096</span> Apr <span class=hljs-number>15</span> <span class=hljs-number>11</span>:<span class=hljs-number>09</span> home
<span class=hljs-attribute>lrwxrwxrwx</span>   <span class=hljs-number>1</span> root root    <span class=hljs-number>7</span> Sep <span class=hljs-number>25</span> <span class=hljs-number>01</span>:<span class=hljs-number>20</span> lib -> usr/lib
<span class=hljs-attribute>lrwxrwxrwx</span>   <span class=hljs-number>1</span> root root    <span class=hljs-number>9</span> Sep <span class=hljs-number>25</span> <span class=hljs-number>01</span>:<span class=hljs-number>20</span> lib<span class=hljs-number>32</span> -> usr/lib<span class=hljs-number>32</span>
<span class=hljs-attribute>lrwxrwxrwx</span>   <span class=hljs-number>1</span> root root    <span class=hljs-number>9</span> Sep <span class=hljs-number>25</span> <span class=hljs-number>01</span>:<span class=hljs-number>20</span> lib<span class=hljs-number>64</span> -> usr/lib<span class=hljs-number>64</span>
<span class=hljs-attribute>lrwxrwxrwx</span>   <span class=hljs-number>1</span> root root   <span class=hljs-number>10</span> Sep <span class=hljs-number>25</span> <span class=hljs-number>01</span>:<span class=hljs-number>20</span> libx<span class=hljs-number>32</span> -> usr/libx<span class=hljs-number>32</span>
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>2</span> root root <span class=hljs-number>4096</span> Sep <span class=hljs-number>25</span> <span class=hljs-number>01</span>:<span class=hljs-number>20</span> media
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>2</span> root root <span class=hljs-number>4096</span> Sep <span class=hljs-number>25</span> <span class=hljs-number>01</span>:<span class=hljs-number>20</span> mnt
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>2</span> root root <span class=hljs-number>4096</span> Sep <span class=hljs-number>25</span> <span class=hljs-number>01</span>:<span class=hljs-number>20</span> opt
<span class=hljs-attribute>dr</span>-xr-xr-x <span class=hljs-number>171</span> root root    <span class=hljs-number>0</span> Oct  <span class=hljs-number>4</span> <span class=hljs-number>07</span>:<span class=hljs-number>46</span> proc
<span class=hljs-attribute>drwx</span>------   <span class=hljs-number>2</span> root root <span class=hljs-number>4096</span> Sep <span class=hljs-number>25</span> <span class=hljs-number>01</span>:<span class=hljs-number>23</span> root
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>1</span> root root <span class=hljs-number>4096</span> Sep <span class=hljs-number>25</span> <span class=hljs-number>22</span>:<span class=hljs-number>34</span> run
<span class=hljs-attribute>lrwxrwxrwx</span>   <span class=hljs-number>1</span> root root    <span class=hljs-number>8</span> Sep <span class=hljs-number>25</span> <span class=hljs-number>01</span>:<span class=hljs-number>20</span> sbin -> usr/sbin
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>2</span> root root <span class=hljs-number>4096</span> Sep <span class=hljs-number>25</span> <span class=hljs-number>01</span>:<span class=hljs-number>20</span> srv
<span class=hljs-attribute>dr</span>-xr-xr-x  <span class=hljs-number>13</span> root root    <span class=hljs-number>0</span> Oct  <span class=hljs-number>4</span> <span class=hljs-number>07</span>:<span class=hljs-number>46</span> sys
<span class=hljs-attribute>drwxrwxrwt</span>   <span class=hljs-number>2</span> root root <span class=hljs-number>4096</span> Sep <span class=hljs-number>25</span> <span class=hljs-number>01</span>:<span class=hljs-number>23</span> tmp
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>1</span> root root <span class=hljs-number>4096</span> Sep <span class=hljs-number>25</span> <span class=hljs-number>01</span>:<span class=hljs-number>20</span> usr
<span class=hljs-attribute>drwxr</span>-xr-x   <span class=hljs-number>1</span> root root <span class=hljs-number>4096</span> Sep <span class=hljs-number>25</span> <span class=hljs-number>01</span>:<span class=hljs-number>23</span> var
</code></pre><p>アッ……（完全に理解）<p>Ubuntu 20.04では、<code>/lib</code>は通常のディレクトリではなく、<code>/usr/lib</code>へのシンボリックリンクでした！ rsyncでは、デフォルトではシンボリックリンクの先がディレクトリであっても、それを辿ってその先にコピーをしたりしません。 ソース側のディレクトリでそのまま上書きして、もとのリンクは消してしまうんですね……！<h3>教訓</h3><p>この悲劇を回避するには、rsyncの<code>--keep-dirlinks</code>というオプションを使うべきでした。 以下、<code>man rsync</code>より引用です。<blockquote><p>-K, --keep-dirlinks This option causes the receiving side to treat a symlink to a directory as though it were a real directory, but only if it matches a real directory from the sender. Without this option, the receiver's symlink would be deleted and replaced with a real directory. For example, suppose you transfer a directory lqfoorq that contains a file lqfilerq, but lqfoorq is a symlink to directory lqbarrq on the receiver. Without --keep-dirlinks, the receiver deletes symlink lqfoorq, recreates it as a directory, and receives the file into the new directory. With --keep-dirlinks, the receiver keeps the symlink and lqfilerq ends up in lqbarrq.</blockquote><p>ちょうどボクが踏んだ罠について言及されています。 rsyncは気をつけて使います……<h2>おしまい</h2><p>ISUCONは学びが多い。<p>あと、予選で雑にmysqlの全テーブルをMEMORYストレージエンジンにしたらメモリが完売してSSHできなくなって焦るなどの事件もありました。 （運営に再起動してもらって事なきを得ました。）</article><div class="SocialShare_social__3xEln"><a rel="noopener noreferrer" target="_blank" href="https://social-plugins.line.me/lineit/share?url=https%3A%2F%2F6715.jp%2Fposts%2F28%2F"><span title="LINE" style="background-color:#00C300"><svg viewBox="0 0 24 24"><path fill="white" d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="http://twitter.com/share?url=https%3A%2F%2F6715.jp%2Fposts%2F28%2F&amp;text=ISUCON10%20%E3%82%84%E3%82%89%E3%81%8B%E3%81%97%E3%83%AA%E3%82%B9%E3%83%88%20%7C%206715.jp"><span title="Twitter" style="background-color:#1DA1F2"><svg viewBox="0 0 24 24"><path fill="white" d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2F6715.jp%2Fposts%2F28%2F"><span title="Facebook" style="background-color:#1877F2"><svg viewBox="0 0 24 24"><path fill="white" d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="http://b.hatena.ne.jp/add?url=https%3A%2F%2F6715.jp%2Fposts%2F28%2F"><span title="Hatena Bookmark" style="background-color:#00A4DE"><svg viewBox="0 0 24 24"><path fill="white" d="M20.47 0C22.42 0 24 1.58 24 3.53v16.94c0 1.95-1.58 3.53-3.53 3.53H3.53C1.58 24 0 22.42 0 20.47V3.53C0 1.58 1.58 0 3.53 0h16.94zm-3.705 14.47c-.78 0-1.41.63-1.41 1.41s.63 1.414 1.41 1.414 1.41-.645 1.41-1.425-.63-1.41-1.41-1.41zM8.61 17.247c1.2 0 2.056-.042 2.58-.12.526-.084.976-.222 1.32-.412.45-.232.78-.564 1.02-.99s.36-.915.36-1.48c0-.78-.21-1.403-.63-1.87-.42-.48-.99-.734-1.74-.794.66-.18 1.156-.45 1.456-.81.315-.344.465-.824.465-1.424 0-.48-.103-.885-.3-1.26-.21-.36-.493-.645-.883-.87-.345-.195-.735-.315-1.215-.405-.464-.074-1.29-.12-2.474-.12H5.654v10.486H8.61zm.736-4.185c.705 0 1.185.088 1.44.262.27.18.39.495.39.93 0 .405-.135.69-.42.855-.27.18-.765.254-1.44.254H8.31v-2.297h1.05zm8.656.706v-7.06h-2.46v7.06H18zM8.925 9.08c.71 0 1.185.08 1.432.24.245.16.367.435.367.83 0 .38-.13.646-.39.804-.265.154-.747.232-1.452.232h-.57V9.08h.615z"></path></svg></span></a></div></main><footer class="Footer_footer__22y9A"><div id="profile" class="Footer_profile__39Joc"><img src="https://res.cloudinary.com/narusejun/image/twitter_name/h_128/sekai67.jpg" alt="sekai"/><div><small>Author</small><strong>sekai<a rel="noopener noreferrer" target="_blank" href="https://github.com/kaz"><span title="GitHub" style="background-color:initial"><svg viewBox="0 0 24 24"><path fill="#181717" d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="https://twitter.com/sekai67"><span title="Twitter" style="background-color:initial"><svg viewBox="0 0 24 24"><path fill="#1DA1F2" d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="https://www.facebook.com/sawada.kazuki"><span title="Facebook" style="background-color:initial"><svg viewBox="0 0 24 24"><path fill="#1877F2" d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path></svg></span></a></strong><p>インフラとDXが好き</p></div></div><div class="Footer_copyright__3QtRW">© <!-- -->2016 sekai</div></footer></div></body></html>