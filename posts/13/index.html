<!DOCTYPE html><html lang="ja"><head><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-XKSQ648BQ2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-XKSQ648BQ2')</script><meta charSet="utf-8"/><meta name="format-detection" content="telephone=no"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="author" content="sekai"/><meta name="generator" content="https://github.com/kaz/nextjs-blog-scaffold"/><meta property="og:url" content="https://6715.jp/posts/13/"/><meta property="og:site_name" content="6715.jp"/><link rel="icon" href="https://res.cloudinary.com/narusejun/image/twitter_name/h_128/sekai67.jpg"/><link rel="canonical" href="https://6715.jp/posts/13/"/><title>CTF for ビギナーズ 2016 金沢 に行った (writeup) | 6715.jp</title><meta name="description" content="行きました 東京から参りました成瀬順と申します。 CTF4b東京は大人気だったらしく行けなかったので、金沢へ参加しました。 Web ChromeのDevToolsの使い方 ディレクトリトラバーサル …"/><meta name="twitter:card" content="summary"/><meta property="og:title" content="CTF for ビギナーズ 2016 金沢 に行った (writeup) | 6715.jp"/><meta property="og:type" content="article"/><meta property="og:image" content="https://res.cloudinary.com/narusejun/image/twitter_name/h_128/sekai67.jpg"/><meta property="og:description" content="行きました 東京から参りました成瀬順と申します。 CTF4b東京は大人気だったらしく行けなかったので、金沢へ参加しました。 Web ChromeのDevToolsの使い方 ディレクトリトラバーサル …"/><meta property="article:published_time" content="2016-11-27T00:00:00.000Z"/><meta property="article:author" content="sekai"/><meta property="article:tag" content="CTF"/><meta property="article:tag" content="CTF4b"/><meta property="article:tag" content="参加記"/><meta name="next-head-count" content="21"/><link rel="preload" href="/_next/static/css/61bb26da18d2752efee9.css" as="style"/><link rel="stylesheet" href="/_next/static/css/61bb26da18d2752efee9.css" data-n-g=""/><link rel="preload" href="/_next/static/css/ad30b8ddc18c06e71d13.css" as="style"/><link rel="stylesheet" href="/_next/static/css/ad30b8ddc18c06e71d13.css" data-n-p=""/><noscript data-n-css=""></noscript></head><body><div id="__next"><header class="Header_header__1mCED"><h1><a href="/">6715.jp</a></h1></header><main class="posts_post__IJEgW"><section class="posts_meta__26MyQ"><small>2016-11-27</small><h1>CTF for ビギナーズ 2016 金沢 に行った (writeup)</h1><div><div><img src="https://res.cloudinary.com/narusejun/image/twitter_name/h_128/sekai67.jpg" alt="sekai"/><a href="#profile">sekai</a></div><div><svg aria-hidden="true" role="img" class="octicon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom"><path fill-rule="evenodd" d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z"></path></svg><a href="/tags/CTF/">CTF</a><a href="/tags/CTF4b/">CTF4b</a><a href="/tags/%E5%8F%82%E5%8A%A0%E8%A8%98/">参加記</a></div></div></section><div class="SocialShare_social__3xEln"><a rel="noopener noreferrer" target="_blank" href="https://social-plugins.line.me/lineit/share?url=https%3A%2F%2F6715.jp%2Fposts%2F13%2F"><span title="LINE" style="background-color:#00C300"><svg viewBox="0 0 24 24"><path fill="white" d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="http://twitter.com/share?url=https%3A%2F%2F6715.jp%2Fposts%2F13%2F&amp;text=CTF%20for%20%E3%83%93%E3%82%AE%E3%83%8A%E3%83%BC%E3%82%BA%202016%20%E9%87%91%E6%B2%A2%20%E3%81%AB%E8%A1%8C%E3%81%A3%E3%81%9F%20(writeup)%20%7C%206715.jp"><span title="Twitter" style="background-color:#1DA1F2"><svg viewBox="0 0 24 24"><path fill="white" d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2F6715.jp%2Fposts%2F13%2F"><span title="Facebook" style="background-color:#1877F2"><svg viewBox="0 0 24 24"><path fill="white" d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="http://b.hatena.ne.jp/add?url=https%3A%2F%2F6715.jp%2Fposts%2F13%2F"><span title="Hatena Bookmark" style="background-color:#00A4DE"><svg viewBox="0 0 24 24"><path fill="white" d="M20.47 0C22.42 0 24 1.58 24 3.53v16.94c0 1.95-1.58 3.53-3.53 3.53H3.53C1.58 24 0 22.42 0 20.47V3.53C0 1.58 1.58 0 3.53 0h16.94zm-3.705 14.47c-.78 0-1.41.63-1.41 1.41s.63 1.414 1.41 1.414 1.41-.645 1.41-1.425-.63-1.41-1.41-1.41zM8.61 17.247c1.2 0 2.056-.042 2.58-.12.526-.084.976-.222 1.32-.412.45-.232.78-.564 1.02-.99s.36-.915.36-1.48c0-.78-.21-1.403-.63-1.87-.42-.48-.99-.734-1.74-.794.66-.18 1.156-.45 1.456-.81.315-.344.465-.824.465-1.424 0-.48-.103-.885-.3-1.26-.21-.36-.493-.645-.883-.87-.345-.195-.735-.315-1.215-.405-.464-.074-1.29-.12-2.474-.12H5.654v10.486H8.61zm.736-4.185c.705 0 1.185.088 1.44.262.27.18.39.495.39.93 0 .405-.135.69-.42.855-.27.18-.765.254-1.44.254H8.31v-2.297h1.05zm8.656.706v-7.06h-2.46v7.06H18zM8.925 9.08c.71 0 1.185.08 1.432.24.245.16.367.435.367.83 0 .38-.13.646-.39.804-.265.154-.747.232-1.452.232h-.57V9.08h.615z"></path></svg></span></a></div><article class="posts_content__YuXhG"><p>行きました<p>東京から参りました成瀬順と申します。<p>CTF4b東京は大人気だったらしく行けなかったので、金沢へ参加しました。<h1>Web</h1><ul><li>ChromeのDevToolsの使い方<li>ディレクトリトラバーサル<li>SQLインジェクション<li>XSS(の紹介だけ)</ul><p>演習中心で、実際にやってみよう！って感じなので楽しくて分かりやすかったです。<p>あとディレクトリトラバーサルとかSQLインジェクションの演習になんか隠しFLAGみたいなものが置いてあって、 †ビギナー†の人も楽しめそうでした。<p>SQLiの方の隠しFLAGは見つけられました <code>web4b{can_access_another_table}</code><h1>Forensics</h1><ul><li>Forensicsとは<li>ネットワークについて<li>ツールの使い方<ul><li>Wireshark<li>binwalk<li>exiftool<li>The Sleuth Kit</ul></ul><p>Forensicsは全く知識がなかったので色々勉強になりました。 Wiresharkの便利な機能をたくさん知れたので強くなった気がします💪<h1>Reversing</h1><ul><li>プログラム実行の仕組み<li>x86アセンブリ入門</ul><p>ちょうど大学でx86を勉強したところだったので、なんとかついていけました。 <strong>上達のコツ</strong>はたくさん読むことだそうです（がんばります＞＜）<h1>CTF</h1><p>講義で学んだことを活かしてみよう！というやつです。<p>がんばって全部解きました！<p><img alt src=1.png><blockquote class=twitter-tweet><p dir=ltr lang=ja>ctf for ビギナーズ金沢で出ました、まさかの全問正解！！</p>— SECCON Beginners (@ctf4b) <a href="https://twitter.com/ctf4b/status/802446106776850432?ref_src=twsrc%5Etfw">November 26, 2016</a></blockquote><script async charset=utf8 src=https://platform.twitter.com/widgets.js></script><p>FLAGためて10分前にまとめて出してみました。 いわゆるサブマリン戦法です。（一度やってみたかったんです＞＜）<p>以下Writeup<h2>Warmup (Misc 10)</h2><p>やるだけ<h2>てけいさん for ビギナーズ (Misc 200)</h2><p>めっちゃ簡単な計算問題が100問出されるので全部解いてねって問題でした。 与えられたURLにアクセスすると計算式が書いてあって、その下にあるフォームに値を入力してSubmitするようになってます。 たぶんPHPのSESSIONで何問解いたかをカウントしてるので、ここはどうにもできなさそうです。<p>最初ふつうに100問解こうかなと思ったんだけど間違えたらリセットされるみたいなのでやめました。<p>JavaScriptを書いて(Web講義で習ったDevToolsを使って)100回走らせました。<pre><code class="hljs language-javascript"><span class=hljs-built_in>document</span>.querySelector(<span class=hljs-string>"input[type=text]"</span>).value = <span class=hljs-built_in>eval</span>(<span class=hljs-built_in>document</span>.querySelector(<span class=hljs-string>"div"</span>).textContent);
<span class=hljs-built_in>document</span>.querySelector(<span class=hljs-string>"input[type=submit]"</span>).click();
</code></pre><p>模範解答はPython(?)でやってたけどスクレイピングして……とかが面倒そうでした。<h2>CountUp Game (Misc 200)</h2><blockquote><p>交互にカウントアップしていこう ただし，21を言ってはいけません</blockquote><p>コンピュータと交互に1〜3づつ値を増やしていって、21を踏んだら負けるゲームを10連勝してねって問題でした。 なんか競プロでありそうな問題ですね。<p>そんなに難しくなくて、自分が必ず後攻なので、自分が必ず4の倍数を踏むようにしていれば勝てます。 たった10勝でOKなので、手でやりました。<h2>Fix it (Web 100)</h2><blockquote><p>ページ遷移を行うプログラムを書いたが何かを間違っているらしく正常に動作しないそうだ。何がおかしいのか調べてほしい。</blockquote><p>講義でやったやつだ！<p>送られてくるヘッダをよく見てみると、 <code>Locatin: /web100/flag_is_here.php</code> Typoしてます。<p>ということで、このURLにに行くとFlagが落ちてました。<h2>Login as Admin (Web 200)</h2><p>これも講義でやったやつだ！<p>SQLインジェクションっぽいですね。 ので、<pre><code class="hljs language-vbnet"><span class=hljs-symbol>username:</span> admin
<span class=hljs-symbol>password:</span> <span class=hljs-comment>' OR 1 --</span>
</code></pre><p>とかしてみたらイケました。<h2>1M4G3 V13W3R (Web 200)</h2><p>画像アップローダです。 アップされた画像を開いてみると、URLが<code>/web200-2/view.php?file=f5b5a9b812d45f55.jpg</code>とかで、怪しい。<p>講義でやったディレクトリトラバーサルかな！？<p>じゃあ<code>/web200-2/view.php?file=../index.php</code>とかすると、 PHPコメントでFlagが書いてありました。<h2>Login Lv2 (Web 300)</h2><p>またログインフォームです。 普通にSQLインジェクションを試行するんですが、どうも上手く行かないようです。 （でもエラーにはなります。うーん？）<p>適当にログインを試行していると、「ユーザー名かパスワードが間違っています。」と怒られるんですけど、 このときのURLが<code>/web300/index.php?error=invalid_user.txt</code>とかなってて、アレかなってなりました。<p>ということで、POSTリクエストの宛先である<code>/web300/index.php?error=login.php</code>を見てみると、<pre><code class="hljs language-php"><span class=hljs-variable>$sql</span> = <span class=hljs-string>"SELECT username, password FROM users WHERE username = ('<span class=hljs-subst>{$username}</span>') AND password = ('<span class=hljs-subst>{$password}</span>');"</span>;
</code></pre><p>カッコで囲んでいたんですね！ じゃあこうすれば……<pre><code class="hljs language-vbnet"><span class=hljs-symbol>username:</span> admin
<span class=hljs-symbol>password:</span> <span class=hljs-comment>') OR 1 --</span>
</code></pre><p>イケました。<h2>FileSystem (Forensics 100)</h2><p>謎のファイルが渡されます。 （なんのファイルかは問題名から察せそうですけど、）とりあえず講義で学んだように、どんなファイルであるかを調べてみます。<pre><code class="hljs language-sh"><span class=hljs-comment># file for100</span>
for100: DOS/MBR boot sector, code offset 0x3c+2, OEM-ID <span class=hljs-string>"mkfs.fat"</span>, sectors/cluster 4, root entries 512, sectors 8192 (volumes &#60=32 MB) , Media descriptor 0xf8, sectors/FAT 6, sectors/track 32, heads 64, serial number 0x742adb6b, unlabeled, FAT (12 bit)
</code></pre><p>FATですね。 ではでは、講義で習ったThe Sleuth Kitを使ってみます。<pre><code class="hljs language-sh"><span class=hljs-comment># fls for100</span>
r/r 4:   flag.txt
r/r * 6: .flag.txt.swp
v/v 130867: <span class=hljs-variable>$MBR</span>
v/v 130868: <span class=hljs-variable>$FAT1</span>
v/v 130869: <span class=hljs-variable>$FAT2</span>
d/d 130870: <span class=hljs-variable>$OrphanFiles</span>
</code></pre><p>ありますね！<pre><code class="hljs language-sh"><span class=hljs-comment># icat for100 4</span>
ctf4b{
</code></pre><p>消えてる……<p>ここで削除済みの<code>.flag.txt.swp</code>に注目します。 このファイルはvimが編集履歴を保持しておくファイルで、通常はファイルが保存されたらこのswpは削除されます。<p>でもこのイメージにはバッチリ(削除済みファイルとして)残ってるので、<pre><code class="hljs language-sh"><span class=hljs-comment># icat for100 6</span>
U3210<span class=hljs-comment>#"! Utpad????ctf4b{ff97e486da08bfec774688ca3ef6ac42}</span>
</code></pre><h3>ラクをする</h3><p>問題名から察するに、講義で紹介したThe Sleuth Kitを使ってなんかしてね！って問題なんだろうなって思ったんですけど、 stringsでゴリ押してしまいました＞＜<pre><code class="hljs language-sh">strings for100 | grep ctf4b{
</code></pre><h2>みてみよう (Forensics 200)</h2><p>pcapファイルが渡されます。<p>そんなにリクエスト数が多くなくて、PNGをダウンロードしてるHTTP通信が１つだけです。 授業で習ったように、ファイル＞オブジェクトをエクスポートでこのPNGをファイルを取り出してみます。<p>そうするとただの真っ白な画像ファイルでした。（困った……） ここで、講義で習ったbinwalkを使ってみます。<pre><code class="hljs language-sh"><span class=hljs-comment># binwalk flag.png</span>

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
0             0x0             PNG image, 320 x 240, 8-bit/color RGB, non-interlaced
41            0x29            Zlib compressed data, best compression
744           0x2E8           Unix path: /www.w3.org/1999/02/22-rdf-syntax-ns<span class=hljs-comment>#'></span>
</code></pre><p>なんかRDFのデータがくっついてますね。 じゃあ、講義で習ったexiftoolを使ってみます。<pre><code class="hljs language-sh"><span class=hljs-comment># exiftool flag.png</span>
ExifTool Version Number         : 10.20
File Name                       : flag.png
Directory                       : ..
File Size                       : 1010 bytes
File Modification Date/Time     : 2016:11:27 03:02:03+00:00
File Access Date/Time           : 2016:11:27 03:06:03+00:00
File Inode Change Date/Time     : 2016:11:27 03:02:33+00:00
File Permissions                : rwxrwx---
File Type                       : PNG
File Type Extension             : png
MIME Type                       : image/png
Image Width                     : 320
Image Height                    : 240
Bit Depth                       : 8
Color Type                      : RGB
Compression                     : Deflate/Inflate
Filter                          : Adaptive
Interlace                       : Noninterlaced
XMP Toolkit                     : Image::ExifTool 9.74
Keywords                        : ctf4b{f970e2767d0cfe75876ea857f92e319b}
Image Size                      : 320x240
Megapixels                      : 0.077
</code></pre><p>見えました！<h3>ラクをする</h3><p>たぶん講義で紹介したWiresharkを使ってFlag探してね！って問題なんだろうなって思ったんですけど、 stringsでゴリ押してしまいました＞＜<pre><code class="hljs language-sh">strings for200 | grep ctf4b{
</code></pre><h2>ICMP？ (Forensics 200)</h2><p>pcapファイルが渡されます。<p>Wiresharkで普通に開くと、pingのrequestとreplyだけが記録されています。 眺めていると、1つだけサイズが大きい通信があります。（統計＞パケット長を見ても良かったかも。）<p>で、このパケットを見ると、pingのDataに何故かHTTPレスポンスがのっています。<pre><code class="hljs language-apache"><span class=hljs-attribute>Y</span>'VERM]@@ {T HTTP/<span class=hljs-number>1</span>.<span class=hljs-number>1</span> <span class=hljs-number>200</span> OK
<span class=hljs-attribute>Date</span>: Thu, <span class=hljs-number>14</span> Jul <span class=hljs-number>2016</span> <span class=hljs-number>14</span>:<span class=hljs-number>28</span>:<span class=hljs-number>30</span> GMT
<span class=hljs-attribute>Server</span>: Apache/<span class=hljs-number>2</span>.<span class=hljs-number>4</span>.<span class=hljs-number>20</span> (Debian)
<span class=hljs-attribute>Last</span>-Modified: Thu, <span class=hljs-number>14</span> Jul <span class=hljs-number>2016</span> <span class=hljs-number>14</span>:<span class=hljs-number>21</span>:<span class=hljs-number>21</span> GMT
<span class=hljs-attribute>ETag</span>: <span class=hljs-string>"35-537993754cce4"</span>
<span class=hljs-attribute>Accept</span>-Ranges: bytes
<span class=hljs-attribute>Content</span>-Length: <span class=hljs-number>53</span>
<span class=hljs-attribute>Content</span>-Type: text/plain

<span class=hljs-attribute>Y3RmNGJ7NTM2ZGFjMzcxYWE2NTJmODY1YzIwYWJlN2I0MDk0ZGJ9</span>
<span class=hljs-attribute>n</span>
</code></pre><p>この文字列、講義で習ったbase64っぽくないですか？ ということでデコードしてみます。<pre><code class="hljs language-sh"><span class=hljs-comment># echo Y3RmNGJ7NTM2ZGFjMzcxYWE2NTJmODY1YzIwYWJlN2I0MDk0ZGJ9 | base64 -d</span>
ctf4b{536dac371aa652f865c20abe7b4094db}
</code></pre><h3>ラクをする</h3><p>まぁとりあえずstringsします！！！<pre><code class="hljs language-sh">strings for200-2
</code></pre><p>そしたらbase64っぽい文字列が見えてしまったのでデコードしたらFLAGでした。 （なんかbase64ってなんとなくわかりますよね）<h2>adminでログインしろ！ (Forensics 300)</h2><p>pcapとサービスのURLが渡されます。<p>とりあえずSQLインジェクションとか試して見るんですけど、(まぁForensicsだし)ダメでした。 で、よく見るとパスワードリセットができるようになっています。 が、リセットしようとするとメールアドレスと郵便番号を入力しろと言われます。<p>ということで、サービス管理者の通信を盗聴したっぽいpcapを見に行きます。 とりあえず脳死stringsしましたが成果がなかったので、Wiresharkを使って講義で習ったヤツをやってみました。<p>Wiresharkの統計＞プロトコル階層を見てみたところ、 なんか大量の通信の中にちょっとだけSMTP(メール送信)の通信が記録されていました。 （少ないやつは怪しいって講義で習いました。）<p>で、この通信を覗いてみる(講義で習ったFollow TCP Stream)と、 どうやら管理者と思しきアドレスから、画像つきで「引っ越しました！」みたいなメールを送っていました。<pre><code class="hljs language-basic"><span class=hljs-symbol>220 </span><span class=hljs-number>4</span>a256f335dbb Python SMTP proxy version <span class=hljs-number>0.2</span>
ehlo debian.debian
<span class=hljs-symbol>502 </span><span class=hljs-keyword>Error</span>: command <span class=hljs-string>"EHLO"</span> <span class=hljs-keyword>not</span> implemented
helo debian.debian
<span class=hljs-symbol>250 </span><span class=hljs-number>4</span>a256f335dbb
mail FROM:&#60admin@poe.ctf4b>
<span class=hljs-symbol>250 </span>Ok
rcpt <span class=hljs-keyword>TO</span>:&#60john@poe.ctf4b>
<span class=hljs-symbol>250 </span>Ok
<span class=hljs-keyword>data</span>
<span class=hljs-symbol>354 </span><span class=hljs-keyword>End</span> <span class=hljs-keyword>data</span> with &#60CR>&#60LF>.&#60CR>&#60LF>
Content-Type: multipart/mixed; boundary=<span class=hljs-string>"===============1980392290290904787=="</span>
MIME-Version: <span class=hljs-number>1.0</span>
<span class=hljs-keyword>To</span>: john@poe.ctf4b
From: admin@poe.ctf4b
Subject: 引越しました

--===============<span class=hljs-number>1980392290290904787</span>==
Content-Type: text/plain; charset=<span class=hljs-string>"us-ascii"</span>
MIME-Version: <span class=hljs-number>1.0</span>
Content-Transfer-Encoding: <span class=hljs-number>8</span>bit


会津若松に引越しました.
お近くにお越しの節はどうぞお気軽にお立ち寄り下さい.

新居から見える景色を画像で添付します.


--===============<span class=hljs-number>1980392290290904787</span>==
Content-Type: image/jpeg
MIME-Version: <span class=hljs-number>1.0</span>
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename=<span class=hljs-string>"./keshiki.jpg"</span>

&#60&#60&#60略>>>
--===============<span class=hljs-number>1980392290290904787</span>==--
.
<span class=hljs-symbol>250 </span>Ok
quit
<span class=hljs-symbol>221 </span>Bye
</code></pre><p>とりあえずこれで管理者のメールアドレス<code>admin@poe.ctf4b</code>は手に入ったので、次はメールに添付されている画像です。 画像はbase64化されてメールにくっついているので、デコードしてみるんですが、見ても写っているのが何処かなんてピンと来ません。<p>じゃあ、ということで講義で紹介されたexiftoolでEXIFを見ると…… 撮影した位置情報(GPS Position)がバッチリ残っていました。<pre><code class="hljs language-sh"><span class=hljs-comment># exiftool -GPSPosition keshiki.jpg</span>
GPS Position                    : 37 deg 29<span class=hljs-string>' 54.83" N, 139 deg 56'</span> 9.00<span class=hljs-string>" E
</span></code></pre><p>このGPS座標をGoogleMapとかに入れれば大体の場所がわかるので、あとは適当にググって郵便番号を割り出します。 で、この2つの情報でパスワードリセットすればログインしてFlagが見れます。<h2>Welcome Reversing World! (Reversing 100)</h2><p>実行すると<code>Enjoy CTF!</code>って出てきて終わります。<p>バイナリがいきなりstrippedで読むのが辛い＞＜ 頑張って読むと、<code>Enjoy CTF!</code>を表示するちょっと手前に、なんか怪しいことをしてます。<pre><code class="hljs language-x86asm"> 804841c:   c7 <span class=hljs-number>45</span> f0 <span class=hljs-number>00</span> <span class=hljs-number>00</span> <span class=hljs-number>00</span> <span class=hljs-number>00</span>    <span class=hljs-keyword>mov</span>    <span class=hljs-built_in>DWORD</span> <span class=hljs-built_in>PTR</span> [<span class=hljs-built_in>ebp</span>-<span class=hljs-number>0x10</span>],<span class=hljs-number>0x0</span>
 <span class=hljs-number>8048423</span>:   c7 <span class=hljs-number>45</span> f4 e0 <span class=hljs-number>84</span> <span class=hljs-number>04</span> <span class=hljs-number>08</span>    <span class=hljs-keyword>mov</span>    <span class=hljs-built_in>DWORD</span> <span class=hljs-built_in>PTR</span> [<span class=hljs-built_in>ebp</span>-<span class=hljs-number>0xc</span>],<span class=hljs-number>0x80484e0</span>
 804842a:   <span class=hljs-number>83</span> <span class=hljs-number>7d</span> f0 <span class=hljs-number>00</span>             <span class=hljs-keyword>cmp</span>    <span class=hljs-built_in>DWORD</span> <span class=hljs-built_in>PTR</span> [<span class=hljs-built_in>ebp</span>-<span class=hljs-number>0x10</span>],<span class=hljs-number>0x0</span>
 804842e:   <span class=hljs-number>74</span> <span class=hljs-number>10</span>                   <span class=hljs-keyword>je</span>     <span class=hljs-number>8048440</span> &#60__libc_start_main@plt+<span class=hljs-number>0x150</span>>
 <span class=hljs-number>8048430</span>:   <span class=hljs-number>83</span> ec 0c                <span class=hljs-keyword>sub</span>    <span class=hljs-built_in>esp</span>,<span class=hljs-number>0xc</span>
 <span class=hljs-number>8048433</span>:   ff <span class=hljs-number>75</span> f4                <span class=hljs-keyword>push</span>   <span class=hljs-built_in>DWORD</span> <span class=hljs-built_in>PTR</span> [<span class=hljs-built_in>ebp</span>-<span class=hljs-number>0xc</span>]
 <span class=hljs-number>8048436</span>:   e8 a5 fe ff ff          <span class=hljs-keyword>call</span>   80482e0 &#60puts@plt>
</code></pre><p>C言語っぽく書けば<pre><code class="hljs language-c"><span class=hljs-keyword>int</span> num = <span class=hljs-number>0</span>;
<span class=hljs-keyword>char</span>* flag = <span class=hljs-number>0x80484e0</span>;
<span class=hljs-keyword>if</span>(num != <span class=hljs-number>0</span>){
   <span class=hljs-built_in>puts</span>(flag);
}
</code></pre><p>みたいなカンジですね。 まぁどう考えてもif文の中が実行されるワケがないですね。 でもアドレスがわかるので、ココを見れば表示されるはずの文字列がわかります。<p><code>0x80484e0</code>は.rodataセクションの中なので、<pre><code class="hljs language-sh"><span class=hljs-comment># objdump -s -j.rodata bin100</span>

bin100:     file format elf32-i386

Contents of section .rodata:
 80484d8 03000000 01000200 63746634 627b3537  ........ctf4b{57
 80484e8 72316e36 355f6330 6d6d346e 645f6631  r1n65_c0mm4nd_f1
 80484f8 6e645f66 6c34367d 00456e6a 6f792043  nd_fl46}.Enjoy C
 8048508 54462100                             TF!.
</code></pre><p>ありました。<h3>ラクをする</h3><p>脳死stringsで見つかってしまった<pre><code class="hljs language-sh">strings bin100
</code></pre><p>作問者さんによる解説でもstringsが想定解って言ってました(?)<h2>Lecture Review (Reversing 200)</h2><p>与えられたバイナリの指定された部分(nopで囲まれたところ)を抜けると<code>%eax</code>の値はいくつになっているか？ 講義の演習でやった計算をやってみよう！ってやつですね。<p>がんばって読んで計算するだけです。<h3>ラクをする</h3><p>gdbを使うとちょっとラクできます。<pre><code class="hljs language-sh"><span class=hljs-comment># gdb -q ./bin200_1</span>
Reading symbols from ./bin200_1...(no debugging symbols found)...<span class=hljs-keyword>done</span>.
(gdb) disas main
Dump of assembler code <span class=hljs-keyword>for</span> <span class=hljs-keyword>function</span> main:
   0x08048416 &#60+0>:  push   ebp
   0x08048417 &#60+1>:  mov    ebp,esp
   0x08048419 &#60+3>:  sub    esp,0x10
   0x0804841c &#60+6>:  nop
   0x0804841d &#60+7>:  nop
   0x0804841e &#60+8>:  mov    DWORD PTR [ebp-0xc],0x14
   0x08048425 &#60+15>: mov    DWORD PTR [ebp-0x8],0x8
   0x0804842c &#60+22>: mov    DWORD PTR [ebp-0x4],0xfffffffd
   0x08048433 &#60+29>: push   DWORD PTR [ebp-0x4]
   0x08048436 &#60+32>: push   DWORD PTR [ebp-0x8]
   0x08048439 &#60+35>: push   DWORD PTR [ebp-0xc]
   0x0804843c &#60+38>: call   0x80483db &#60calc>
   0x08048441 &#60+43>: add    esp,0xc
   0x08048444 &#60+46>: mov    ds:0x804a01c,eax
   0x08048449 &#60+51>: mov    eax,ds:0x804a01c
   0x0804844e &#60+56>: nop
   0x0804844f &#60+57>: nop
   0x08048450 &#60+58>: mov    eax,0x0
   0x08048455 &#60+63>: leave
   0x08048456 &#60+64>: ret
End of assembler dump.
(gdb) b*0x0804844e
Breakpoint 1 at 0x804844e
(gdb) r
Starting program: /media/sf_share/bin200_1

Breakpoint 1, 0x0804844e <span class=hljs-keyword>in</span> main ()
(gdb) i r
eax            0xffffffe5	-27
ecx            0xd4024da0	-738046560
edx            0xffffffe8	-24
ebx            0x0	0
esp            0xffffdc18	0xffffdc18
ebp            0xffffdc28	0xffffdc28
esi            0x1	1
edi            0xf7fc6000	-134455296
eip            0x804844e	0x804844e &#60main+56>
eflags         0x296	[ PF AF SF IF ]
cs             0x23	35
ss             0x2b	43
ds             0x2b	43
es             0x2b	43
fs             0x0	0
gs             0x63	99
</code></pre><h2>Not Print FLAG (Reversing 200)</h2><p>渡されたバイナリを動かすと <code>Sorry. I forgot to display the FLAG. This message is not FLAG.</code> って言われて終わります。<p>（strippedなのでつらいのですが＞＜）バイナリをよく読んでみると、 なんだか怪しいことをしてる部分が見つかります。（↑を表示するちょっと手前の部分です）<pre><code class="hljs language-x86asm"> <span class=hljs-number>8048471</span>:   c7 <span class=hljs-number>45</span> f0 <span class=hljs-number>00</span> <span class=hljs-number>00</span> <span class=hljs-number>00</span> <span class=hljs-number>00</span>    <span class=hljs-keyword>mov</span>    <span class=hljs-built_in>DWORD</span> <span class=hljs-built_in>PTR</span> [<span class=hljs-built_in>ebp</span>-<span class=hljs-number>0x10</span>],<span class=hljs-number>0x0</span>
 <span class=hljs-number>8048478</span>:   eb <span class=hljs-number>11</span>                   <span class=hljs-keyword>jmp</span>    804848b &#60putchar@plt+<span class=hljs-number>0x13b</span>>
 804847a:   8b <span class=hljs-number>45</span> f0                <span class=hljs-keyword>mov</span>    <span class=hljs-built_in>eax</span>,<span class=hljs-built_in>DWORD</span> <span class=hljs-built_in>PTR</span> [<span class=hljs-built_in>ebp</span>-<span class=hljs-number>0x10</span>]
 <span class=hljs-number>804847d</span>:   8b <span class=hljs-number>04</span> <span class=hljs-number>85</span> <span class=hljs-number>40</span> a0 <span class=hljs-number>04</span> <span class=hljs-number>08</span>    <span class=hljs-keyword>mov</span>    <span class=hljs-built_in>eax</span>,<span class=hljs-built_in>DWORD</span> <span class=hljs-built_in>PTR</span> [<span class=hljs-built_in>eax</span>*<span class=hljs-number>4</span>+<span class=hljs-number>0x804a040</span>]
 <span class=hljs-number>8048484</span>:   <span class=hljs-number>89</span> <span class=hljs-number>45</span> f4                <span class=hljs-keyword>mov</span>    <span class=hljs-built_in>DWORD</span> <span class=hljs-built_in>PTR</span> [<span class=hljs-built_in>ebp</span>-<span class=hljs-number>0xc</span>],<span class=hljs-built_in>eax</span>
 <span class=hljs-number>8048487</span>:   <span class=hljs-number>83</span> <span class=hljs-number>45</span> f0 <span class=hljs-number>01</span>             <span class=hljs-keyword>add</span>    <span class=hljs-built_in>DWORD</span> <span class=hljs-built_in>PTR</span> [<span class=hljs-built_in>ebp</span>-<span class=hljs-number>0x10</span>],<span class=hljs-number>0x1</span>
 804848b:   8b <span class=hljs-number>45</span> f0                <span class=hljs-keyword>mov</span>    <span class=hljs-built_in>eax</span>,<span class=hljs-built_in>DWORD</span> <span class=hljs-built_in>PTR</span> [<span class=hljs-built_in>ebp</span>-<span class=hljs-number>0x10</span>]
 804848e:   <span class=hljs-number>83</span> f8 <span class=hljs-number>19</span>                <span class=hljs-keyword>cmp</span>    <span class=hljs-built_in>eax</span>,<span class=hljs-number>0x19</span>
 <span class=hljs-number>8048491</span>:   <span class=hljs-number>76</span> e7                   <span class=hljs-keyword>jbe</span>    804847a &#60putchar@plt+<span class=hljs-number>0x12a</span>>
</code></pre><p>どこかから何かを読んで<code>ebp-0xc</code>へ格納していますが、読み出した値は使ってませんね。 あー！_forgot to display_ってそういうことか！<p>で、読み出し元の<code>0x804a040</code>というのは.dataセクションなので、ココを見ると……<pre><code class="hljs language-sh"><span class=hljs-comment># objdump -s -j.data ./bin200_2</span>

./bin200_2:     file format elf32-i386

Contents of section .data:
 804a020 00000000 00000000 00000000 00000000  ................
 804a030 00000000 00000000 00000000 00000000  ................
 804a040 31000000 6e000000 37000000 5f000000  1...n...7..._...
 804a050 76000000 34000000 6c000000 75000000  v...4...l...u...
 804a060 33000000 5f000000 33000000 71000000  3..._...3...q...
 804a070 75000000 34000000 6c000000 5f000000  u...4...l..._...
 804a080 63000000 68000000 34000000 72000000  c...h...4...r...
 804a090 34000000 63000000 37000000 33000000  4...c...7...3...
 804a0a0 72000000 00000000                    r.......
</code></pre><p>それっぽいのが見つかりました。<h2>Encrypted FLAG (Reversing 300)</h2><p>FLAGを入力するとそれが正解かどうかを判定してくれるバイナリです。<p>.dataセクションになにやらそれっぽい<code>flag</code>っていう変数があります。<pre><code class="hljs language-taggerscript">(gdb) x/s 0x804a02c
0x804a02c &#60flag>:	"<span class=hljs-symbol>\2</span>26<span class=hljs-symbol>\2</span>01<span class=hljs-symbol>\2</span>23<span class=hljs-symbol>\3</span>01<span class=hljs-symbol>\2</span>27<span class=hljs-symbol>\2</span>16<span class=hljs-symbol>\2</span>15<span class=hljs-symbol>\2</span>32<span class=hljs-symbol>\2</span>07<span class=hljs-symbol>\2</span>52<span class=hljs-symbol>\2</span>15<span class=hljs-symbol>\2</span>32<span class=hljs-symbol>\2</span>07<span class=hljs-symbol>\2</span>52<span class=hljs-symbol>\2</span>06<span class=hljs-symbol>\2</span>34<span class=hljs-symbol>\2</span>30<span class=hljs-symbol>\2</span>05<span class=hljs-symbol>\2</span>31<span class=hljs-symbol>\2</span>20<span class=hljs-symbol>\2</span>52<span class=hljs-symbol>\2</span>26<span class=hljs-symbol>\2</span>07<span class=hljs-symbol>\2</span>14<span class=hljs-symbol>\2</span>05<span class=hljs-symbol>\2</span>01<span class=hljs-symbol>\3</span>24<span class=hljs-symbol>\3</span>24<span class=hljs-symbol>\2</span>10<span class=hljs-symbol>\3</span>65"
</code></pre><p>どうやら暗号化されているようで、そのままでは読めないです。<p>バイナリを読んでみると、<code>flag</code>を<code>decrypt</code>という関数で変換して、そのデータをstrcmpで入力と比較しています。<p>実際にflagを変換している部分がココ<pre><code class="hljs language-x86asm"> <span class=hljs-number>8048558</span>:   <span class=hljs-number>83</span> c4 <span class=hljs-number>10</span>                <span class=hljs-keyword>add</span>    <span class=hljs-built_in>esp</span>,<span class=hljs-number>0x10</span>
 804855b:   <span class=hljs-number>83</span> ec <span class=hljs-number>04</span>                <span class=hljs-keyword>sub</span>    <span class=hljs-built_in>esp</span>,<span class=hljs-number>0x4</span>
 804855e:   6a <span class=hljs-number>42</span>                   <span class=hljs-keyword>push</span>   <span class=hljs-number>0x42</span>
 <span class=hljs-number>8048560</span>:   6a 1e                   <span class=hljs-keyword>push</span>   <span class=hljs-number>0x1e</span>
 <span class=hljs-number>8048562</span>:   <span class=hljs-number>68</span> 2c a0 <span class=hljs-number>04</span> <span class=hljs-number>08</span>          <span class=hljs-keyword>push</span>   <span class=hljs-number>0x804a02c</span>
 <span class=hljs-number>8048567</span>:   e8 <span class=hljs-number>73</span> <span class=hljs-number>00</span> <span class=hljs-number>00</span> <span class=hljs-number>00</span>          <span class=hljs-keyword>call</span>   80485df &#60decrypt>
 804856c:   <span class=hljs-number>83</span> c4 <span class=hljs-number>10</span>                <span class=hljs-keyword>add</span>    <span class=hljs-built_in>esp</span>,<span class=hljs-number>0x10</span>
 804856f:   <span class=hljs-number>83</span> ec <span class=hljs-number>04</span>                <span class=hljs-keyword>sub</span>    <span class=hljs-built_in>esp</span>,<span class=hljs-number>0x4</span>
 <span class=hljs-number>8048572</span>:   6a b7                   <span class=hljs-keyword>push</span>   <span class=hljs-number>0xffffffb7</span>
 <span class=hljs-number>8048574</span>:   6a 1e                   <span class=hljs-keyword>push</span>   <span class=hljs-number>0x1e</span>
 <span class=hljs-number>8048576</span>:   <span class=hljs-number>68</span> 2c a0 <span class=hljs-number>04</span> <span class=hljs-number>08</span>          <span class=hljs-keyword>push</span>   <span class=hljs-number>0x804a02c</span>
 804857b:   e8 5f <span class=hljs-number>00</span> <span class=hljs-number>00</span> <span class=hljs-number>00</span>          <span class=hljs-keyword>call</span>   80485df &#60decrypt>
</code></pre><p>講義でやった関数呼び出しの話を思い出すと、 どうやら<code>decrypt</code>に<code>flag</code>のアドレス、何らかの値①、何らかの値②を順番に渡しています。<p><code>0x804a02c</code>がflagのアドレスなので、C言語っぽく書いてみると、<pre><code class="hljs language-c">decrypt(flag, <span class=hljs-number>0x1e</span>, <span class=hljs-number>0x42</span>);
decrypt(flag, <span class=hljs-number>0x1e</span>, <span class=hljs-number>0xffffffb7</span>);
</code></pre><p>この0x1e、<code>strlen(flag) == 0x1e</code>なので、どうやらflagの長さっぽいですね。<p>で、<code>decrypt</code>が何をしているかというと、<pre><code class="hljs language-x86asm">080485df &#60decrypt>:
 80485df:   <span class=hljs-number>55</span>                      <span class=hljs-keyword>push</span>   <span class=hljs-built_in>ebp</span>
 80485e0:   <span class=hljs-number>89</span> e5                   <span class=hljs-keyword>mov</span>    <span class=hljs-built_in>ebp</span>,<span class=hljs-built_in>esp</span>
 80485e2:   <span class=hljs-number>83</span> ec <span class=hljs-number>14</span>                <span class=hljs-keyword>sub</span>    <span class=hljs-built_in>esp</span>,<span class=hljs-number>0x14</span>
 80485e5:   8b <span class=hljs-number>45</span> <span class=hljs-number>10</span>                <span class=hljs-keyword>mov</span>    <span class=hljs-built_in>eax</span>,<span class=hljs-built_in>DWORD</span> <span class=hljs-built_in>PTR</span> [<span class=hljs-built_in>ebp</span>+<span class=hljs-number>0x10</span>]
 80485e8:   <span class=hljs-number>88</span> <span class=hljs-number>45</span> ec                <span class=hljs-keyword>mov</span>    <span class=hljs-built_in>BYTE</span> <span class=hljs-built_in>PTR</span> [<span class=hljs-built_in>ebp</span>-<span class=hljs-number>0x14</span>],<span class=hljs-built_in>al</span>
 80485eb:   c7 <span class=hljs-number>45</span> fc <span class=hljs-number>00</span> <span class=hljs-number>00</span> <span class=hljs-number>00</span> <span class=hljs-number>00</span>    <span class=hljs-keyword>mov</span>    <span class=hljs-built_in>DWORD</span> <span class=hljs-built_in>PTR</span> [<span class=hljs-built_in>ebp</span>-<span class=hljs-number>0x4</span>],<span class=hljs-number>0x0</span>
 80485f2:   eb 1c                   <span class=hljs-keyword>jmp</span>    <span class=hljs-number>8048610</span> &#60decrypt+<span class=hljs-number>0x31</span>>
 80485f4:   8b <span class=hljs-number>55</span> fc                <span class=hljs-keyword>mov</span>    <span class=hljs-built_in>edx</span>,<span class=hljs-built_in>DWORD</span> <span class=hljs-built_in>PTR</span> [<span class=hljs-built_in>ebp</span>-<span class=hljs-number>0x4</span>]
 80485f7:   8b <span class=hljs-number>45</span> <span class=hljs-number>08</span>                <span class=hljs-keyword>mov</span>    <span class=hljs-built_in>eax</span>,<span class=hljs-built_in>DWORD</span> <span class=hljs-built_in>PTR</span> [<span class=hljs-built_in>ebp</span>+<span class=hljs-number>0x8</span>]
 80485fa:   <span class=hljs-number>01</span> c2                   <span class=hljs-keyword>add</span>    <span class=hljs-built_in>edx</span>,<span class=hljs-built_in>eax</span>
 80485fc:   8b <span class=hljs-number>4d</span> fc                <span class=hljs-keyword>mov</span>    <span class=hljs-built_in>ecx</span>,<span class=hljs-built_in>DWORD</span> <span class=hljs-built_in>PTR</span> [<span class=hljs-built_in>ebp</span>-<span class=hljs-number>0x4</span>]
 80485ff:   8b <span class=hljs-number>45</span> <span class=hljs-number>08</span>                <span class=hljs-keyword>mov</span>    <span class=hljs-built_in>eax</span>,<span class=hljs-built_in>DWORD</span> <span class=hljs-built_in>PTR</span> [<span class=hljs-built_in>ebp</span>+<span class=hljs-number>0x8</span>]
 <span class=hljs-number>8048602</span>:   <span class=hljs-number>01</span> c8                   <span class=hljs-keyword>add</span>    <span class=hljs-built_in>eax</span>,<span class=hljs-built_in>ecx</span>
 <span class=hljs-number>8048604</span>:   0f b6 <span class=hljs-number>00</span>                <span class=hljs-keyword>movzx</span>  <span class=hljs-built_in>eax</span>,<span class=hljs-built_in>BYTE</span> <span class=hljs-built_in>PTR</span> [<span class=hljs-built_in>eax</span>]
 <span class=hljs-number>8048607</span>:   <span class=hljs-number>32</span> <span class=hljs-number>45</span> ec                <span class=hljs-keyword>xor</span>    <span class=hljs-built_in>al</span>,<span class=hljs-built_in>BYTE</span> <span class=hljs-built_in>PTR</span> [<span class=hljs-built_in>ebp</span>-<span class=hljs-number>0x14</span>]
 804860a:   <span class=hljs-number>88</span> <span class=hljs-number>02</span>                   <span class=hljs-keyword>mov</span>    <span class=hljs-built_in>BYTE</span> <span class=hljs-built_in>PTR</span> [<span class=hljs-built_in>edx</span>],<span class=hljs-built_in>al</span>
 804860c:   <span class=hljs-number>83</span> <span class=hljs-number>45</span> fc <span class=hljs-number>01</span>             <span class=hljs-keyword>add</span>    <span class=hljs-built_in>DWORD</span> <span class=hljs-built_in>PTR</span> [<span class=hljs-built_in>ebp</span>-<span class=hljs-number>0x4</span>],<span class=hljs-number>0x1</span>
 <span class=hljs-number>8048610</span>:   8b <span class=hljs-number>45</span> fc                <span class=hljs-keyword>mov</span>    <span class=hljs-built_in>eax</span>,<span class=hljs-built_in>DWORD</span> <span class=hljs-built_in>PTR</span> [<span class=hljs-built_in>ebp</span>-<span class=hljs-number>0x4</span>]
 <span class=hljs-number>8048613</span>:   3b <span class=hljs-number>45</span> 0c                <span class=hljs-keyword>cmp</span>    <span class=hljs-built_in>eax</span>,<span class=hljs-built_in>DWORD</span> <span class=hljs-built_in>PTR</span> [<span class=hljs-built_in>ebp</span>+<span class=hljs-number>0xc</span>]
 <span class=hljs-number>8048616</span>:   7c dc                   <span class=hljs-keyword>jl</span>     80485f4 &#60decrypt+<span class=hljs-number>0x15</span>>
 <span class=hljs-number>8048618</span>:   <span class=hljs-number>90</span>                      <span class=hljs-keyword>nop</span>
 <span class=hljs-number>8048619</span>:   c9                      <span class=hljs-keyword>leave</span>
 804861a:   c3                      <span class=hljs-keyword>ret</span>
</code></pre><p>こうなので、C言語っぽく書くとこうでしょうか？<pre><code class="hljs language-c"><span class=hljs-function><span class=hljs-keyword>void</span> <span class=hljs-title>decrypt</span><span class=hljs-params>(<span class=hljs-keyword>char</span>* flag, <span class=hljs-keyword>int</span> len, <span class=hljs-keyword>int</span> num)</span></span>{
	<span class=hljs-keyword>for</span>(<span class=hljs-keyword>int</span> i = <span class=hljs-number>0</span>; i &#60 len; i++){
		flag[i] ^= num;
	}
}
</code></pre><p>じゃあ、<code>flag</code>を実際に復号してみます。<pre><code class="hljs language-c"><span class=hljs-meta>#<span class=hljs-meta-keyword>include</span> <span class=hljs-meta-string>&#60stdio.h></span></span>

<span class=hljs-keyword>char</span> flag[] = <span class=hljs-string>"\226\201\223\301\227\216\215\232\207\252\215\232\207\252\206\234\230\205\231\220\252\226\207\214\205\201\324\324\210\365"</span>;

<span class=hljs-function><span class=hljs-keyword>void</span> <span class=hljs-title>decrypt</span><span class=hljs-params>(<span class=hljs-keyword>char</span>* flag, <span class=hljs-keyword>int</span> len, <span class=hljs-keyword>int</span> num)</span></span>{
   <span class=hljs-keyword>for</span>(<span class=hljs-keyword>int</span> i = <span class=hljs-number>0</span>; i &#60 len; i++){
      flag[i] ^= num;
   }
}

<span class=hljs-function><span class=hljs-keyword>int</span> <span class=hljs-title>main</span><span class=hljs-params>()</span></span>{
   decrypt(flag, <span class=hljs-number>0x1e</span>, <span class=hljs-number>0x42</span>);
   decrypt(flag, <span class=hljs-number>0x1e</span>, <span class=hljs-number>0xffffffb7</span>);
   <span class=hljs-built_in>puts</span>(flag);
   <span class=hljs-keyword>return</span> <span class=hljs-number>0</span>;
}
</code></pre><p>イケました！<h3>ラクをする</h3><p>strcmpで比較するために、実行中にメモリにFLAGが乗っているはずなので、gdbで探してみます。 strcmpの直前でブレークして<code>flag</code>を見てみると、<pre><code class="hljs language-sh"><span class=hljs-comment># gdb -q ./bin300</span>
Reading symbols from ./bin300...(no debugging symbols found)...<span class=hljs-keyword>done</span>.
(gdb) b*0x0804858f
Breakpoint 1 at 0x804858f
(gdb) x/s 0x0804a02c
0x804a02c &#60flag>: <span class=hljs-string>"ctf4b{xor_xor_simple_crypt!!}"</span>
</code></pre><h3>もっとラクをする</h3><p><code>ltrace</code>っていう便利なモノがあります。 コレを使うと、ライブラリ関数の呼び出しをトレースできます。 つまり、strcmpに何を渡しているのかが見えます。<pre><code class="hljs language-sh"><span class=hljs-comment># ltrace ./bin300</span>
__libc_start_main(0x804851b, 1, 0xff932834, 0x8048620 &#60unfinished ...>
<span class=hljs-built_in>printf</span>(<span class=hljs-string>"Please input flag... "</span>)                                      = 21
__isoc99_scanf(0x80486b6, 0xff93273c, 0xff932740, 0x80482a9)         = 0xffffffff
strcmp(<span class=hljs-string>"\024"</span>, <span class=hljs-string>"ctf4b{xor_xor_simple_crypt!!}"</span>)                      = -1
puts(<span class=hljs-string>"Wrong flag..."</span>)                                                = 14
+++ exited (status 0) +++
</code></pre><h3>おまけ</h3><p>angrを使ってみる<pre><code class="hljs language-python"><span class=hljs-comment># python2</span>
<span class=hljs-meta>>>> </span><span class=hljs-keyword>import</span> angr
<span class=hljs-meta>>>> </span>p = angr.Project(<span class=hljs-string>"./bin300"</span>, load_options={<span class=hljs-string>"auto_load_libs"</span>:<span class=hljs-literal>False</span>})
<span class=hljs-meta>>>> </span>state = p.factory.blank_state(addr=<span class=hljs-number>0x804851b</span>)
<span class=hljs-meta>>>> </span>path = p.factory.path(state)
<span class=hljs-meta>>>> </span>pg = p.factory.path_group(path)
<span class=hljs-meta>>>> </span>e = pg.explore(find=<span class=hljs-number>0x80485a7</span>, avoid=<span class=hljs-number>0x80485b9</span>)
<span class=hljs-meta>>>> </span>e.found[<span class=hljs-number>0</span>].state.posix.dumps(<span class=hljs-number>0</span>)
<span class=hljs-string>'ctf4b{xor_xor_simple_crypt!!}\x00\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\xd9\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'</span>
</code></pre></article><div class="SocialShare_social__3xEln"><a rel="noopener noreferrer" target="_blank" href="https://social-plugins.line.me/lineit/share?url=https%3A%2F%2F6715.jp%2Fposts%2F13%2F"><span title="LINE" style="background-color:#00C300"><svg viewBox="0 0 24 24"><path fill="white" d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="http://twitter.com/share?url=https%3A%2F%2F6715.jp%2Fposts%2F13%2F&amp;text=CTF%20for%20%E3%83%93%E3%82%AE%E3%83%8A%E3%83%BC%E3%82%BA%202016%20%E9%87%91%E6%B2%A2%20%E3%81%AB%E8%A1%8C%E3%81%A3%E3%81%9F%20(writeup)%20%7C%206715.jp"><span title="Twitter" style="background-color:#1DA1F2"><svg viewBox="0 0 24 24"><path fill="white" d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2F6715.jp%2Fposts%2F13%2F"><span title="Facebook" style="background-color:#1877F2"><svg viewBox="0 0 24 24"><path fill="white" d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="http://b.hatena.ne.jp/add?url=https%3A%2F%2F6715.jp%2Fposts%2F13%2F"><span title="Hatena Bookmark" style="background-color:#00A4DE"><svg viewBox="0 0 24 24"><path fill="white" d="M20.47 0C22.42 0 24 1.58 24 3.53v16.94c0 1.95-1.58 3.53-3.53 3.53H3.53C1.58 24 0 22.42 0 20.47V3.53C0 1.58 1.58 0 3.53 0h16.94zm-3.705 14.47c-.78 0-1.41.63-1.41 1.41s.63 1.414 1.41 1.414 1.41-.645 1.41-1.425-.63-1.41-1.41-1.41zM8.61 17.247c1.2 0 2.056-.042 2.58-.12.526-.084.976-.222 1.32-.412.45-.232.78-.564 1.02-.99s.36-.915.36-1.48c0-.78-.21-1.403-.63-1.87-.42-.48-.99-.734-1.74-.794.66-.18 1.156-.45 1.456-.81.315-.344.465-.824.465-1.424 0-.48-.103-.885-.3-1.26-.21-.36-.493-.645-.883-.87-.345-.195-.735-.315-1.215-.405-.464-.074-1.29-.12-2.474-.12H5.654v10.486H8.61zm.736-4.185c.705 0 1.185.088 1.44.262.27.18.39.495.39.93 0 .405-.135.69-.42.855-.27.18-.765.254-1.44.254H8.31v-2.297h1.05zm8.656.706v-7.06h-2.46v7.06H18zM8.925 9.08c.71 0 1.185.08 1.432.24.245.16.367.435.367.83 0 .38-.13.646-.39.804-.265.154-.747.232-1.452.232h-.57V9.08h.615z"></path></svg></span></a></div></main><footer class="Footer_footer__22y9A"><div id="profile" class="Footer_profile__39Joc"><img src="https://res.cloudinary.com/narusejun/image/twitter_name/h_128/sekai67.jpg" alt="sekai"/><div><small>Author</small><strong>sekai<a rel="noopener noreferrer" target="_blank" href="https://github.com/kaz"><span title="GitHub" style="background-color:initial"><svg viewBox="0 0 24 24"><path fill="#181717" d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="https://twitter.com/sekai67"><span title="Twitter" style="background-color:initial"><svg viewBox="0 0 24 24"><path fill="#1DA1F2" d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"></path></svg></span></a><a rel="noopener noreferrer" target="_blank" href="https://www.facebook.com/sawada.kazuki"><span title="Facebook" style="background-color:initial"><svg viewBox="0 0 24 24"><path fill="#1877F2" d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path></svg></span></a></strong><p>インフラとDXが好き</p></div></div><div class="Footer_copyright__3QtRW">© <!-- -->2016 sekai</div></footer></div></body></html>